<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8" >
    <meta name="baidu-site-verification" content="dIcXMeY8Ya" />
    
    <title>Spring Integration Websocket | 螃蟹以死</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.3, maximum-scale=1, user-scalable=0" />
    <meta name="keywords" content="螃蟹以死(Crab2Died)的个人博客，分享学习、工作的经验总结。涉及软件开发，大数据开发，分布式系统，微服务，前端开发等" />
    <meta itemprop="name" content="0" />
    <meta itemprop="image" content="https://www.seekpie.com/images/net/web.jpg  "/>
    <meta itemprop="description" name="description"  content="一. 依赖（这里只列举了websocket相关依赖）&lt;!-- spring webSocket依赖 --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt;    &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-messaging - " />
    <meta name="baidu-site-verification" content="8ssDkDEucu" />
    
    <link rel="alternative" href="/atom.xml" title="螃蟹以死" type="application/atom+xml" >
    
    
    <link rel="shortcut icon" href="/favicon.ico" >
    
    
<link rel="stylesheet" href="/css/style.css">

    <!--[if lt IE 9]>
    
<script src="/js/html5.js"></script>

    <![endif]-->
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ab88d36acf7ff63477f8ed578415c246";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


    
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-5475855676583847",
        enable_page_level_ads: true
    });
</script>
    
    
<script src="/js/jquery/jquery-2.2.0.min.js"></script>

    
<script src="/js/qrcode.min.js"></script>

    
<script src="/js/particles.js"></script>

    
<script src="/js/qq/share.js"></script>

<meta name="generator" content="Hexo 8.0.0"></head>

<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 背景 -->
    <!--<div id="particles-js" style="position: fixed; width: 100%; height: 100%;" class="bc-grid">-->
    <div style="position: fixed; width: 100%; height: 100%;" class="bc-grid">

    </div>
    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">螃蟹以死</span>
                    <span class="description">seekpie</span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/2018/08/27/spring-intergration-websocket/index.html" class="item ">
                <a href="/"  title="首页" class="fa fa-home">&nbsp;首页</a>
            </li>
            
            <li rel="/2018/08/27/spring-intergration-websocket/index.html" class="item ">
                <a href="/archives/"  title="归档" class="fa fa-archive">&nbsp;归档</a>
            </li>
            
            <li rel="/2018/08/27/spring-intergration-websocket/index.html" class="item ">
                <a href="/tools/tools.html"  title="工具" class="fa fa-wrench">&nbsp;工具</a>
            </li>
            
            <li rel="/2018/08/27/spring-intergration-websocket/index.html" class="item ">
                <a href="/atom.xml" target="_blank"  title="RSS" class="fa fa-rss">&nbsp;RSS</a>
            </li>
            
            <li class="item search-item"><!-- 搜索遮罩框 -->
<span class="local-search local-search-google local-search-plugin" id="local-search">
  <span><input type="search" placeholder="站内搜索..." id="local-search-input" class="local-search-input-cls" style=""/></span>&nbsp;
  <span class="fa fa-search"></span>
  <div id="local-search-result" class="local-search-result-cls"></div>
</span></li>
        </ul>
        <div class="profile clearfix">
            <div class="qr-site fl"  onmouseover="siteQrMouseOver()" onmouseout="siteQrMouseOut()">
                <div>
                    <div id="site-qr"></div>
                </div>
            </div>
            <div id="site-qr-pop"> </div>
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/Crab2died" target="_blank">GitHub</a>
                        |
                    
                        <a href="https://github.com/seek-pie" target="_blank">Seek Pie</a>
                        |
                    
                        <a href="https://gitee.com/Crab2Died" target="_blank">Gitee</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="http://weibo.com/Crab2Died" class="weibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href="https://www.zhihu.com/people/crab2died" class="zhihu" target="_blank"><b>■</b> 知 乎</a>
                    
                        <a href="mailto:Crab2Died@126.com" class="email" target="_blank"><b>■</b> E-mail</a>
                    
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/crab2died.png" alt="avatar" title="Crab2Died" >
            </div>
        </div>
    </section>
</header>


    

  <div class="bulletin">
    <!--<div class="bulletin-icon"><strong style="color: #ebd829; width: 50px"><i class="fa fa-volume-up"></i></strong></div>-->
    <div class="bulletin-content">
      
        <marquee direction="left" behavior="scroll" scrollamount=7 scrolldelay=0 align="bottom" bgcolor="#ffffff" hspace=20 vspace=0
               onmouseover=this.stop() onmouseout=this.start()>
        工具内有很多实用工具，欢迎使用。
      
    </marquee></div>
    <div id="theClock" class="bulletin-clock">

    </div>
  </div>



    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章页 -->
<!-- 文章 -->
<article class="post article">
  <header class="text-center">
    <h3 class="post-title"><span>Spring Integration Websocket</span></h3>
  </header>
  <p class="post-meta text-center">
    <i class="fa fa-edit"></i>
    Crab2Died &nbsp;&nbsp;
    <i class="fa fa-calendar"></i>
    <time datetime="2018-08-26T17:11:27.000Z">2018-08-27</time>
    <span id="busuanzi_container_page_pv"> &nbsp;&nbsp; <i class="fa fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span>
  </p>

  <p class="copyright_label">
    <span class="copyright_title">版权声明: </span>
    <span class="copyright_notice">本文著作权归作者所有，转载请注明出处。
      
      <span class="copyright_link">https://www.seekpie.com/2018/08/27/spring-intergration-websocket/</span>
      </span>
  </p>
  <div class="post-content">
    <h1 id="一-依赖（这里只列举了websocket相关依赖）"><a href="#一-依赖（这里只列举了websocket相关依赖）" class="headerlink" title="一. 依赖（这里只列举了websocket相关依赖）"></a>一. 依赖（这里只列举了websocket相关依赖）</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring webSocket依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-messaging --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-messaging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.websocket/javax.websocket-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.websocket-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- websocket客户端 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.tyrus.bundles<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tyrus-standalone-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="二-WebSocket服务端"><a href="#二-WebSocket服务端" class="headerlink" title="二. WebSocket服务端"></a>二. WebSocket服务端</h1><h4 id="2-1-核心代码"><a href="#2-1-核心代码" class="headerlink" title="2.1. 核心代码"></a>2.1. 核心代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.websocket.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.github.CommonConstant;</span><br><span class="line"><span class="keyword">import</span> com.github.session.SObject;</span><br><span class="line"><span class="keyword">import</span> com.github.websocket.configuration.HttpSessionConfigurator;</span><br><span class="line"><span class="keyword">import</span> com.github.websocket.msg.Msg;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Crab2Died&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DESC</span> : &lt;p&gt;注解&#123;<span class="doctag">@link</span> ServerEndpoint&#125;声明websocket 服务端&lt;/p&gt;&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2017/5/25  9:43&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ServerEndpoint(value = &quot;/chat&quot;, configurator = HttpSessionConfigurator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WSServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(WSServer.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在线人数 线程安全</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">onlineCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连接集合 userId =&gt; server 键值对 线程安全</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">final</span> ConcurrentMap&lt;String, WSServer&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 与某个客户端的连接会话，需要通过它来给客户端发送数据</span></span><br><span class="line">    <span class="keyword">private</span> Session session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前会话的httpsession</span></span><br><span class="line">    <span class="keyword">private</span> HttpSession httpSession;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session websocket连接sesson</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config  &#123;<span class="doctag">@link</span> com.github.websocket.configuration.HttpSessionConfigurator&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@DESC</span> &lt;p&gt;注解&#123;<span class="doctag">@link</span> OnOpen&#125; 声明客户端连接进入的方法&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, EndpointConfig config)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 得到httpSession</span></span><br><span class="line">        <span class="built_in">this</span>.httpSession = (HttpSession) config.getUserProperties().get(HttpSession.class.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取session对象 SObject(这个就是java web登入后的保存的session对象，此处为用户信息，包含了userId)</span></span><br><span class="line">        <span class="type">SObject</span> <span class="variable">user</span> <span class="operator">=</span> (SObject) <span class="built_in">this</span>.httpSession.getAttribute(CommonConstant.USER_LOGIN_SESSION);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.session = session;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将连接session对象存入map</span></span><br><span class="line">        map.put(user.getUid(), <span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 连接数+1</span></span><br><span class="line">        addOnlineCount();</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">&quot;有新的连接，当前连接数为：&quot;</span> + getOnlineCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&#123;<span class="doctag">@link</span> OnClose&#125; 关闭连接&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 获取当前连接信息 &#123;<span class="doctag">@code</span> CommonConstant.USER_LOGIN_SESSION&#125; 为Http session 名</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">SObject</span> <span class="variable">user</span> <span class="operator">=</span> (SObject) <span class="built_in">this</span>.httpSession.getAttribute(CommonConstant.USER_LOGIN_SESSION);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 移除连接</span></span><br><span class="line">        map.remove(user.getUid());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 连接数-1</span></span><br><span class="line">        subOnlineCount();</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">&quot;有一连接断开，当前连接数为：&quot;</span> + getOnlineCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&#123;<span class="doctag">@link</span> OnMessage&#125; 消息监听处理方法&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 消息对象&#123;<span class="doctag">@link</span> com.github.websocket.msg.Msg&#125;的JSON对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将消息转Msg对象</span></span><br><span class="line">        <span class="type">Msg</span> <span class="variable">msg</span> <span class="operator">=</span> JSON.parseObject(message, Msg.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO 可以对msg做些处理...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据Msg消息对象获取定点发送人的userId</span></span><br><span class="line">        <span class="type">WSServer</span> <span class="variable">_client</span> <span class="operator">=</span> map.get(msg.getToUid());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定点发送</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(msg.getToUid())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != _client) &#123;</span><br><span class="line">                <span class="comment">// 是否连接判断</span></span><br><span class="line">                <span class="keyword">if</span> (_client.session.isOpen())</span><br><span class="line">                    <span class="comment">// 消息发送</span></span><br><span class="line">                    _client.session.getBasicRemote().sendText(JSON.toJSONString(msg));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 群发</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(msg.getToUid())) &#123;</span><br><span class="line">            <span class="comment">// 群发已连接用户</span></span><br><span class="line">            <span class="keyword">for</span> (WSServer client : map.values()) &#123;</span><br><span class="line">                client.session.getBasicRemote().sendText(JSON.toJSONString(msg));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&#123;<span class="doctag">@link</span> OnError&#125; websocket系统异常处理&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable t)</span> &#123;</span><br><span class="line">        logger.error(t);</span><br><span class="line">        t.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;系统主动推送 这是个静态方法在web启动后可在程序的其他合适的地方和时间调用，这就实现了系统的主动推送&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 消息对象&#123;<span class="doctag">@link</span> com.github.websocket.msg.Msg&#125;的JSON对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pushBySys</span><span class="params">(Msg msg)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO 也可以实现定点推送</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 群发</span></span><br><span class="line">        <span class="keyword">for</span> (WSServer client : map.values()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                client.session.getBasicRemote().sendText(JSON.toJSONString(msg));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取连接数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getOnlineCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> WSServer.onlineCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增加连接数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addOnlineCount</span><span class="params">()</span> &#123;</span><br><span class="line">        WSServer.onlineCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 减少连接数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">subOnlineCount</span><span class="params">()</span> &#123;</span><br><span class="line">        WSServer.onlineCount--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-2-HttpSessionConfigurator类"><a href="#2-2-HttpSessionConfigurator类" class="headerlink" title="2.2. HttpSessionConfigurator类"></a>2.2. HttpSessionConfigurator类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.websocket.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.HandshakeResponse;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.HandshakeRequest;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpointConfig;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpointConfig.Configurator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Crab2Died&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DESC</span> : &lt;p&gt;讲http request的session 存入websocket的session内&lt;/p&gt;&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2017/5/25  16:08&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpSessionConfigurator</span> <span class="keyword">extends</span> <span class="title class_">Configurator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modifyHandshake</span><span class="params">(ServerEndpointConfig sec,</span></span><br><span class="line"><span class="params">                                HandshakeRequest request, HandshakeResponse response)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取当前Http连接的session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">httpSession</span> <span class="operator">=</span> (HttpSession) request.getHttpSession();</span><br><span class="line">        <span class="comment">// 将http session信息注入websocket session</span></span><br><span class="line">        sec.getUserProperties().put(HttpSession.class.getName(), httpSession);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-3-Msg消息体"><a href="#2-3-Msg消息体" class="headerlink" title="2.3. Msg消息体"></a>2.3. Msg消息体</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.websocket.msg;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Crab2Died&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DESC</span> : &lt;p&gt;WebSocket消息模型&lt;/p&gt;&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2017/5/25  9:43&lt;/br&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Msg</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 推送人ID</span></span><br><span class="line">    <span class="keyword">private</span> String fromUid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定点推送人ID</span></span><br><span class="line">    <span class="keyword">private</span> String toUid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定点推送单位ID</span></span><br><span class="line">    <span class="keyword">private</span> String toOrgId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息体</span></span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 推送时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Date</span> <span class="variable">createDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息状态</span></span><br><span class="line">    <span class="keyword">private</span> Integer flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Msg</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Msg</span><span class="params">(String fromUid, String toUid, String toOrgId, String data, Date createDate, Integer flag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fromUid = fromUid;</span><br><span class="line">        <span class="built_in">this</span>.toUid = toUid;</span><br><span class="line">        <span class="built_in">this</span>.toOrgId = toOrgId;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="built_in">this</span>.createDate = createDate;</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFromUid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fromUid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFromUid</span><span class="params">(String fromUid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fromUid = fromUid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getToUid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toUid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setToUid</span><span class="params">(String toUid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.toUid = toUid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getToOrgId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toOrgId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setToOrgId</span><span class="params">(String toOrgId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.toOrgId = toOrgId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getCreateDate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCreateDate</span><span class="params">(Date createDate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getFlag</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFlag</span><span class="params">(Integer flag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Msg&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;fromUid=&#x27;&quot;</span> + fromUid + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, toUid=&#x27;&quot;</span> + toUid + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, toOrgId=&#x27;&quot;</span> + toOrgId + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, data=&#x27;&quot;</span> + data + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, createDate=&quot;</span> + createDate +</span><br><span class="line">                <span class="string">&quot;, flag=&quot;</span> + flag +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="三-客户端（HTML5）"><a href="#三-客户端（HTML5）" class="headerlink" title="三. 客户端（HTML5）"></a>三. 客户端（HTML5）</h1><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="comment">// 创建websocket实例</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080/chat&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     *监听三种状态的变化js会回调</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     */</span></span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// 连接回调</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onclose</span> = <span class="keyword">function</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// 断开连接回调</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// 消息监听</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">showMessage</span>(message.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">window</span>.<span class="property">onbeforeunload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//关闭连接</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">closeWebSocket</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">close</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//发送消息</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">send</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;msg&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> text = input.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">		</span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// 消息体JSON 对象 对应JAVA 的 Msg对象</span></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="comment">// 定点发送给其他用户的userId</span></span></span><br><span class="line"><span class="language-javascript">			toUid : <span class="string">&quot;3d535429-5fcb-4490-bcf7-96fd84bb17b6&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">			data : text</span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">		</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span></span><br><span class="line"><span class="language-javascript">        input.<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">showMessage</span>(<span class="params">message</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> text = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(message).<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> br = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;br&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> div = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;showChatMessage&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        div.<span class="title function_">appendChild</span>(text);</span></span><br><span class="line"><span class="language-javascript">        div.<span class="title function_">appendChild</span>(br);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        style=&quot;width: 600px; height: 240px; overflow-y: auto; border: 1px solid #333;&quot;</span><br><span class="line">        id=&quot;show&quot;&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;showChatMessage&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;80&quot;</span> <span class="attr">id</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">name</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入聊天内容&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;发送&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sendBn&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sendBn&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;send()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
  </div>

  <!-- 目录 -->
  <div class="catalog">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E4%BE%9D%E8%B5%96%EF%BC%88%E8%BF%99%E9%87%8C%E5%8F%AA%E5%88%97%E4%B8%BE%E4%BA%86websocket%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96%EF%BC%89"><span class="toc-text">一. 依赖（这里只列举了websocket相关依赖）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-WebSocket%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">二. WebSocket服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="toc-text">2.1. 核心代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-HttpSessionConfigurator%E7%B1%BB"><span class="toc-text">2.2. HttpSessionConfigurator类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Msg%E6%B6%88%E6%81%AF%E4%BD%93"><span class="toc-text">2.3. Msg消息体</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%88HTML5%EF%BC%89"><span class="toc-text">三. 客户端（HTML5）</span></a></li></ol>
  </div>

  <p class="post-meta">
        <span class="post-cat">分类：
          <a class="cat-link" href="/categories/Web-Socket/">Web Socket</a>
        </span>
    <span class="post-tags">
            标签：
      
    
        <a href="/tags/Java/" title="Java" class="post-tag">Java</a> | 
    
        <a href="/tags/Spring/" title="Spring" class="post-tag">Spring</a> | 
    
        <a href="/tags/Web-Socket/" title="Web Socket" class="post-tag">Web Socket</a>
    

        </span>
  </p>
</article>
<!-- 分享按钮 -->

  <div class="article-share clearfix text-center">
    <div class="share-area">
      <span class="share-txt">分享到：</span>
      <a href="javascript: window.open('http://service.weibo.com/share/share.php?url=' + encodeURIComponent(location.href.split('#')[0]) + '&title=' + document.title + '&pic=https://www.seekpie.com/images/net/web.jpg&language=zh_cn');"
         class="share-icon weibo"></a>
      <a href="javascript: wechatShare('wechat-show', window.location.href.split('#')[0])" class="share-icon wechat"></a>
      <a href="javascript: window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=' + encodeURIComponent(location.href.split('#')[0]) + '&title=' + document.title);"
         class="share-icon qqzone"></a>
      <a href="javascript: window.open('http://connect.qq.com/widget/shareqq/index.html?url=' + encodeURIComponent(location.href.split('#')[0]) + '&title=' + encodeURIComponent(document.title) +'&desc=' + encodeURIComponent('一. 依赖（这里只列举了websocket相关依赖）&lt;!-- spring webSocket依赖 --&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&') + '&pics=https://www.seekpie.com/images/net/web.jpg');"
         class="share-icon qq"></a>
      <a href="javascript: window.open('http://shuo.douban.com/!service/share?href=' + encodeURIComponent(location.href.split('#')[0]) + '&name=' + document.title + '&text=' + document.title);"
         class="share-icon douban"></a>
    </div>
  </div>
  <div class="wechat-show">
    <div class="wx-header"><span>分享到微信朋友圈</span><a class="wx-close" onclick="closeShare('wechat-show')">×</a></div>
    <div id="wechat-share" style="margin: 10px"></div>
    <div class="wx-footer">打开微信，使用“扫一扫”即可将网页分享至朋友圈。</div>
  </div>


<!-- 上一篇/下一篇 -->

<div class="article-nav clearfix">
    
    <span class="prev fl">
        上一篇<br >
        <a href="/2018/08/27/restful-http/">
            
                RESTful HTTP
            
        </a>
    </span>
    

    
    <span class="next fr">
        下一篇<br >
        <a href="/2018/07/16/redis-cache-summarize/">
            
                Redis Cache Summarize
            
        </a>
    </span>
    
</div>

<!-- 文章评论 -->


  <div id="comments" class="comments">
  </div>

  
    
<script src="/js/comment.js"></script>

    <script>
        JELON.Comment({
            container: 'comments',
            label: 'spring-intergration-websocket' || '2018/08/27/spring-intergration-websocket/',
            owner: 'Crab2Died',
            repo: 'blog-comments',
            clientId: '2117b548bf34c40984be',
            clientSecret: '2642328e6056dbf7b02951961e5ca481406410ed'
        });
    </script>
  


            </div>
        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">

    
    <section class="widget toc-widget">
      <h3 class="widget-hd"><strong>文章目录</strong></h3>
      <!-- 目录 -->
      <div class="toc">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%B8%80-%E4%BE%9D%E8%B5%96%EF%BC%88%E8%BF%99%E9%87%8C%E5%8F%AA%E5%88%97%E4%B8%BE%E4%BA%86websocket%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96%EF%BC%89"><span class="post-toc-text">一. 依赖（这里只列举了websocket相关依赖）</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%BA%8C-WebSocket%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="post-toc-text">二. WebSocket服务端</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="post-toc-text">2.1. 核心代码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-HttpSessionConfigurator%E7%B1%BB"><span class="post-toc-text">2.2. HttpSessionConfigurator类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-Msg%E6%B6%88%E6%81%AF%E4%BD%93"><span class="post-toc-text">2.3. Msg消息体</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%B8%89-%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%88HTML5%EF%BC%89"><span class="post-toc-text">三. 客户端（HTML5）</span></a></li></ol>
      </div>
    </section>
    

    

    <section class="widget">
        <h3 class="widget-hd"><strong>热门分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
  
    <li title="Java">
      <span class="badge">(8)</span>
      <a href="/categories/Java/">Java</a>
    </li>
  
    <li title="Big Data">
      <span class="badge">(2)</span>
      <a href="/categories/Big-Data/">Big Data</a>
    </li>
  
    <li title="Excel4J">
      <span class="badge">(1)</span>
      <a href="/categories/Excel4J/">Excel4J</a>
    </li>
  
    <li title="Database">
      <span class="badge">(1)</span>
      <a href="/categories/Database/">Database</a>
    </li>
  
    <li title="Elasticsearch">
      <span class="badge">(1)</span>
      <a href="/categories/Elasticsearch/">Elasticsearch</a>
    </li>
  
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item-link" href="/tags/Java/" title="Java 10篇">
      Java(10)
    </a>
  
    <a class="tag-item-link" href="/tags/JVM/" title="JVM 3篇">
      JVM(3)
    </a>
  
    <a class="tag-item-link" href="/tags/Big-Data/" title="Big Data 2篇">
      Big Data(2)
    </a>
  
    <a class="tag-item-link" href="/tags/Excel4J/" title="Excel4J 1篇">
      Excel4J(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Database/" title="Database 1篇">
      Database(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Elasticsearch/" title="Elasticsearch 1篇">
      Elasticsearch(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Interview/" title="Interview 1篇">
      Interview(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Collection/" title="Collection 1篇">
      Collection(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Classloader/" title="Classloader 1篇">
      Classloader(1)
    </a>
  
    <a class="tag-item-link" href="/tags/JIT/" title="JIT 1篇">
      JIT(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Optimize/" title="Optimize 1篇">
      Optimize(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Concurrent/" title="Concurrent 1篇">
      Concurrent(1)
    </a>
  
    <a class="tag-item-link" href="/tags/GC/" title="GC 1篇">
      GC(1)
    </a>
  
    <a class="tag-item-link" href="/tags/JMM/" title="JMM 1篇">
      JMM(1)
    </a>
  
    <a class="tag-item-link" href="/tags/Java-Monitor/" title="Java Monitor 1篇">
      Java Monitor(1)
    </a>
  
</div>
    </section>
    

    

    

    

    
    <!-- 实用工具 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>实用工具</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="/tools/time-converter.html" target="_blank" title="⏰时间转换工具">⏰时间转换工具</a>
        </li>
    
        <li>
            <a href="/tools/api-test-tool.html" target="_blank" title="🚀API调试工具">🚀API调试工具</a>
        </li>
    
        <li>
            <a href="/tools/loan-calculator.html" target="_blank" title="🏦贷款计算器">🏦贷款计算器</a>
        </li>
    
        <li>
            <a href="/tools/tax-calculator.html" target="_blank" title="💰个税计算器">💰个税计算器</a>
        </li>
    
        <li>
            <a href="/tools/number-converter.html" target="_blank" title="🔢进制转换工具">🔢进制转换工具</a>
        </li>
    
        <li>
            <a href="/tools/encoder-decoder.html" target="_blank" title="🔐编解码工具">🔐编解码工具</a>
        </li>
    
        <li>
            <a href="/tools/crypto-tool.html" target="_blank" title="🔒加解密工具">🔒加解密工具</a>
        </li>
    
        <li>
            <a href="/tools/jwt-tool.html" target="_blank" title="🔑JWT解析工具">🔑JWT解析工具</a>
        </li>
    
        <li>
            <a href="/tools/unit-converter.html" target="_blank" title="📏单位转换工具">📏单位转换工具</a>
        </li>
    
        <li>
            <a href="/tools/regex-tool.html" target="_blank" title="🔍正则表达式工具">🔍正则表达式工具</a>
        </li>
    
        <li>
            <a href="/tools/cron-tool.html" target="_blank" title="⏰Cron表达式生成工具">⏰Cron表达式生成工具</a>
        </li>
    
        <li>
            <a href="/tools/compression-tool.html" target="_blank" title="📦解压缩工具">📦解压缩工具</a>
        </li>
    
        <li>
            <a href="/tools/formatter-tool.html" target="_blank" title="✨代码格式化工具">✨代码格式化工具</a>
        </li>
    
        <li>
            <a href="/tools/csv-tool.html" target="_blank" title="📊CSV展示工具">📊CSV展示工具</a>
        </li>
    
        <li>
            <a href="/tools/json-array-tool.html" target="_blank" title="📋JSON数组展示工具">📋JSON数组展示工具</a>
        </li>
    
        <li>
            <a href="/tools/chart-tool.html" target="_blank" title="📊报表展示工具">📊报表展示工具</a>
        </li>
    
        <li>
            <a href="/tools/qrcode-barcode-tool.html" target="_blank" title="📱二维码条形码工具">📱二维码条形码工具</a>
        </li>
    
        <li>
            <a href="/tools/exchange-rate.html" target="_blank" title="💱汇率转换工具">💱汇率转换工具</a>
        </li>
    
</ul>
    </section>
    

    

</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">总浏览量<span id="busuanzi_value_site_pv"></span>次</span>
  <br>
    Copyright &copy;
    
        2017 - 2025
    

    <a href="https://github.com/Crab2died" target="_blank"> Crab2Died </a>
    All Rights Reserved.

</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->

<script src="/js/main.js"></script>


</body>
</html>