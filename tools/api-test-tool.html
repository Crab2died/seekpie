<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè°ƒè¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
        }

        .info-box h4 {
            color: #1976D2;
            margin-bottom: 8px;
        }

        .info-box p {
            color: #666;
            line-height: 1.6;
        }

        .info-box code {
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #667eea;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .request-line {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .method-select {
            width: 140px;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .method-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .url-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1em;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-width: 120px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            border-bottom: 2px solid #e1e5e9;
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #666;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .key-value-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .key-value-row {
            display: flex;
            gap: 10px;
            align-items: center;
            width: 100%;
        }

        .key-value-row input[type="text"],
        .key-value-row input[type="checkbox"] {
            transition: all 0.3s ease;
        }

        .key-value-row input[type="text"] {
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.95em;
            font-family: 'Consolas', 'Monaco', monospace;
            background: white;
            box-sizing: border-box;
        }

        .key-value-row input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .key-value-row input[type="checkbox"] {
            flex-shrink: 0;
            margin: 0;
        }

        .key-value-row .delete-btn {
            flex-shrink: 0;
            white-space: nowrap;
        }

        /* ä¼˜åŒ–datalistä¸‹æ‹‰æ¡†æ ·å¼ */
        .key-value-row input[type="text"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            opacity: 0.6;
            filter: invert(50%);
        }

        .key-value-row input[type="text"]::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }

        /* è‡ªå®šä¹‰ä¸‹æ‹‰å»ºè®®åˆ—è¡¨ */
        .autocomplete-wrapper {
            position: relative;
            flex: 1;
            min-width: 0; /* å…è®¸flexå­é¡¹ç¼©å°åˆ°å†…å®¹ä»¥ä¸‹ */
        }

        .autocomplete-wrapper.wide {
            flex: 2;
            min-width: 0;
        }

        .autocomplete-wrapper input {
            width: 100%;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            display: none;
        }

        .autocomplete-suggestions.show {
            display: block;
        }

        .autocomplete-suggestion {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            border-bottom: 1px solid #f0f0f0;
        }

        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }

        .autocomplete-suggestion:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .autocomplete-suggestion.selected {
            background: #e7f3ff;
        }

        .key-value-row .key-input {
            flex: 1;
            min-width: 0;
        }

        .key-value-row .value-input {
            flex: 2;
            min-width: 0;
        }

        /* å½“inputç›´æ¥åœ¨key-value-rowä¸­æ—¶ï¼ˆæ²¡æœ‰wrapperåŒ…è£¹ï¼‰ */
        .key-value-row > .key-input,
        .key-value-row > .value-input {
            width: auto;
        }

        .key-value-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .key-value-row .delete-btn {
            padding: 8px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .key-value-row .delete-btn:hover {
            background: #c82333;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 0.95em;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .body-type-select {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .body-type-option {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .body-type-option:hover {
            background: #e9ecef;
        }

        .body-type-option.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .auth-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .auth-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-type-selector {
            margin-bottom: 25px;
        }

        .auth-input-group {
            margin-bottom: 20px;
        }

        .auth-input-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .auth-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 0.95em;
            font-family: 'Consolas', 'Monaco', monospace;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .auth-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-input[type="password"] {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .auth-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 0.95em;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .auth-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 0.95em;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-info-box {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f7ff 100%);
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .auth-info-box h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .auth-info-box p {
            color: #555;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .auth-warning-box {
            background: linear-gradient(135deg, #fff3cd 0%, #fff8e1 100%);
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .auth-warning-box p {
            color: #856404;
            line-height: 1.6;
            font-size: 0.95em;
            margin: 0;
        }

        .response-section {
            margin-top: 30px;
            display: none;
        }

        .response-section.show {
            display: block;
        }

        .response-status {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .status-item {
            flex: 1;
            min-width: 150px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e1e5e9;
        }

        .status-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .status-value.success {
            color: #28a745;
        }

        .status-value.error {
            color: #dc3545;
        }

        .response-box {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            margin-bottom: 20px;
        }

        .response-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .response-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* è¯­æ³•é«˜äº®æ ·å¼ - JSON */
        .json-key {
            color: #881391;
            font-weight: 600;
        }

        .json-string {
            color: #1A1AA6;
        }

        .json-number {
            color: #1C00CF;
        }

        .json-boolean {
            color: #0D22FF;
            font-weight: 600;
        }

        .json-null {
            color: #808080;
            font-style: italic;
        }

        /* è¯­æ³•é«˜äº®æ ·å¼ - XML */
        .xml-tag {
            color: #800000;
        }

        .xml-tag-name {
            color: #800000;
            font-weight: 600;
        }

        .xml-attr {
            color: #FF0000;
        }

        .xml-string {
            color: #0000FF;
        }

        .xml-punct {
            color: #000000;
        }

        /* è¯­æ³•é«˜äº®æ ·å¼ - HTML */
        .html-tag {
            color: #800000;
        }

        .html-tag-name {
            color: #800000;
            font-weight: 600;
        }

        .html-attr {
            color: #FF0000;
        }

        .html-string {
            color: #0000FF;
        }

        .html-punct {
            color: #000000;
        }

        .html-comment {
            color: #008000;
            font-style: italic;
        }

        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .history-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e1e5e9;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-header h3 {
            color: #333;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clear-history-btn {
            padding: 8px 16px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .clear-history-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            border-color: #4facfe;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.2);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            gap: 10px;
        }

        .history-item-header > div:first-child {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }

        .history-item-method {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 5px;
            font-weight: 600;
            font-size: 0.85em;
            flex-shrink: 0;
        }

        .method-GET {
            background: #28a745;
            color: white;
        }

        .method-POST {
            background: #ffc107;
            color: #333;
        }

        .method-PUT {
            background: #17a2b8;
            color: white;
        }

        .method-DELETE {
            background: #dc3545;
            color: white;
        }

        .method-PATCH {
            background: #6f42c1;
            color: white;
        }

        .history-item-url {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #555;
            word-break: break-all;
            overflow-wrap: break-word;
            word-wrap: break-word;
            flex: 1;
            min-width: 0;
        }

        .history-item-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .history-item-date {
            color: #999;
            font-size: 0.85em;
        }

        .delete-history-btn {
            padding: 4px 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .delete-history-btn:hover {
            background: #c82333;
        }

        .history-item-status {
            margin-top: 8px;
            font-size: 0.85em;
            color: #666;
        }

        .empty-history {
            text-align: center;
            padding: 40px;
            color: #999;
            font-style: italic;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 2px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2em;
            color: white;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 2px solid #e1e5e9;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* å˜é‡æç¤ºæ ·å¼ */
        .variable-hint {
            position: absolute;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            min-width: 200px;
        }

        .variable-hint.show {
            display: block;
        }

        .variable-hint-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .variable-hint-item:last-child {
            border-bottom: none;
        }

        .variable-hint-item:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .variable-hint-key {
            font-weight: 600;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .variable-hint-value {
            font-size: 0.85em;
            color: #666;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .variable-hint-item:hover .variable-hint-value {
            color: rgba(255, 255, 255, 0.8);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .content {
                padding: 20px 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 0.95em;
            }

            .request-line {
                flex-direction: column;
            }

            .method-select {
                width: 100%;
            }

            .btn {
                width: 100%;
            }

            .tabs {
                flex-direction: column;
                gap: 8px;
                border-bottom: none;
                padding-bottom: 0;
            }

            .tab {
                width: 100%;
                text-align: center;
                border-radius: 8px;
            }

            .key-value-row {
                flex-wrap: wrap;
            }

            /* Checkboxå’Œåˆ é™¤æŒ‰é’®æ”¾åœ¨åŒä¸€è¡Œ */
            .key-value-row input[type="checkbox"] {
                order: 1;
                flex-shrink: 0;
            }

            .key-value-row .delete-btn {
                order: 2;
                flex-shrink: 0;
                min-width: 60px;
                margin-left: auto;
            }

            /* è¾“å…¥æ¡†ç‹¬å ä¸€è¡Œ - é’ˆå¯¹æœ‰ autocomplete-wrapper çš„ï¼ˆHeadersï¼‰ */
            .key-value-row .autocomplete-wrapper {
                order: 3;
                flex: 1 1 100%;
                max-width: 100%;
                margin-top: 8px;
            }

            .key-value-row .autocomplete-wrapper.wide {
                order: 4;
                flex: 1 1 100%;
                max-width: 100%;
                margin-top: 8px;
            }

            /* å¦‚æœæ˜¯åœ¨ autocomplete-wrapper å†…çš„è¾“å…¥æ¡†ï¼Œä¿æŒ100%å®½åº¦ */
            .key-value-row .autocomplete-wrapper .key-input,
            .key-value-row .autocomplete-wrapper .value-input {
                width: 100%;
                order: initial;
                margin-top: 0;
            }

            /* å¦‚æœinputæ²¡æœ‰åŒ…è£¹åœ¨wrapperä¸­ï¼ˆParams, PathVarsï¼‰ */
            .key-value-row > .key-input {
                order: 3;
                flex: 1 1 100%;
                margin-top: 8px;
            }

            .key-value-row > .value-input {
                order: 4;
                flex: 1 1 100%;
                margin-top: 8px;
            }

            .response-status {
                flex-direction: column;
            }

            .status-item {
                min-width: 100%;
            }

            .history-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .clear-history-btn {
                width: 100%;
            }

            .history-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .history-item-header > div:first-child {
                width: 100%;
            }

            .history-item-url {
                width: 100%;
            }

            .history-item-actions {
                width: 100%;
                justify-content: space-between;
            }

            .body-type-select {
                flex-direction: column;
            }

            .body-type-option {
                text-align: center;
            }

            .autocomplete-wrapper {
                flex: 1 1 100%;
            }

            .autocomplete-suggestions {
                font-size: 0.9em;
                max-height: 150px;
            }

            .autocomplete-suggestion {
                padding: 8px 12px;
            }

            .auth-input, .auth-textarea, .auth-select {
                font-size: 0.95em;
            }

            .auth-textarea {
                min-height: 110px;
            }

            .auth-input-group {
                margin-bottom: 18px;
            }

            .auth-info-box, .auth-warning-box {
                padding: 13px 16px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5em;
            }

            .content {
                padding: 15px 12px;
            }

            .section-title {
                font-size: 1.1em;
            }

            textarea {
                min-height: 150px;
                font-size: 0.85em;
            }

            .response-content {
                font-size: 0.85em;
                max-height: 300px;
            }

            .autocomplete-wrapper {
                flex: 1 1 100%;
                max-width: 100%;
            }

            .autocomplete-wrapper.wide {
                flex: 1 1 100%;
                max-width: 100%;
            }

            .autocomplete-suggestions {
                font-size: 0.85em;
                max-height: 120px;
            }

            .autocomplete-suggestion {
                padding: 6px 10px;
            }

            .auth-input, .auth-textarea, .auth-select {
                font-size: 0.85em;
                padding: 10px 12px;
            }

            .auth-textarea {
                min-height: 100px;
            }

            .auth-input-group {
                margin-bottom: 12px;
            }

            .auth-input-group label {
                font-size: 0.9em;
                margin-bottom: 8px;
            }

            .auth-info-box, .auth-warning-box {
                padding: 10px 12px;
                margin-top: 15px;
            }

            .auth-info-box h4 {
                font-size: 0.9em;
            }

            .auth-info-box p, .auth-warning-box p {
                font-size: 0.85em;
            }

            .auth-type-selector {
                margin-bottom: 20px;
            }

            .modal-content {
                width: 95%;
                max-height: 90vh;
            }

            .modal-header {
                padding: 20px 15px;
            }

            .modal-header h2 {
                font-size: 1.3em;
            }

            .modal-body {
                padding: 20px 15px;
            }

            .modal-footer {
                padding: 15px;
                flex-direction: column;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ APIè°ƒè¯•å·¥å…·</h1>
            <p>å¼ºå¤§çš„HTTP APIæµ‹è¯•å·¥å…·ï¼Œæ”¯æŒå¤šç§è¯·æ±‚æ–¹æ³•å’Œå‚æ•°é…ç½®</p>
        </div>

        <div class="content">
            <div class="info-box">
                <h4>ğŸ“˜ ä½¿ç”¨è¯´æ˜</h4>
                <p>APIè°ƒè¯•å·¥å…·ï¼Œæ”¯æŒå‘é€HTTPè¯·æ±‚ã€é…ç½®è¯·æ±‚å¤´ã€å‚æ•°å’Œè¯·æ±‚ä½“ã€‚å¯ä»¥æµ‹è¯•RESTful APIã€æŸ¥çœ‹å“åº”ç»“æœï¼Œå¹¶è‡ªåŠ¨ä¿å­˜è¯·æ±‚å†å²è®°å½•ã€‚</p>
            </div>

            <!-- è¯·æ±‚é…ç½®åŒºåŸŸ -->
            <div class="section">
                <div class="section-title">ğŸ“¤ è¯·æ±‚é…ç½®</div>

                <div class="request-line">
                    <select id="httpMethod" class="method-select">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                        <option value="PATCH">PATCH</option>
                        <option value="HEAD">HEAD</option>
                        <option value="OPTIONS">OPTIONS</option>
                    </select>
                    <input type="text" id="apiUrl" class="url-input" placeholder="è¯·è¾“å…¥APIåœ°å€ï¼Œä¾‹å¦‚ï¼šhttps://api.example.com/users">
                    <button class="btn btn-primary" id="sendBtn" onclick="sendRequest()">å‘é€è¯·æ±‚</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary btn-small" onclick="openVariablesModal()">âš™ï¸ å…¨å±€å˜é‡</button>
                    <button class="btn btn-warning btn-small" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
                </div>
            </div>

            <!-- è¯·æ±‚å‚æ•°æ ‡ç­¾é¡µ -->
            <div class="section">
                <div class="tabs">
                    <div class="tab active" onclick="switchRequestTab('params')">Query Params</div>
                    <div class="tab" onclick="switchRequestTab('pathVars')">Path Variables</div>
                    <div class="tab" onclick="switchRequestTab('authorization')">Authorization</div>
                    <div class="tab" onclick="switchRequestTab('headers')">Headers</div>
                    <div class="tab" onclick="switchRequestTab('body')">Body</div>
                </div>

                <!-- Query Params -->
                <div id="params" class="tab-content active">
                    <div class="info-box" style="margin-bottom: 15px;">
                        <h4>ğŸ’¡ ä½¿ç”¨æç¤º</h4>
                        <p>åœ¨URLä¸­è¾“å…¥å¸¦æŸ¥è¯¢å‚æ•°çš„åœ°å€ä¼šè‡ªåŠ¨è§£æï¼ˆé¼ æ ‡ç¦»å¼€è¾“å…¥æ¡†åè§¦å‘ï¼‰ï¼Œä¾‹å¦‚ï¼š<br>
                        <code>https://api.example.com/users?id=123&name=John</code><br>
                        <code>/api/users?id=123&name=John</code> <br>
                        å‚æ•°å°†è‡ªåŠ¨æå–åˆ°ä¸‹æ–¹åˆ—è¡¨ï¼ŒURLä¿æŒä¸å˜ã€‚å‘é€è¯·æ±‚æ—¶ä¼šåˆå¹¶URLä¸­çš„å‚æ•°å’Œä¸‹æ–¹åˆ—è¡¨ä¸­çš„å‚æ•°ã€‚</p>
                    </div>
                    <div id="paramsList" class="key-value-list"></div>
                    <button class="btn btn-secondary btn-small" onclick="addParam()">â• æ·»åŠ å‚æ•°</button>
                </div>

                <!-- Path Variables -->
                <div id="pathVars" class="tab-content">
                    <div class="info-box" style="margin-bottom: 15px;">
                        <h4>ğŸ’¡ ä½¿ç”¨æç¤º</h4>
                        <p>åœ¨URLä¸­ä½¿ç”¨ <code>{å˜é‡å}</code> æˆ– <code>:å˜é‡å</code> æ ¼å¼å®šä¹‰è·¯å¾„å‚æ•°ï¼Œä¾‹å¦‚ï¼š<br>
                        <code>https://api.example.com/users/{userId}/posts/{postId}</code></p>
                        <p style="margin-top: 8px;">âš ï¸ æ³¨æ„ï¼š<code>{{å˜é‡å}}</code> æ ¼å¼æ˜¯å…¨å±€å˜é‡ï¼Œä¸ä¼šè¢«è¯†åˆ«ä¸ºè·¯å¾„å‚æ•°</p>
                    </div>
                    <div id="pathVarsList" class="key-value-list"></div>
                    <button class="btn btn-secondary btn-small" onclick="addPathVar()">â• æ·»åŠ è·¯å¾„å‚æ•°</button>
                </div>

                <!-- Authorization -->
                <div id="authorization" class="tab-content">
                    <div class="auth-type-selector">
                        <div class="input-group">
                            <label>ğŸ” è®¤è¯ç±»å‹</label>
                            <select id="authType" class="auth-select" onchange="switchAuthType()">
                                <option value="none">ğŸš« No Auth - æ— è®¤è¯</option>
                                <option value="bearer">ğŸ« Bearer Token</option>
                                <option value="basic">ğŸ”‘ Basic Auth</option>
                                <option value="apikey">ğŸ—ï¸ API Key</option>
                                <option value="digest">ğŸ” Digest Auth</option>
                                <option value="oauth2">ğŸŒ OAuth 2.0</option>
                            </select>
                        </div>
                    </div>

                    <!-- No Auth -->
                    <div id="authNone" class="auth-content active">
                        <div class="alert alert-info">
                            â„¹ï¸ å½“å‰è¯·æ±‚ä¸ä½¿ç”¨ä»»ä½•è®¤è¯æ–¹å¼
                        </div>
                    </div>

                    <!-- Bearer Token -->
                    <div id="authBearer" class="auth-content" style="display: none;">
                        <div class="auth-input-group">
                            <label>ğŸ« Token</label>
                            <textarea id="bearerToken" class="auth-textarea" placeholder="è¯·è¾“å…¥Bearer Tokenï¼Œä¾‹å¦‚ï¼š&#10;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"></textarea>
                        </div>
                        <div class="auth-info-box">
                            <h4>ğŸ“˜ Bearer Tokenè¯´æ˜</h4>
                            <p>Bearer Tokenæ˜¯æœ€å¸¸è§çš„APIè®¤è¯æ–¹å¼ï¼Œé€šå¸¸ç”¨äºJWTè®¤è¯ã€‚Tokenå°†è¢«è‡ªåŠ¨æ·»åŠ åˆ°è¯·æ±‚å¤´ï¼š<br>
                            <code>Authorization: Bearer {your_token}</code></p>
                        </div>
                    </div>

                    <!-- Basic Auth -->
                    <div id="authBasic" class="auth-content" style="display: none;">
                        <div class="auth-input-group">
                            <label>ğŸ‘¤ ç”¨æˆ·å</label>
                            <input type="text" id="basicUsername" class="auth-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                        </div>
                        <div class="auth-input-group">
                            <label>ğŸ”’ å¯†ç </label>
                            <input type="password" id="basicPassword" class="auth-input" placeholder="è¯·è¾“å…¥å¯†ç ">
                        </div>
                        <div class="auth-info-box">
                            <h4>ğŸ“˜ Basic Authè¯´æ˜</h4>
                            <p>Basic Authä½¿ç”¨Base64ç¼–ç çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯ã€‚å°†è¢«è‡ªåŠ¨æ·»åŠ åˆ°è¯·æ±‚å¤´ï¼š<br>
                            <code>Authorization: Basic {base64(username:password)}</code></p>
                        </div>
                    </div>

                    <!-- API Key -->
                    <div id="authApiKey" class="auth-content" style="display: none;">
                        <div class="auth-input-group">
                            <label>ğŸ“ Keyåç§°</label>
                            <input type="text" id="apiKeyName" class="auth-input" placeholder="ä¾‹å¦‚ï¼šX-API-Key, api_key, apikey" value="X-API-Key">
                        </div>
                        <div class="auth-input-group">
                            <label>ğŸ”‘ Keyå€¼</label>
                            <input type="text" id="apiKeyValue" class="auth-input" placeholder="è¯·è¾“å…¥API Key">
                        </div>
                        <div class="auth-input-group">
                            <label>ğŸ“ æ·»åŠ ä½ç½®</label>
                            <select id="apiKeyLocation" class="auth-select">
                                <option value="header">Headerï¼ˆè¯·æ±‚å¤´ï¼‰</option>
                                <option value="query">Query Paramsï¼ˆURLå‚æ•°ï¼‰</option>
                            </select>
                        </div>
                        <div class="auth-info-box">
                            <h4>ğŸ“˜ API Keyè¯´æ˜</h4>
                            <p>API Keyå¯ä»¥çµæ´»åœ°æ·»åŠ åˆ°è¯·æ±‚å¤´æˆ–URLå‚æ•°ä¸­ã€‚<br>
                            â€¢ <strong>Headeræ–¹å¼</strong>: <code>{key_name}: {key_value}</code><br>
                            â€¢ <strong>Queryæ–¹å¼</strong>: <code>?{key_name}={key_value}</code></p>
                        </div>
                    </div>

                    <!-- Digest Auth -->
                    <div id="authDigest" class="auth-content" style="display: none;">
                        <div class="auth-input-group">
                            <label>ğŸ‘¤ ç”¨æˆ·å</label>
                            <input type="text" id="digestUsername" class="auth-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                        </div>
                        <div class="auth-input-group">
                            <label>ğŸ”’ å¯†ç </label>
                            <input type="password" id="digestPassword" class="auth-input" placeholder="è¯·è¾“å…¥å¯†ç ">
                        </div>
                        <div class="auth-warning-box">
                            <p>âš ï¸ <strong>æ³¨æ„ï¼š</strong>Digest Authéœ€è¦æœåŠ¡å™¨è¿”å›401å“åº”å’Œchallengeä¿¡æ¯ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å¯èƒ½ä¸å®Œå…¨æ”¯æŒæ­¤è®¤è¯æ–¹å¼ã€‚</p>
                        </div>
                    </div>

                    <!-- OAuth 2.0 -->
                    <div id="authOAuth2" class="auth-content" style="display: none;">
                        <div class="auth-input-group">
                            <label>ğŸŒ Access Token</label>
                            <textarea id="oauth2Token" class="auth-textarea" placeholder="è¯·è¾“å…¥OAuth 2.0 Access Token&#10;ä¾‹å¦‚ï¼šya29.a0AfH6SMBx..."></textarea>
                        </div>
                        <div class="auth-input-group">
                            <label>ğŸ·ï¸ Tokenç±»å‹ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" id="oauth2TokenType" class="auth-input" placeholder="é»˜è®¤ä¸º Bearer" value="Bearer">
                        </div>
                        <div class="auth-info-box">
                            <h4>ğŸ“˜ OAuth 2.0è¯´æ˜</h4>
                            <p>OAuth 2.0æ˜¯ä¸€ä¸ªæˆæƒæ¡†æ¶ï¼Œå…è®¸åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·èµ„æºã€‚Access Tokenå°†è¢«æ·»åŠ åˆ°è¯·æ±‚å¤´ï¼š<br>
                            <code>Authorization: {token_type} {access_token}</code><br><br>
                            <strong>æ³¨æ„ï¼š</strong>å®Œæ•´çš„OAuth 2.0æˆæƒæµç¨‹ï¼ˆAuthorization Codeã€Implicitç­‰ï¼‰éœ€è¦åœ¨æœåŠ¡ç«¯å®Œæˆï¼Œæ­¤å¤„ä»…æ”¯æŒä½¿ç”¨å·²è·å–çš„Access Tokenã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- Headers -->
                <div id="headers" class="tab-content">
                    <div id="headersList" class="key-value-list"></div>
                    <button class="btn btn-secondary btn-small" onclick="addHeader()">â• æ·»åŠ è¯·æ±‚å¤´</button>
                </div>

                <!-- Body -->
                <div id="body" class="tab-content">
                    <div class="body-type-select">
                        <div class="body-type-option active" onclick="switchBodyType('none')">None</div>
                        <div class="body-type-option" onclick="switchBodyType('json')">JSON</div>
                        <div class="body-type-option" onclick="switchBodyType('form')">Form Data</div>
                        <div class="body-type-option" onclick="switchBodyType('text')">Raw Text</div>
                    </div>

                    <div id="bodyNone" class="body-content active">
                        <div class="alert alert-info">å½“å‰è¯·æ±‚ä¸åŒ…å«Bodyå†…å®¹</div>
                    </div>

                    <div id="bodyJson" class="body-content" style="display: none;">
                        <textarea id="jsonBody" placeholder='è¯·è¾“å…¥JSONæ ¼å¼çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š&#10;{&#10;  "name": "John Doe",&#10;  "email": "john@example.com"&#10;}'></textarea>
                    </div>

                    <div id="bodyForm" class="body-content" style="display: none;">
                        <div id="formDataList" class="key-value-list"></div>
                        <button class="btn btn-secondary btn-small" onclick="addFormData()">â• æ·»åŠ å­—æ®µ</button>
                    </div>

                    <div id="bodyText" class="body-content" style="display: none;">
                        <textarea id="textBody" placeholder="è¯·è¾“å…¥çº¯æ–‡æœ¬å†…å®¹..."></textarea>
                    </div>
                </div>
            </div>

            <!-- å“åº”åŒºåŸŸ -->
            <div id="responseSection" class="response-section">
                <div class="section-title">ğŸ“¥ å“åº”ç»“æœ</div>

                <div class="response-status" id="responseStatus"></div>

                <div class="tabs">
                    <div class="tab active" onclick="switchResponseTab('responseBody')">Response Body</div>
                    <div class="tab" onclick="switchResponseTab('responseHeaders')">Response Headers</div>
                </div>

                <div id="responseBody" class="tab-content active">
                    <div class="response-box">
                        <h3>å“åº”å†…å®¹</h3>
                        <button class="copy-btn" onclick="copyResponse('responseContent')">ğŸ“‹ å¤åˆ¶</button>
                        <div id="responseContent" class="response-content"></div>
                    </div>
                </div>

                <div id="responseHeaders" class="tab-content">
                    <div class="response-box">
                        <h3>å“åº”å¤´</h3>
                        <button class="copy-btn" onclick="copyResponse('responseHeadersContent')">ğŸ“‹ å¤åˆ¶</button>
                        <div id="responseHeadersContent" class="response-content"></div>
                    </div>
                </div>
            </div>

            <!-- å†å²è®°å½• -->
            <div class="history-section">
                <div class="history-header">
                    <h3>ğŸ“œ è¯·æ±‚å†å²</h3>
                    <button class="clear-history-btn" onclick="clearHistory()">æ¸…ç©ºå†å²</button>
                </div>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>

        <!-- å…¨å±€å˜é‡ç®¡ç†å¼¹çª— -->
        <div id="variablesModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>âš™ï¸ å…¨å±€å˜é‡ç®¡ç†</h2>
                    <button class="modal-close" onclick="closeVariablesModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="info-box" style="margin-bottom: 20px;">
                        <h4>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
                        <p>â€¢ ä½¿ç”¨ <code>{{å˜é‡å}}</code> æ ¼å¼åœ¨ä»»ä½•è¾“å…¥æ¡†ä¸­å¼•ç”¨å˜é‡<br>
                        â€¢ æ”¯æŒåœ¨URLã€å‚æ•°ã€Headersã€Bodyç­‰ä½ç½®ä½¿ç”¨<br>
                        â€¢ ä¾‹å¦‚ï¼šURLè¾“å…¥ <code>{{baseUrl}}/users/{{userId}}</code></p>
                    </div>
                    <div id="variablesList" class="key-value-list"></div>
                    <button class="btn btn-secondary btn-small" onclick="addVariable()">â• æ·»åŠ å˜é‡</button>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="saveVariables()">ğŸ’¾ ä¿å­˜</button>
                    <button class="btn btn-secondary" onclick="closeVariablesModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentBodyType = 'none';
        let paramsCount = 0;
        let pathVarsCount = 0;
        let headersCount = 0;
        let formDataCount = 0;
        let variablesCount = 0;
        let isLoadingHistory = false; // æ ‡å¿—ä½ï¼šæ˜¯å¦æ­£åœ¨åŠ è½½å†å²è®°å½•
        let globalVariables = {}; // å…¨å±€å˜é‡å­˜å‚¨

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addParam();
            addHeader();
            loadHistory();
            loadGlobalVariables();
            initVariableHints();

            // ç›‘å¬URLå˜åŒ–ï¼Œé¼ æ ‡ç¦»å¼€æ—¶è‡ªåŠ¨æ£€æµ‹è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°
            const urlInput = document.getElementById('apiUrl');
            urlInput.addEventListener('blur', function() {
                // å¦‚æœæ­£åœ¨åŠ è½½å†å²è®°å½•ï¼Œä¸è‡ªåŠ¨è§£æ
                if (isLoadingHistory) return;

                autoDetectPathVariables();
                autoDetectQueryParams();
            });
        });

        // ==================== å…¨å±€å˜é‡ç®¡ç† ====================

        // åŠ è½½å…¨å±€å˜é‡
        function loadGlobalVariables() {
            const stored = localStorage.getItem('api_global_variables');
            if (stored) {
                try {
                    globalVariables = JSON.parse(stored);
                } catch (e) {
                    globalVariables = {};
                }
            }
        }

        // ä¿å­˜å…¨å±€å˜é‡åˆ°localStorage
        function saveGlobalVariablesToStorage() {
            localStorage.setItem('api_global_variables', JSON.stringify(globalVariables));
        }

        // æ‰“å¼€å˜é‡ç®¡ç†å¼¹çª—
        function openVariablesModal() {
            const modal = document.getElementById('variablesModal');
            modal.classList.add('show');

            // åŠ è½½å˜é‡åˆ°åˆ—è¡¨
            const variablesList = document.getElementById('variablesList');
            variablesList.innerHTML = '';
            variablesCount = 0;

            Object.entries(globalVariables).forEach(([key, value]) => {
                addVariable(key, value);
            });

            // å¦‚æœæ²¡æœ‰å˜é‡ï¼Œæ·»åŠ ä¸€ä¸ªç©ºè¡Œ
            if (Object.keys(globalVariables).length === 0) {
                addVariable();
            }
        }

        // å…³é—­å˜é‡ç®¡ç†å¼¹çª—
        function closeVariablesModal() {
            const modal = document.getElementById('variablesModal');
            modal.classList.remove('show');
        }

        // æ·»åŠ å˜é‡è¡Œ
        function addVariable(key = '', value = '') {
            const id = variablesCount++;
            const html = `
                <div class="key-value-row" id="variable-${id}">
                    <input type="text" class="key-input" placeholder="å˜é‡å" value="${escapeHtml(key)}">
                    <input type="text" class="value-input" placeholder="å˜é‡å€¼" value="${escapeHtml(value)}">
                    <button class="delete-btn" onclick="deleteRow('variable-${id}')">åˆ é™¤</button>
                </div>
            `;
            document.getElementById('variablesList').insertAdjacentHTML('beforeend', html);
        }

        // ä¿å­˜å˜é‡
        function saveVariables() {
            const variablesList = document.getElementById('variablesList');
            const rows = variablesList.querySelectorAll('.key-value-row');
            const newVariables = {};

            rows.forEach(row => {
                const keyInput = row.querySelector('.key-input');
                const valueInput = row.querySelector('.value-input');
                const key = keyInput ? keyInput.value.trim() : '';
                const value = valueInput ? valueInput.value.trim() : '';

                if (key) {
                    newVariables[key] = value;
                }
            });

            globalVariables = newVariables;
            saveGlobalVariablesToStorage();
            closeVariablesModal();
        }

        // æ›¿æ¢æ–‡æœ¬ä¸­çš„å˜é‡
        function replaceVariables(text) {
            if (!text) return text;

            // åŒ¹é… {{variableName}} æ ¼å¼
            return text.replace(/\{\{([^}]+)\}\}/g, (match, varName) => {
                const trimmedName = varName.trim();
                if (globalVariables.hasOwnProperty(trimmedName)) {
                    return globalVariables[trimmedName];
                }
                return match; // å¦‚æœå˜é‡ä¸å­˜åœ¨ï¼Œä¿æŒåŸæ ·
            });
        }

        // åˆå§‹åŒ–å˜é‡æç¤ºåŠŸèƒ½
        function initVariableHints() {
            // ä¸ºæ‰€æœ‰æ–‡æœ¬è¾“å…¥æ¡†æ·»åŠ å˜é‡æç¤º
            const inputSelectors = [
                '#apiUrl',
                '.key-input',
                '.value-input',
                '#bearerToken',
                '#basicUsername',
                '#basicPassword',
                '#apiKeyName',
                '#apiKeyValue',
                '#oauth2Token',
                '#oauth2TokenType',
                '#jsonBody',
                '#textBody'
            ];

            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ¥å¤„ç†åŠ¨æ€æ·»åŠ çš„è¾“å…¥æ¡†
            document.addEventListener('input', function(e) {
                const target = e.target;

                // æ£€æŸ¥æ˜¯å¦æ˜¯ç›¸å…³çš„è¾“å…¥æ¡†
                const isRelevantInput = inputSelectors.some(selector => {
                    if (selector.startsWith('#')) {
                        return target.id === selector.substring(1);
                    } else {
                        return target.classList.contains(selector.substring(1));
                    }
                });

                if (isRelevantInput) {
                    handleVariableHint(target);
                }
            });
        }

        // å¤„ç†å˜é‡æç¤º
        function handleVariableHint(input) {
            const value = input.value;
            const cursorPos = input.selectionStart;

            // æŸ¥æ‰¾æœ€è¿‘çš„ {{ ä½ç½®
            const textBeforeCursor = value.substring(0, cursorPos);
            const lastBracePos = textBeforeCursor.lastIndexOf('{{');

            if (lastBracePos !== -1) {
                // æ£€æŸ¥åœ¨ {{ ä¹‹åæ˜¯å¦æœ‰ }}
                const textAfterBrace = textBeforeCursor.substring(lastBracePos + 2);
                const hasClosingBrace = textAfterBrace.indexOf('}}') !== -1;

                if (!hasClosingBrace) {
                    // æ˜¾ç¤ºå˜é‡æç¤º
                    const searchTerm = textAfterBrace.toLowerCase();
                    showVariableHints(input, searchTerm);
                    return;
                }
            }

            // éšè—æç¤º
            hideVariableHints();
        }

        // æ˜¾ç¤ºå˜é‡æç¤º
        function showVariableHints(input, searchTerm) {
            const variables = Object.keys(globalVariables).filter(key =>
                key.toLowerCase().includes(searchTerm)
            );

            if (variables.length === 0) {
                hideVariableHints();
                return;
            }

            // åˆ›å»ºæˆ–è·å–æç¤ºæ¡†
            let hintBox = document.getElementById('variableHintBox');
            if (!hintBox) {
                hintBox = document.createElement('div');
                hintBox.id = 'variableHintBox';
                hintBox.className = 'variable-hint';
                document.body.appendChild(hintBox);
            }

            // å¡«å……æç¤ºå†…å®¹
            hintBox.innerHTML = variables.map(key => `
                <div class="variable-hint-item" onclick="insertVariable('${key}')">
                    <span class="variable-hint-key">${escapeHtml(key)}</span>
                    <span class="variable-hint-value">${escapeHtml(globalVariables[key])}</span>
                </div>
            `).join('');

            // å®šä½æç¤ºæ¡†
            const rect = input.getBoundingClientRect();
            hintBox.style.position = 'fixed';
            hintBox.style.left = rect.left + 'px';
            hintBox.style.top = (rect.bottom + 5) + 'px';
            hintBox.classList.add('show');

            // ä¿å­˜å½“å‰è¾“å…¥æ¡†çš„å¼•ç”¨
            hintBox.dataset.targetInput = input.id || input.className;
            window.currentHintInput = input;
        }

        // éšè—å˜é‡æç¤º
        function hideVariableHints() {
            const hintBox = document.getElementById('variableHintBox');
            if (hintBox) {
                hintBox.classList.remove('show');
            }
        }

        // æ’å…¥å˜é‡
        function insertVariable(varName) {
            const input = window.currentHintInput;
            if (!input) {
                hideVariableHints();
                return;
            }

            const value = input.value;
            const cursorPos = input.selectionStart;
            const textBeforeCursor = value.substring(0, cursorPos);
            const textAfterCursor = value.substring(cursorPos);

            // æŸ¥æ‰¾æœ€è¿‘çš„ {{ ä½ç½®
            const lastBracePos = textBeforeCursor.lastIndexOf('{{');

            if (lastBracePos !== -1) {
                const newValue =
                    value.substring(0, lastBracePos) +
                    '{{' + varName + '}}' +
                    textAfterCursor;

                input.value = newValue;
                const newCursorPos = lastBracePos + varName.length + 4; // {{varName}}
                input.setSelectionRange(newCursorPos, newCursorPos);
                input.focus();
            }

            hideVariableHints();
        }

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—æç¤º
        document.addEventListener('click', function(e) {
            const hintBox = document.getElementById('variableHintBox');
            if (hintBox && !hintBox.contains(e.target)) {
                hideVariableHints();
            }
        });

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­å¼¹çª—
        document.getElementById('variablesModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeVariablesModal();
            }
        });

        // åˆ‡æ¢è¯·æ±‚æ ‡ç­¾é¡µ
        function switchRequestTab(tabName) {
            document.querySelectorAll('#params, #pathVars, #authorization, #headers, #body').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // åˆ‡æ¢è®¤è¯ç±»å‹
        function switchAuthType() {
            const authType = document.getElementById('authType').value;

            document.querySelectorAll('.auth-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            const contentMap = {
                'none': 'authNone',
                'bearer': 'authBearer',
                'basic': 'authBasic',
                'apikey': 'authApiKey',
                'digest': 'authDigest',
                'oauth2': 'authOAuth2'
            };

            const targetContent = document.getElementById(contentMap[authType]);
            if (targetContent) {
                targetContent.classList.add('active');
                targetContent.style.display = 'block';
            }
        }

        // åˆ‡æ¢å“åº”æ ‡ç­¾é¡µ
        function switchResponseTab(tabName) {
            document.querySelectorAll('#responseBody, #responseHeaders').forEach(tab => {
                tab.classList.remove('active');
            });

            const tabs = document.querySelector('#responseSection .tabs').children;
            Array.from(tabs).forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // åˆ‡æ¢Bodyç±»å‹
        function switchBodyType(type) {
            currentBodyType = type;

            document.querySelectorAll('.body-type-option').forEach(opt => {
                opt.classList.remove('active');
            });
            event.target.classList.add('active');

            document.querySelectorAll('.body-content').forEach(content => {
                content.style.display = 'none';
            });

            const contentMap = {
                'none': 'bodyNone',
                'json': 'bodyJson',
                'form': 'bodyForm',
                'text': 'bodyText'
            };

            document.getElementById(contentMap[type]).style.display = 'block';

            // å¦‚æœæ˜¯formç±»å‹ä¸”æ²¡æœ‰å­—æ®µï¼Œæ·»åŠ ä¸€ä¸ª
            if (type === 'form' && formDataCount === 0) {
                addFormData();
            }
        }

        // æ·»åŠ Queryå‚æ•°
        function addParam() {
            const id = paramsCount++;
            const html = `
                <div class="key-value-row" id="param-${id}">
                    <input type="checkbox" checked>
                    <input type="text" class="key-input" placeholder="å‚æ•°å">
                    <input type="text" class="value-input" placeholder="å‚æ•°å€¼">
                    <button class="delete-btn" onclick="deleteRow('param-${id}')">åˆ é™¤</button>
                </div>
            `;
            document.getElementById('paramsList').insertAdjacentHTML('beforeend', html);
        }

        // æ·»åŠ Path Variable
        function addPathVar(varName = '', varValue = '') {
            const id = pathVarsCount++;
            const html = `
                <div class="key-value-row" id="pathvar-${id}">
                    <input type="checkbox" checked>
                    <input type="text" class="key-input" placeholder="å˜é‡å" value="${varName}">
                    <input type="text" class="value-input" placeholder="å˜é‡å€¼" value="${varValue}">
                    <button class="delete-btn" onclick="deleteRow('pathvar-${id}')">åˆ é™¤</button>
                </div>
            `;
            document.getElementById('pathVarsList').insertAdjacentHTML('beforeend', html);
        }

        // è‡ªåŠ¨æ£€æµ‹URLä¸­çš„è·¯å¾„å‚æ•°
        function autoDetectPathVariables() {
            const url = document.getElementById('apiUrl').value;
            const pathVarsList = document.getElementById('pathVarsList');

            // å¦‚æœURLä¸ºç©ºï¼Œæ¸…ç©ºè·¯å¾„å˜é‡åˆ—è¡¨
            if (!url) {
                pathVarsList.innerHTML = '';
                pathVarsCount = 0;
                return;
            }

            // åŒ¹é… {variable} æˆ– :variable æ ¼å¼
            // æ³¨æ„ï¼šæ’é™¤ {{variable}} æ ¼å¼ï¼ˆå…¨å±€å˜é‡ï¼‰
            const curlyBracePattern = /(?<!\{)\{([^}]+)\}(?!\})/g;  // {variable} ä½†ä¸æ˜¯ {{variable}}
            const colonPattern = /:([a-zA-Z_][a-zA-Z0-9_]*)/g;

            const detectedVars = new Set();

            // æ£€æµ‹ {variable} æ ¼å¼ï¼ˆæ’é™¤å…¨å±€å˜é‡ {{variable}}ï¼‰
            let match;
            while ((match = curlyBracePattern.exec(url)) !== null) {
                detectedVars.add(match[1]);
            }

            // æ£€æµ‹ :variable æ ¼å¼
            while ((match = colonPattern.exec(url)) !== null) {
                detectedVars.add(match[1]);
            }

            // è·å–å½“å‰å·²æœ‰çš„å˜é‡
            const existingVars = new Set();
            const rows = pathVarsList.querySelectorAll('.key-value-row');
            rows.forEach(row => {
                const keyInput = row.querySelector('.key-input');
                if (keyInput && keyInput.value.trim()) {
                    existingVars.add(keyInput.value.trim());
                }
            });

            // æ·»åŠ æ–°æ£€æµ‹åˆ°çš„å˜é‡
            detectedVars.forEach(varName => {
                if (!existingVars.has(varName)) {
                    addPathVar(varName, '');
                }
            });

            // å¦‚æœæ£€æµ‹åˆ°è·¯å¾„å‚æ•°ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°Path Variablesæ ‡ç­¾
            if (detectedVars.size > 0 && pathVarsList.querySelectorAll('.key-value-row').length > 0) {
                // ä¸è‡ªåŠ¨åˆ‡æ¢ï¼Œåªåœ¨æ§åˆ¶å°æç¤º
                // console.log('æ£€æµ‹åˆ°è·¯å¾„å‚æ•°:', Array.from(detectedVars));
            }
        }

        // è‡ªåŠ¨æ£€æµ‹URLä¸­çš„æŸ¥è¯¢å‚æ•°
        function autoDetectQueryParams() {
            const url = document.getElementById('apiUrl').value.trim();
            const paramsList = document.getElementById('paramsList');

            // å¦‚æœURLä¸ºç©ºï¼Œæ¸…ç©ºå‚æ•°åˆ—è¡¨
            if (!url) {
                paramsList.innerHTML = '';
                paramsCount = 0;
                addParam(); // æ·»åŠ ä¸€ä¸ªç©ºè¡Œ
                return;
            }

            // ç›´æ¥æŸ¥æ‰¾ ? åé¢çš„å‚æ•°ï¼Œä¸éªŒè¯URLæ˜¯å¦åˆæ³•
            const questionMarkIndex = url.indexOf('?');
            if (questionMarkIndex === -1) {
                // æ²¡æœ‰æŸ¥è¯¢å‚æ•°
                return;
            }

            const queryString = url.substring(questionMarkIndex + 1);
            if (!queryString) {
                // æŸ¥è¯¢å­—ç¬¦ä¸²ä¸ºç©º
                return;
            }

            // æ‰‹åŠ¨è§£ææŸ¥è¯¢å‚æ•°
            const searchParams = new URLSearchParams(queryString);

            // è·å–å½“å‰å·²æœ‰çš„å‚æ•°
            const existingParams = new Map();
            const rows = paramsList.querySelectorAll('.key-value-row');
            rows.forEach(row => {
                const keyInput = row.querySelector('.key-input');
                const valueInput = row.querySelector('.value-input');
                if (keyInput && keyInput.value.trim()) {
                    existingParams.set(keyInput.value.trim(), valueInput ? valueInput.value : '');
                }
            });

            // æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„å‚æ•°éœ€è¦æ·»åŠ 
            let hasNewParams = false;
            const newParams = [];

            searchParams.forEach((value, key) => {
                if (!existingParams.has(key)) {
                    newParams.push({ key, value });
                    hasNewParams = true;
                } else if (existingParams.get(key) !== value) {
                    // å¦‚æœå‚æ•°å­˜åœ¨ä½†å€¼ä¸åŒï¼Œæ›´æ–°å€¼
                    rows.forEach(row => {
                        const keyInput = row.querySelector('.key-input');
                        const valueInput = row.querySelector('.value-input');
                        if (keyInput && keyInput.value.trim() === key && valueInput) {
                            valueInput.value = value;
                        }
                    });
                }
            });

            // æ·»åŠ æ–°æ£€æµ‹åˆ°çš„å‚æ•°
            if (hasNewParams) {
                // æ¸…ç©ºç¬¬ä¸€è¡Œç©ºå‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                if (rows.length === 1) {
                    const firstRow = rows[0];
                    const keyInput = firstRow.querySelector('.key-input');
                    const valueInput = firstRow.querySelector('.value-input');
                    if (keyInput && valueInput && !keyInput.value.trim() && !valueInput.value.trim()) {
                        // ç¬¬ä¸€è¡Œæ˜¯ç©ºçš„ï¼Œç§»é™¤å®ƒ
                        firstRow.remove();
                    }
                }

                // æ·»åŠ æ–°å‚æ•°
                newParams.forEach(param => {
                    addParam();
                    const lastRow = paramsList.querySelector('.key-value-row:last-child');
                    if (lastRow) {
                        const keyInput = lastRow.querySelector('.key-input');
                        const valueInput = lastRow.querySelector('.value-input');
                        if (keyInput && valueInput) {
                            keyInput.value = param.key;
                            valueInput.value = param.value;
                        }
                    }
                });
            }
        }

        // å¸¸è§çš„Headeré…ç½®
        const commonHeaders = {
            'Content-Type': [
                'application/json',
                'application/xml',
                'application/x-www-form-urlencoded',
                'multipart/form-data',
                'text/plain',
                'text/html',
                'text/xml'
            ],
            'Accept': [
                'application/json',
                'application/xml',
                'text/html',
                'text/plain',
                '*/*'
            ],
            'Authorization': [
                'Bearer <token>',
                'Basic <credentials>',
                'API-Key <key>'
            ],
            'User-Agent': [
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                'PostmanRuntime/7.28.0',
                'curl/7.68.0'
            ],
            'Accept-Language': [
                'zh-CN,zh;q=0.9,en;q=0.8',
                'en-US,en;q=0.9',
                'zh-CN'
            ],
            'Accept-Encoding': [
                'gzip, deflate, br',
                'gzip, deflate',
                'identity'
            ],
            'Cache-Control': [
                'no-cache',
                'no-store',
                'max-age=0',
                'must-revalidate'
            ],
            'Connection': [
                'keep-alive',
                'close'
            ],
            'Cookie': [''],
            'Origin': [''],
            'Referer': [''],
            'X-Requested-With': ['XMLHttpRequest'],
            'X-API-Key': [''],
            'X-Auth-Token': ['']
        };

        // æ·»åŠ Header
        function addHeader() {
            const id = headersCount++;
            const html = `
                <div class="key-value-row" id="header-${id}">
                    <input type="checkbox" checked>
                    <div class="autocomplete-wrapper">
                        <input type="text" class="key-input" placeholder="Headeråç§°"
                               autocomplete="off"
                               data-header-id="${id}"
                               onfocus="showHeaderSuggestions(${id})"
                               oninput="filterHeaderSuggestions(${id})"
                               onblur="hideHeaderSuggestions(${id}, 200)">
                        <div class="autocomplete-suggestions" id="headerNameSuggestions-${id}"></div>
                    </div>
                    <div class="autocomplete-wrapper wide">
                        <input type="text" class="value-input" placeholder="Headerå€¼"
                               autocomplete="off"
                               data-header-id="${id}"
                               onfocus="showHeaderValueSuggestions(${id})"
                               oninput="filterHeaderValueSuggestions(${id})"
                               onblur="hideHeaderValueSuggestions(${id}, 200)">
                        <div class="autocomplete-suggestions" id="headerValueSuggestions-${id}"></div>
                    </div>
                    <button class="delete-btn" onclick="deleteRow('header-${id}')">åˆ é™¤</button>
                </div>
            `;
            document.getElementById('headersList').insertAdjacentHTML('beforeend', html);
        }

        // æ˜¾ç¤ºHeaderåç§°å»ºè®®
        function showHeaderSuggestions(headerId) {
            const suggestions = document.getElementById(`headerNameSuggestions-${headerId}`);
            if (!suggestions) return;

            const headerNames = Object.keys(commonHeaders);
            suggestions.innerHTML = headerNames
                .map(name => `<div class="autocomplete-suggestion" onclick="selectHeaderName(${headerId}, '${name}')">${name}</div>`)
                .join('');
            suggestions.classList.add('show');
        }

        // è¿‡æ»¤Headeråç§°å»ºè®®
        function filterHeaderSuggestions(headerId) {
            const row = document.getElementById(`header-${headerId}`);
            if (!row) return;

            const input = row.querySelector('.key-input');
            const suggestions = document.getElementById(`headerNameSuggestions-${headerId}`);
            if (!input || !suggestions) return;

            const filter = input.value.toLowerCase();
            const headerNames = Object.keys(commonHeaders).filter(name =>
                name.toLowerCase().includes(filter)
            );

            if (headerNames.length > 0 && filter) {
                suggestions.innerHTML = headerNames
                    .map(name => `<div class="autocomplete-suggestion" onclick="selectHeaderName(${headerId}, '${name}')">${name}</div>`)
                    .join('');
                suggestions.classList.add('show');
            } else if (filter) {
                suggestions.classList.remove('show');
            } else {
                showHeaderSuggestions(headerId);
            }
        }

        // éšè—Headeråç§°å»ºè®®
        function hideHeaderSuggestions(headerId, delay = 0) {
            setTimeout(() => {
                const suggestions = document.getElementById(`headerNameSuggestions-${headerId}`);
                if (suggestions) {
                    suggestions.classList.remove('show');
                }
            }, delay);
        }

        // é€‰æ‹©Headeråç§°
        function selectHeaderName(headerId, name) {
            const row = document.getElementById(`header-${headerId}`);
            if (!row) return;

            const input = row.querySelector('.key-input');
            if (input) {
                input.value = name;
                hideHeaderSuggestions(headerId);
                // è‡ªåŠ¨æ˜¾ç¤ºå¯¹åº”çš„å€¼å»ºè®®
                setTimeout(() => {
                    const valueInput = row.querySelector('.value-input');
                    if (valueInput) {
                        valueInput.focus();
                        showHeaderValueSuggestions(headerId);
                    }
                }, 100);
            }
        }

        // æ˜¾ç¤ºHeaderå€¼å»ºè®®
        function showHeaderValueSuggestions(headerId) {
            const row = document.getElementById(`header-${headerId}`);
            if (!row) return;

            const keyInput = row.querySelector('.key-input');
            const suggestions = document.getElementById(`headerValueSuggestions-${headerId}`);
            if (!keyInput || !suggestions) return;

            const headerName = keyInput.value.trim();

            if (commonHeaders[headerName] && commonHeaders[headerName].length > 0) {
                suggestions.innerHTML = commonHeaders[headerName]
                    .map(value => {
                        const escapedValue = value.replace(/'/g, "\\'");
                        return `<div class="autocomplete-suggestion" onclick="selectHeaderValue(${headerId}, '${escapedValue}')">${value}</div>`;
                    })
                    .join('');
                suggestions.classList.add('show');
            } else {
                suggestions.classList.remove('show');
            }
        }

        // è¿‡æ»¤Headerå€¼å»ºè®®
        function filterHeaderValueSuggestions(headerId) {
            const row = document.getElementById(`header-${headerId}`);
            if (!row) return;

            const keyInput = row.querySelector('.key-input');
            const valueInput = row.querySelector('.value-input');
            const suggestions = document.getElementById(`headerValueSuggestions-${headerId}`);
            if (!keyInput || !valueInput || !suggestions) return;

            const headerName = keyInput.value.trim();
            const filter = valueInput.value.toLowerCase();

            if (commonHeaders[headerName]) {
                const filteredValues = commonHeaders[headerName].filter(value =>
                    value.toLowerCase().includes(filter)
                );

                if (filteredValues.length > 0 && filter) {
                    suggestions.innerHTML = filteredValues
                        .map(value => {
                            const escapedValue = value.replace(/'/g, "\\'");
                            return `<div class="autocomplete-suggestion" onclick="selectHeaderValue(${headerId}, '${escapedValue}')">${value}</div>`;
                        })
                        .join('');
                    suggestions.classList.add('show');
                } else if (!filter) {
                    showHeaderValueSuggestions(headerId);
                } else {
                    suggestions.classList.remove('show');
                }
            }
        }

        // éšè—Headerå€¼å»ºè®®
        function hideHeaderValueSuggestions(headerId, delay = 0) {
            setTimeout(() => {
                const suggestions = document.getElementById(`headerValueSuggestions-${headerId}`);
                if (suggestions) {
                    suggestions.classList.remove('show');
                }
            }, delay);
        }

        // é€‰æ‹©Headerå€¼
        function selectHeaderValue(headerId, value) {
            const row = document.getElementById(`header-${headerId}`);
            if (!row) return;

            const input = row.querySelector('.value-input');
            if (input) {
                input.value = value;
                hideHeaderValueSuggestions(headerId);
            }
        }

        // æ·»åŠ Form Data
        function addFormData() {
            const id = formDataCount++;
            const html = `
                <div class="key-value-row" id="formdata-${id}">
                    <input type="checkbox" checked>
                    <input type="text" class="key-input" placeholder="å­—æ®µå">
                    <input type="text" class="value-input" placeholder="å­—æ®µå€¼">
                    <button class="delete-btn" onclick="deleteRow('formdata-${id}')">åˆ é™¤</button>
                </div>
            `;
            document.getElementById('formDataList').insertAdjacentHTML('beforeend', html);
        }

        // åˆ é™¤è¡Œ
        function deleteRow(id) {
            document.getElementById(id).remove();
        }

        // è·å–é”®å€¼å¯¹æ•°æ®ï¼ˆä»…é€‰ä¸­çš„ï¼‰
        function getKeyValueData(containerId) {
            const container = document.getElementById(containerId);
            const rows = container.querySelectorAll('.key-value-row');
            const data = {};

            rows.forEach(row => {
                const checkbox = row.querySelector('input[type="checkbox"]');
                const keyInput = row.querySelector('.key-input');
                const valueInput = row.querySelector('.value-input');

                if (checkbox.checked && keyInput.value.trim()) {
                    data[keyInput.value.trim()] = valueInput.value.trim();
                }
            });

            return data;
        }

        // è·å–æ‰€æœ‰é”®å€¼å¯¹æ•°æ®ï¼ˆåŒ…æ‹¬æœªé€‰ä¸­çš„ï¼‰
        function getAllKeyValueData(containerId) {
            const container = document.getElementById(containerId);
            const rows = container.querySelectorAll('.key-value-row');
            const data = [];

            rows.forEach(row => {
                const checkbox = row.querySelector('input[type="checkbox"]');
                const keyInput = row.querySelector('.key-input');
                const valueInput = row.querySelector('.value-input');

                const key = keyInput ? keyInput.value.trim() : '';
                const value = valueInput ? valueInput.value.trim() : '';

                if (key || value) { // åªä¿å­˜æœ‰å†…å®¹çš„è¡Œ
                    data.push({
                        enabled: checkbox ? checkbox.checked : true,
                        key: key,
                        value: value
                    });
                }
            });

            return data;
        }

        // åº”ç”¨è®¤è¯ä¿¡æ¯
        function applyAuthorization(headers, urlObj) {
            const authType = document.getElementById('authType').value;

            switch (authType) {
                case 'bearer':
                    const bearerToken = replaceVariables(document.getElementById('bearerToken').value.trim());
                    if (bearerToken) {
                        headers['Authorization'] = `Bearer ${bearerToken}`;
                    }
                    break;

                case 'basic':
                    const basicUsername = replaceVariables(document.getElementById('basicUsername').value);
                    const basicPassword = replaceVariables(document.getElementById('basicPassword').value);
                    if (basicUsername || basicPassword) {
                        const credentials = btoa(`${basicUsername}:${basicPassword}`);
                        headers['Authorization'] = `Basic ${credentials}`;
                    }
                    break;

                case 'apikey':
                    const apiKeyName = replaceVariables(document.getElementById('apiKeyName').value.trim());
                    const apiKeyValue = replaceVariables(document.getElementById('apiKeyValue').value.trim());
                    const apiKeyLocation = document.getElementById('apiKeyLocation').value;

                    if (apiKeyName && apiKeyValue) {
                        if (apiKeyLocation === 'header') {
                            headers[apiKeyName] = apiKeyValue;
                        } else {
                            urlObj.searchParams.append(apiKeyName, apiKeyValue);
                        }
                    }
                    break;

                case 'digest':
                    // Digest Authåœ¨æµè§ˆå™¨ä¸­éœ€è¦æœåŠ¡å™¨challengeï¼Œæš‚ä¸å®Œå…¨æ”¯æŒ
                    const digestUsername = replaceVariables(document.getElementById('digestUsername').value);
                    const digestPassword = replaceVariables(document.getElementById('digestPassword').value);
                    if (digestUsername) {
                        // æ ‡è®°ä½¿ç”¨Digest Authï¼ˆå®é™…å¤„ç†éœ€è¦æœåŠ¡å™¨é…åˆï¼‰
                        console.log('Digest Authéœ€è¦æœåŠ¡å™¨è¿”å›401 challenge');
                    }
                    break;

                case 'oauth2':
                    const oauth2Token = replaceVariables(document.getElementById('oauth2Token').value.trim());
                    const oauth2TokenType = replaceVariables(document.getElementById('oauth2TokenType').value.trim()) || 'Bearer';
                    if (oauth2Token) {
                        headers['Authorization'] = `${oauth2TokenType} ${oauth2Token}`;
                    }
                    break;

                case 'none':
                default:
                    // ä¸æ·»åŠ è®¤è¯ä¿¡æ¯
                    break;
            }
        }

        // å‘é€è¯·æ±‚
        async function sendRequest() {
            const originalUrl = document.getElementById('apiUrl').value.trim(); // ä¿å­˜åŸå§‹URL
            let url = replaceVariables(originalUrl); // æ›¿æ¢å…¨å±€å˜é‡
            const method = document.getElementById('httpMethod').value;

            if (!url) {
                showError('è¯·è¾“å…¥APIåœ°å€');
                return;
            }

            // æ›¿æ¢è·¯å¾„å‚æ•°ï¼ˆä¹Ÿè¦æ›¿æ¢è·¯å¾„å‚æ•°ä¸­çš„å˜é‡ï¼‰
            const pathVars = getKeyValueData('pathVarsList');
            Object.keys(pathVars).forEach(key => {
                const value = replaceVariables(pathVars[key]);
                // æ›¿æ¢ {variable} æ ¼å¼
                url = url.replace(new RegExp(`\\{${key}\\}`, 'g'), value);
                // æ›¿æ¢ :variable æ ¼å¼
                url = url.replace(new RegExp(`:${key}\\b`, 'g'), value);
            });

            // éªŒè¯URLæ ¼å¼
            try {
                new URL(url);
            } catch (e) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€');
                return;
            }

            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span class="loading-spinner"></span> å‘é€ä¸­...';

            const startTime = Date.now();

            try {
                // æ„å»ºå®Œæ•´URLï¼ˆåŒ…å«queryå‚æ•°ï¼Œæ›¿æ¢å˜é‡ï¼‰
                const params = getKeyValueData('paramsList');
                const urlObj = new URL(url);
                Object.keys(params).forEach(key => {
                    urlObj.searchParams.append(key, replaceVariables(params[key]));
                });

                // æ„å»ºè¯·æ±‚å¤´ï¼ˆæ›¿æ¢å˜é‡ï¼‰
                const headers = getKeyValueData('headersList');
                const replacedHeaders = {};
                Object.keys(headers).forEach(key => {
                    replacedHeaders[key] = replaceVariables(headers[key]);
                });

                // åº”ç”¨è®¤è¯ä¿¡æ¯
                applyAuthorization(replacedHeaders, urlObj);

                // æ„å»ºè¯·æ±‚é…ç½®
                const fetchOptions = {
                    method: method,
                    headers: replacedHeaders
                };

                // æ„å»ºè¯·æ±‚ä½“ï¼ˆæ›¿æ¢å˜é‡ï¼‰
                if (method !== 'GET' && method !== 'HEAD') {
                    if (currentBodyType === 'json') {
                        const jsonBody = document.getElementById('jsonBody').value.trim();
                        if (jsonBody) {
                            try {
                                const replacedJson = replaceVariables(jsonBody);
                                JSON.parse(replacedJson); // éªŒè¯JSON
                                fetchOptions.body = replacedJson;
                                if (!replacedHeaders['Content-Type']) {
                                    fetchOptions.headers['Content-Type'] = 'application/json';
                                }
                            } catch (e) {
                                throw new Error('JSONæ ¼å¼é”™è¯¯ï¼š' + e.message);
                            }
                        }
                    } else if (currentBodyType === 'form') {
                        const formData = getKeyValueData('formDataList');
                        const formBody = new URLSearchParams();
                        Object.keys(formData).forEach(key => {
                            formBody.append(key, replaceVariables(formData[key]));
                        });
                        fetchOptions.body = formBody;
                    } else if (currentBodyType === 'text') {
                        const textBody = document.getElementById('textBody').value;
                        if (textBody) {
                            fetchOptions.body = replaceVariables(textBody);
                        }
                    }
                }

                // å‘é€è¯·æ±‚
                const response = await fetch(urlObj.toString(), fetchOptions);
                const endTime = Date.now();
                const duration = endTime - startTime;

                // è·å–å“åº”å†…å®¹
                const contentType = response.headers.get('content-type');
                let responseBody;

                if (contentType && contentType.includes('application/json')) {
                    try {
                        responseBody = await response.json();
                    } catch (e) {
                        // JSONè§£æå¤±è´¥ï¼Œä½œä¸ºæ–‡æœ¬å¤„ç†
                        responseBody = await response.text();
                    }
                } else {
                    responseBody = await response.text();
                }

                // è·å–å“åº”å¤´
                const responseHeaders = {};
                response.headers.forEach((value, key) => {
                    responseHeaders[key] = value;
                });

                // æ˜¾ç¤ºå“åº”ç»“æœ
                displayResponse(response.status, duration, responseBody, responseHeaders, contentType);

                // ä¿å­˜åˆ°å†å²è®°å½•ï¼ˆä¿å­˜æ‰€æœ‰å‚æ•°ï¼ŒåŒ…æ‹¬æœªé€‰ä¸­çš„ï¼‰
                const allParams = getAllKeyValueData('paramsList');
                const allPathVars = getAllKeyValueData('pathVarsList');
                const allHeaders = getAllKeyValueData('headersList');
                const allFormData = currentBodyType === 'form' ? getAllKeyValueData('formDataList') : [];

                // è·å–è®¤è¯ä¿¡æ¯
                const authData = {
                    type: document.getElementById('authType').value,
                    bearerToken: document.getElementById('bearerToken').value,
                    basicUsername: document.getElementById('basicUsername').value,
                    basicPassword: document.getElementById('basicPassword').value,
                    apiKeyName: document.getElementById('apiKeyName').value,
                    apiKeyValue: document.getElementById('apiKeyValue').value,
                    apiKeyLocation: document.getElementById('apiKeyLocation').value,
                    oauth2Token: document.getElementById('oauth2Token').value,
                    oauth2TokenType: document.getElementById('oauth2TokenType').value
                };

                // è·å–Bodyæ•°æ®
                const bodyData = {
                    type: currentBodyType,
                    jsonBody: document.getElementById('jsonBody').value,
                    textBody: document.getElementById('textBody').value,
                    formData: allFormData
                };

                // ä½¿ç”¨åŸå§‹URLï¼Œä¸ä½¿ç”¨å¤„ç†åçš„URL
                saveToHistory(method, originalUrl, response.status, duration, allParams, allPathVars, allHeaders, authData, bodyData);

            } catch (error) {
                showError('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
                document.getElementById('responseSection').classList.remove('show');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'å‘é€è¯·æ±‚';
            }
        }

        // æ˜¾ç¤ºå“åº”ç»“æœ
        function displayResponse(status, duration, body, headers, contentType) {
            const responseSection = document.getElementById('responseSection');
            responseSection.classList.add('show');

            // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
            const statusClass = status >= 200 && status < 300 ? 'success' : 'error';
            document.getElementById('responseStatus').innerHTML = `
                <div class="status-item">
                    <div class="status-label">çŠ¶æ€ç </div>
                    <div class="status-value ${statusClass}">${status}</div>
                </div>
                <div class="status-item">
                    <div class="status-label">å“åº”æ—¶é—´</div>
                    <div class="status-value">${duration} ms</div>
                </div>
                <div class="status-item">
                    <div class="status-label">å“åº”å¤§å°</div>
                    <div class="status-value">${formatBytes(new Blob([typeof body === 'string' ? body : JSON.stringify(body)]).size)}</div>
                </div>
            `;

            // æ ¼å¼åŒ–å¹¶æ˜¾ç¤ºå“åº”å†…å®¹
            const responseContentElement = document.getElementById('responseContent');
            const formattedContent = formatResponseBody(body, contentType);
            responseContentElement.innerHTML = formattedContent;

            // æ˜¾ç¤ºå“åº”å¤´ï¼ˆå¸¦è¯­æ³•é«˜äº®ï¼‰
            const formattedHeaders = syntaxHighlightJSON(JSON.stringify(headers, null, 2));
            document.getElementById('responseHeadersContent').innerHTML = formattedHeaders;

            // æ»šåŠ¨åˆ°å“åº”åŒºåŸŸ
            responseSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // æ ¼å¼åŒ–å“åº”ä½“
        function formatResponseBody(body, contentType) {
            if (!body) return '<span style="color: #999;">æ— å“åº”å†…å®¹</span>';

            try {
                // JSONæ ¼å¼
                if (contentType && contentType.includes('application/json')) {
                    const jsonObj = typeof body === 'string' ? JSON.parse(body) : body;
                    const formattedJson = JSON.stringify(jsonObj, null, 2);
                    return syntaxHighlightJSON(formattedJson);
                }

                // XMLæ ¼å¼
                if (contentType && (contentType.includes('application/xml') || contentType.includes('text/xml'))) {
                    return syntaxHighlightXML(formatXML(body));
                }

                // HTMLæ ¼å¼
                if (contentType && contentType.includes('text/html')) {
                    return syntaxHighlightHTML(body);
                }

                // å°è¯•è‡ªåŠ¨æ£€æµ‹JSON
                if (typeof body === 'string' && (body.trim().startsWith('{') || body.trim().startsWith('['))) {
                    try {
                        const jsonObj = JSON.parse(body);
                        const formattedJson = JSON.stringify(jsonObj, null, 2);
                        return syntaxHighlightJSON(formattedJson);
                    } catch (e) {
                        // ä¸æ˜¯æœ‰æ•ˆçš„JSONï¼Œç»§ç»­ä½œä¸ºçº¯æ–‡æœ¬å¤„ç†
                    }
                }

                // çº¯æ–‡æœ¬
                return `<pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${escapeHtml(body)}</pre>`;
            } catch (e) {
                return `<pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">${escapeHtml(String(body))}</pre>`;
            }
        }

        // JSONè¯­æ³•é«˜äº®
        function syntaxHighlightJSON(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return '<pre style="margin: 0;">' + json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            }) + '</pre>';
        }

        // XMLæ ¼å¼åŒ–
        function formatXML(xml) {
            const PADDING = '  ';
            const reg = /(>)(<)(\/*)/g;
            let pad = 0;
            xml = xml.replace(reg, '$1\r\n$2$3');
            return xml.split('\r\n').map((node) => {
                let indent = 0;
                if (node.match(/.+<\/\w[^>]*>$/)) {
                    indent = 0;
                } else if (node.match(/^<\/\w/)) {
                    if (pad !== 0) {
                        pad -= 1;
                    }
                } else if (node.match(/^<\w([^>]*[^\/])?>.*$/)) {
                    indent = 1;
                } else {
                    indent = 0;
                }
                const padding = PADDING.repeat(pad);
                pad += indent;
                return padding + node;
            }).join('\r\n');
        }

        // XMLè¯­æ³•é«˜äº®
        function syntaxHighlightXML(xml) {
            xml = escapeHtml(xml);
            xml = xml.replace(/(&lt;\/?)([\w-]+)/g, '<span class="xml-tag">$1</span><span class="xml-tag-name">$2</span>');
            xml = xml.replace(/([\w-]+)(=)/g, '<span class="xml-attr">$1</span><span class="xml-punct">$2</span>');
            xml = xml.replace(/(".*?")/g, '<span class="xml-string">$1</span>');
            return '<pre style="margin: 0;">' + xml + '</pre>';
        }

        // HTMLè¯­æ³•é«˜äº®
        function syntaxHighlightHTML(html) {
            html = escapeHtml(html);
            html = html.replace(/(&lt;\/?)([\w-]+)/g, '<span class="html-tag">$1</span><span class="html-tag-name">$2</span>');
            html = html.replace(/([\w-]+)(=)/g, '<span class="html-attr">$1</span><span class="html-punct">$2</span>');
            html = html.replace(/(".*?")/g, '<span class="html-string">$1</span>');
            html = html.replace(/(&lt;!--.*?--&gt;)/g, '<span class="html-comment">$1</span>');
            return '<pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">' + html + '</pre>';
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            const responseSection = document.getElementById('responseSection');
            responseSection.classList.add('show');
            document.getElementById('responseStatus').innerHTML = `
                <div class="alert alert-danger">âŒ ${message}</div>
            `;
        }

        // å¤åˆ¶å“åº”å†…å®¹
        function copyResponse(elementId) {
            const content = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(content).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'âœ… å·²å¤åˆ¶';
                button.style.background = '#28a745';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#667eea';
                }, 2000);
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼š' + err);
            });
        }

        // æ ¼å¼åŒ–å­—èŠ‚å¤§å°
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            document.getElementById('apiUrl').value = '';
            document.getElementById('paramsList').innerHTML = '';
            document.getElementById('pathVarsList').innerHTML = '';
            document.getElementById('headersList').innerHTML = '';
            document.getElementById('formDataList').innerHTML = '';
            document.getElementById('jsonBody').value = '';
            document.getElementById('textBody').value = '';
            document.getElementById('responseSection').classList.remove('show');

            // æ¸…ç©ºè®¤è¯ä¿¡æ¯
            document.getElementById('authType').value = 'none';
            document.getElementById('bearerToken').value = '';
            document.getElementById('basicUsername').value = '';
            document.getElementById('basicPassword').value = '';
            document.getElementById('apiKeyName').value = 'X-API-Key';
            document.getElementById('apiKeyValue').value = '';
            document.getElementById('apiKeyLocation').value = 'header';
            document.getElementById('digestUsername').value = '';
            document.getElementById('digestPassword').value = '';
            document.getElementById('oauth2Token').value = '';
            document.getElementById('oauth2TokenType').value = 'Bearer';
            switchAuthType();

            paramsCount = 0;
            pathVarsCount = 0;
            headersCount = 0;
            formDataCount = 0;

            addParam();
            addHeader();
        }

        // ==================== å†å²è®°å½•ç®¡ç† ====================
        const MAX_HISTORY = 20;

        function saveToHistory(method, url, status, duration, params, pathVars, headers, authData, bodyData) {
            const storageKey = 'api_test_history';
            let history = JSON.parse(localStorage.getItem(storageKey) || '[]');

            const record = {
                id: Date.now(),
                method: method,
                url: url,
                status: status,
                duration: duration,
                params: params,  // æ•°ç»„æ ¼å¼ï¼ŒåŒ…å«enabledçŠ¶æ€
                pathVars: pathVars,  // æ•°ç»„æ ¼å¼
                headers: headers,  // æ•°ç»„æ ¼å¼
                authData: authData,  // è®¤è¯ä¿¡æ¯å¯¹è±¡
                bodyData: bodyData,  // Bodyæ•°æ®å¯¹è±¡
                timestamp: new Date().toLocaleString('zh-CN')
            };

            history.unshift(record);

            if (history.length > MAX_HISTORY) {
                history = history.slice(0, MAX_HISTORY);
            }

            localStorage.setItem(storageKey, JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const storageKey = 'api_test_history';
            const history = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const historyContainer = document.getElementById('historyList');

            if (history.length === 0) {
                historyContainer.innerHTML = '<div class="empty-history">ğŸ“­ æš‚æ— è¯·æ±‚å†å²</div>';
                return;
            }

            historyContainer.innerHTML = history.map(record => {
                const statusClass = record.status >= 200 && record.status < 300 ? 'success' : 'error';
                return `
                    <div class="history-item" onclick="loadHistoryItem(${record.id})">
                        <div class="history-item-header">
                            <div>
                                <span class="history-item-method method-${record.method}">${record.method}</span>
                                <span class="history-item-url">${escapeHtml(record.url)}</span>
                            </div>
                            <div class="history-item-actions">
                                <span class="history-item-date">${record.timestamp}</span>
                                <button class="delete-history-btn" onclick="deleteHistoryItem(${record.id}, event)">åˆ é™¤</button>
                            </div>
                        </div>
                        <div class="history-item-status">
                            çŠ¶æ€: <span class="${statusClass}">${record.status}</span> |
                            è€—æ—¶: ${record.duration}ms
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadHistoryItem(recordId) {
            const storageKey = 'api_test_history';
            const history = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const record = history.find(r => r.id === recordId);

            if (!record) return;

            // è®¾ç½®æ ‡å¿—ä½ï¼Œé˜²æ­¢è‡ªåŠ¨è§£æURL
            isLoadingHistory = true;

            // è®¾ç½®æ–¹æ³•å’ŒURLï¼ˆä½¿ç”¨åŸå§‹URLï¼Œä¸è‡ªåŠ¨è§£æï¼‰
            document.getElementById('httpMethod').value = record.method;
            document.getElementById('apiUrl').value = record.url;

            // åŠ è½½Query Paramsï¼ˆåŒ…æ‹¬æœªé€‰ä¸­çš„ï¼‰
            document.getElementById('paramsList').innerHTML = '';
            paramsCount = 0;
            if (Array.isArray(record.params) && record.params.length > 0) {
                // æ–°æ ¼å¼ï¼šæ•°ç»„æ ¼å¼ï¼ŒåŒ…å«enabledçŠ¶æ€
                record.params.forEach(param => {
                    addParam();
                    const row = document.querySelector('#paramsList .key-value-row:last-child');
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    const keyInput = row.querySelector('.key-input');
                    const valueInput = row.querySelector('.value-input');
                    if (checkbox) checkbox.checked = param.enabled;
                    if (keyInput) keyInput.value = param.key;
                    if (valueInput) valueInput.value = param.value;
                });
            } else if (record.params && typeof record.params === 'object') {
                // æ—§æ ¼å¼ï¼šå¯¹è±¡æ ¼å¼ï¼Œå…¼å®¹å¤„ç†
                Object.entries(record.params).forEach(([key, value]) => {
                    addParam();
                    const row = document.querySelector('#paramsList .key-value-row:last-child');
                    row.querySelector('.key-input').value = key;
                    row.querySelector('.value-input').value = value;
                });
            } else {
                addParam();
            }

            // åŠ è½½Path Variablesï¼ˆåŒ…æ‹¬æœªé€‰ä¸­çš„ï¼‰
            document.getElementById('pathVarsList').innerHTML = '';
            pathVarsCount = 0;
            if (Array.isArray(record.pathVars) && record.pathVars.length > 0) {
                record.pathVars.forEach(pathVar => {
                    addPathVar(pathVar.key, pathVar.value);
                    const row = document.querySelector('#pathVarsList .key-value-row:last-child');
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    if (checkbox) checkbox.checked = pathVar.enabled;
                });
            } else if (record.pathVars && typeof record.pathVars === 'object') {
                // æ—§æ ¼å¼å…¼å®¹
                Object.entries(record.pathVars).forEach(([key, value]) => {
                    addPathVar(key, value);
                });
            }

            // åŠ è½½Headersï¼ˆåŒ…æ‹¬æœªé€‰ä¸­çš„ï¼‰
            document.getElementById('headersList').innerHTML = '';
            headersCount = 0;
            if (Array.isArray(record.headers) && record.headers.length > 0) {
                record.headers.forEach(header => {
                    addHeader();
                    const row = document.querySelector('#headersList .key-value-row:last-child');
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    const keyInput = row.querySelector('.key-input');
                    const valueInput = row.querySelector('.value-input');
                    if (checkbox) checkbox.checked = header.enabled;
                    if (keyInput) keyInput.value = header.key;
                    if (valueInput) valueInput.value = header.value;
                });
            } else if (record.headers && typeof record.headers === 'object') {
                // æ—§æ ¼å¼å…¼å®¹
                Object.entries(record.headers).forEach(([key, value]) => {
                    addHeader();
                    const row = document.querySelector('#headersList .key-value-row:last-child');
                    row.querySelector('.key-input').value = key;
                    row.querySelector('.value-input').value = value;
                });
            } else {
                addHeader();
            }

            // åŠ è½½è®¤è¯ä¿¡æ¯
            if (record.authData) {
                document.getElementById('authType').value = record.authData.type || 'none';
                document.getElementById('bearerToken').value = record.authData.bearerToken || '';
                document.getElementById('basicUsername').value = record.authData.basicUsername || '';
                document.getElementById('basicPassword').value = record.authData.basicPassword || '';
                document.getElementById('apiKeyName').value = record.authData.apiKeyName || 'X-API-Key';
                document.getElementById('apiKeyValue').value = record.authData.apiKeyValue || '';
                document.getElementById('apiKeyLocation').value = record.authData.apiKeyLocation || 'header';
                document.getElementById('oauth2Token').value = record.authData.oauth2Token || '';
                document.getElementById('oauth2TokenType').value = record.authData.oauth2TokenType || 'Bearer';
                switchAuthType();
            }

            // åŠ è½½Bodyæ•°æ®
            if (record.bodyData) {
                currentBodyType = record.bodyData.type || 'none';
                document.getElementById('jsonBody').value = record.bodyData.jsonBody || '';
                document.getElementById('textBody').value = record.bodyData.textBody || '';

                // åˆ‡æ¢åˆ°å¯¹åº”çš„bodyç±»å‹
                document.querySelectorAll('.body-type-option').forEach(opt => opt.classList.remove('active'));
                const bodyTypeMap = {
                    'none': 0,
                    'json': 1,
                    'form': 2,
                    'text': 3
                };
                const bodyTypeOptions = document.querySelectorAll('.body-type-option');
                if (bodyTypeOptions[bodyTypeMap[currentBodyType]]) {
                    bodyTypeOptions[bodyTypeMap[currentBodyType]].classList.add('active');
                }

                // æ˜¾ç¤ºå¯¹åº”çš„bodyå†…å®¹
                document.querySelectorAll('.body-content').forEach(content => {
                    content.style.display = 'none';
                });
                const bodyContentMap = {
                    'none': 'bodyNone',
                    'json': 'bodyJson',
                    'form': 'bodyForm',
                    'text': 'bodyText'
                };
                const bodyContent = document.getElementById(bodyContentMap[currentBodyType]);
                if (bodyContent) {
                    bodyContent.style.display = 'block';
                }

                // åŠ è½½Form Data
                if (currentBodyType === 'form' && Array.isArray(record.bodyData.formData)) {
                    document.getElementById('formDataList').innerHTML = '';
                    formDataCount = 0;
                    record.bodyData.formData.forEach(formItem => {
                        addFormData();
                        const row = document.querySelector('#formDataList .key-value-row:last-child');
                        const checkbox = row.querySelector('input[type="checkbox"]');
                        const keyInput = row.querySelector('.key-input');
                        const valueInput = row.querySelector('.value-input');
                        if (checkbox) checkbox.checked = formItem.enabled;
                        if (keyInput) keyInput.value = formItem.key;
                        if (valueInput) valueInput.value = formItem.value;
                    });
                }
            }

            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // é‡ç½®æ ‡å¿—ä½ï¼Œæ¢å¤è‡ªåŠ¨è§£æåŠŸèƒ½
            setTimeout(() => {
                isLoadingHistory = false;
            }, 100);
        }

        function deleteHistoryItem(recordId, event) {
            if (event) {
                event.stopPropagation();
            }

            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿ')) {
                const storageKey = 'api_test_history';
                let history = JSON.parse(localStorage.getItem(storageKey) || '[]');
                history = history.filter(r => r.id !== recordId);
                localStorage.setItem(storageKey, JSON.stringify(history));
                loadHistory();
            }
        }

        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                const storageKey = 'api_test_history';
                localStorage.removeItem(storageKey);
                loadHistory();
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>


