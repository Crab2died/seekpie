<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON数组展示工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* 解析并展示按钮 */
        .btn-parse {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-parse:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        /* 格式化按钮 */
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
            background: linear-gradient(135deg, #e881e9 0%, #e3455a 100%);
        }

        /* 导出CSV按钮 */
        .btn-export {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(67, 233, 123, 0.4);
            background: linear-gradient(135deg, #31d769 0%, #26e7c5 100%);
        }
        
        /* 历史记录按钮 */
        .btn-history {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        
        .btn-history:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(250, 112, 154, 0.4);
            background: linear-gradient(135deg, #e85e88 0%, #ecd02e 100%);
        }

        /* 清空历史记录按钮 */
        .btn-clear-history {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }
        
        .btn-clear-history:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, #ee5a5a 0%, #dc495d 100%);
        }

        /* 关闭按钮 */
        .btn-close {
            background: linear-gradient(135deg, #868f96 0%, #596164 100%);
            color: white;
        }
        
        .btn-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(134, 143, 150, 0.4);
            background: linear-gradient(135deg, #757d84 0%, #485052 100%);
        }

        /* 列排序按钮 */
        .btn-sort-column {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-sort-column:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
            background: linear-gradient(135deg, #3d9aed 0%, #00e0ed 100%);
        }

        /* 清除排序按钮 */
        .btn-clear-sort {
            background: linear-gradient(135deg, #ffa751 0%, #ffe259 100%);
            color: white;
        }
        
        .btn-clear-sort:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 167, 81, 0.4);
            background: linear-gradient(135deg, #ee9540 0%, #eed048 100%);
        }

        /* 切换列管理按钮 */
        .btn-toggle-columns {
            background: linear-gradient(135deg, #4fd6cf 0%, #d8567f 100%);
            color: #ffffff;
        }
        
        .btn-toggle-columns:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(168, 237, 234, 0.4);
            background: linear-gradient(135deg, #74dfd9 0%, #a5506b 100%);
        }

        .controls-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .controls-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pagination-controls select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        .column-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .column-select-all {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .column-select-all label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .column-select-all label:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }

        .column-select-all input[type="checkbox"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
            accent-color: #4facfe;
        }

        .column-select-all span {
            font-weight: 500;
            color: #495057;
            user-select: none;
        }

        #sortColumnsBtn {
            padding: 8px 16px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        #sortColumnsIcon {
            font-size: 1.1em;
        }

        .history-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }

        .history-header h3 {
            margin: 0;
            color: #495057;
            font-size: 1.4em;
        }

        .history-controls {
            display: flex;
            gap: 10px;
        }

        .history-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-item:hover {
            border-color: #4facfe;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.1);
            transform: translateY(-1px);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-item-title {
            font-weight: 600;
            color: #495057;
            font-size: 1.1em;
        }

        .history-item-time {
            color: #6c757d;
            font-size: 0.9em;
        }

        .history-item-preview {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 10px;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: pre-wrap;
            word-break: break-word;
            line-height: 1.4;
        }

        .history-item-details {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            display: none;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .history-item-details.expanded {
            display: block;
        }

        .history-item-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 0.85em;
            color: #495057;
        }

        .history-item-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .history-item-stat span {
            font-weight: 600;
            color: #4facfe;
        }

        .history-item-actions {
            display: flex;
            gap: 8px;
        }

        .history-item-actions button {
            padding: 4px 8px;
            font-size: 0.8em;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item-actions button:hover {
            background: #f8f9fa;
            border-color: #4facfe;
        }

        .history-item-actions .delete-btn:hover {
            background: #f8d7da;
            border-color: #dc3545;
            color: #dc3545;
        }

        .toggle-details-btn {
            background: #4facfe;
            color: rgb(0, 0, 0);
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .toggle-details-btn:hover {
            background: #3d8bfe;
        }

        .empty-history {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            font-style: italic;
        }

        .column-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 201px;
        }

        .column-toggle:hover {
            border-color: #4facfe;
        }

        .column-toggle.active {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .column-toggle > span:not(.drag-handle) {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 140px;
            display: inline-block;
            vertical-align: middle;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .table-search-controls {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: wrap;
            align-items: center;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            /* font-size: 14px; */
            position: relative;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s ease;
            white-space: nowrap;
        }

        th:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        th.sortable {
            position: relative;
            padding-right: 28px;
        }

        th.sortable::after {
            content: '↕';
            position: absolute;
            right: 8px;
            opacity: 0.3;
            font-size: 0.9em;
        }

        th.sortable:hover::after {
            opacity: 0.6;
        }

        th.sort-asc::after {
            content: '↑';
            opacity: 1;
            color: #ffd700;
            font-weight: bold;
        }

        th.sort-desc::after {
            content: '↓';
            opacity: 1;
            color: #ffd700;
            font-weight: bold;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 100px;
            max-width: 300px;
            position: relative;
            transition: background-color 0.2s ease;
        }

        tr:hover td {
            background-color: #f8f9fa;
        }

        td:hover {
            z-index: 5;
        }

        td:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            top: 100%;
            left: 0;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9em;
            white-space: normal;
            max-width: 300px;
            word-wrap: break-word;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        td.expanded {
            white-space: normal;
            overflow: visible;
        }

        td.expanded:hover::after {
            display: none;
        }

        tr:nth-child(even) {
            background-color: #fdfdfd;
        }

        tr:nth-child(even):hover {
            background-color: #f8f9fa;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .pagination button {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            border-color: #4facfe;
            background: #4facfe;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .current-page {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            font-size: 14px;
            color: #6c757d;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        .json-preview {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .drag-handle {
            cursor: move;
            color: #6c757d;
            margin-right: 8px;
        }

        .dragging {
            opacity: 0.5;
        }

        /* 平板和中等屏幕 */
        @media (max-width: 1024px) {
            .main-content {
                padding: 25px;
            }

            .input-section, .controls-section, .history-panel {
                padding: 20px;
            }
        }

        /* 移动端优化 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 12px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 0.95em;
            }

            .header p:last-child {
                font-size: 0.85em;
            }

            .main-content {
                padding: 20px 15px;
            }

            .input-section {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .input-group label {
                font-size: 0.95em;
            }

            .input-group textarea {
                min-height: 150px;
                padding: 12px;
                font-size: 13px;
            }

            .button-group {
                justify-content: center;
                gap: 10px;
            }

            .btn {
                padding: 10px 18px;
                font-size: 14px;
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }

            .controls-section {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .controls-row {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .table-search-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .search-box {
                min-width: auto;
                width: 100%;
            }

            .search-box input {
                padding: 10px 40px 10px 12px;
                font-size: 14px;
            }

            .pagination-controls {
                justify-content: center;
                flex-wrap: wrap;
            }

            .pagination-controls select {
                padding: 8px 10px;
                font-size: 13px;
            }

            .column-controls {
                justify-content: center;
            }

            .column-select-all {
                justify-content: center;
            }

            .column-select-all label {
                font-size: 0.9em;
                padding: 6px 10px;
            }

            #sortColumnsBtn {
                padding: 8px 14px;
                font-size: 14px;
            }

            .history-panel {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .history-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .history-header h3 {
                font-size: 1.2em;
                text-align: center;
            }

            .history-controls {
                justify-content: center;
                flex-wrap: wrap;
            }

            .history-list {
                max-height: 400px;
            }

            .history-item {
                padding: 12px;
            }

            .history-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .history-item-title {
                font-size: 1em;
            }

            .history-item-time {
                font-size: 0.85em;
            }

            .history-item-stats {
                flex-wrap: wrap;
                gap: 10px;
            }

            .history-item-actions {
                flex-wrap: wrap;
            }

            .history-item-details {
                font-size: 0.8em;
                max-height: 250px;
            }

            .stats {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .stats-item {
                font-size: 0.9em;
            }

            .data-table-container {
                border-radius: 8px;
            }

            .data-table th {
                padding: 10px 8px;
                font-size: 0.9em;
            }

            .data-table td {
                padding: 8px 6px;
                font-size: 0.9em;
                max-width: 150px;
            }

            .pagination {
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 20px;
            }

            .pagination button {
                padding: 8px 12px;
                font-size: 0.85em;
            }

            .column-toggle {
                padding: 6px 10px;
                font-size: 0.85em;
            }
        }

        /* 小屏手机优化 */
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 15px 12px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .header p {
                font-size: 0.9em;
            }

            .header p:last-child {
                font-size: 0.8em;
            }

            .main-content {
                padding: 15px 12px;
            }

            .input-section {
                padding: 15px 12px;
            }

            .input-group textarea {
                min-height: 120px;
                padding: 10px;
                font-size: 12px;
            }

            .button-group {
                gap: 8px;
            }

            .btn {
                padding: 8px 14px;
                font-size: 13px;
                min-width: 100px;
            }

            .controls-section {
                padding: 15px 12px;
            }

            .controls-row {
                gap: 12px;
            }

            .search-box input {
                padding: 8px 35px 8px 10px;
                font-size: 13px;
            }

            .pagination-controls select {
                padding: 6px 8px;
                font-size: 12px;
            }

            .column-select-all label {
                font-size: 0.85em;
                padding: 5px 8px;
            }

            .column-select-all input[type="checkbox"] {
                width: 16px;
                height: 16px;
            }

            #sortColumnsBtn {
                padding: 6px 12px;
                font-size: 13px;
            }

            .history-panel {
                padding: 15px 12px;
            }

            .history-header h3 {
                font-size: 1.1em;
            }

            .history-item {
                padding: 10px;
            }

            .history-item-title {
                font-size: 0.95em;
            }

            .history-item-time {
                font-size: 0.8em;
            }

            .history-item-preview {
                font-size: 0.85em;
                max-height: 50px;
            }

            .history-item-stats {
                font-size: 0.8em;
                gap: 8px;
            }

            .history-item-actions button {
                padding: 3px 6px;
                font-size: 0.75em;
            }

            .history-item-details {
                font-size: 0.75em;
                max-height: 200px;
            }

            .stats-item {
                font-size: 0.85em;
            }

            .data-table th {
                padding: 8px 6px;
                font-size: 0.85em;
            }

            .data-table td {
                padding: 6px 4px;
                font-size: 0.85em;
                max-width: 120px;
            }

            .pagination button {
                padding: 6px 10px;
                font-size: 0.8em;
            }

            .column-toggle {
                padding: 5px 8px;
                font-size: 0.8em;
            }

            .toggle-details-btn {
                padding: 3px 6px;
                font-size: 0.75em;
            }
        }

        /* 超小屏手机 */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.3em;
            }

            .header p {
                font-size: 0.85em;
            }

            .header p:last-child {
                font-size: 0.75em;
            }

            .btn {
                font-size: 12px;
                padding: 6px 12px;
                min-width: 90px;
            }

            .history-header h3 {
                font-size: 1em;
            }

            .data-table th {
                padding: 6px 4px;
                font-size: 0.8em;
            }

            .data-table td {
                padding: 5px 3px;
                font-size: 0.8em;
                max-width: 100px;
            }

            .pagination button {
                padding: 5px 8px;
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 JSON数组展示工具</h1>
            <p>支持分页、多列排序、搜索、列控制和列移动的JSON数据展示工具</p>
            <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
                💡 提示：双击单元格展开/收缩 | Shift点击列头进行多列排序（无序→升序→降序→无序）
            </p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="jsonInput">请输入JSON数组数据：</label>
                    <textarea id="jsonInput" placeholder='例如：[{"id": 1, "name": "张三", "age": 25, "city": "北京"}, {"id": 2, "name": "李四", "age": 30, "city": "上海"}]'></textarea>
                </div>
                <div class="button-group">
                    <button class="btn btn-parse" onclick="parseAndDisplay()">
                        <span>📊</span> 解析并展示
                    </button>
                    <button class="btn btn-secondary" onclick="formatJSON()">
                        <span>✨</span> 格式化
                    </button>
                    <button class="btn btn-export" onclick="exportToCSV()">
                        <span>📥</span> 导出CSV
                    </button>
                    <button class="btn btn-history" onclick="toggleHistoryPanel()">
                        <span>📚</span> 历史记录
                    </button>
                </div>
            </div>

            <div id="messageContainer" style="display: none;"></div>

            <div id="historyPanel" class="history-panel" style="display: none;">
                <div class="history-header">
                    <h3>📚 历史记录</h3>
                    <div class="history-controls">
                        <button class="btn btn-clear-history" onclick="clearAllHistory()">
                            <span>🗑️</span> 清空全部
                        </button>
                        <button class="btn btn-close" onclick="toggleHistoryPanel()">
                            <span>✖️</span> 关闭
                        </button>
                    </div>
                </div>
                <div class="history-list" id="historyList">
                    <!-- 历史记录列表将在这里动态生成 -->
                </div>
            </div>

            <div id="controlsSection" class="controls-section" style="display: none;">
                <div class="controls-row" id="columnControlsRow" style="display: none;">
                    <div class="column-controls" id="columnControls">
                        <!-- 列控制按钮将在这里动态生成 -->
                    </div>
                </div>
                <div class="controls-row">
                    <div class="column-select-all">
                        <label>
                            <input type="checkbox" id="selectAllCheckbox" onchange="toggleAllColumns()">
                            <span>全选/全不选列</span>
                        </label>
                        <button class="btn btn-sort-column" onclick="sortColumnsByName()" id="sortColumnsBtn">
                            <span id="sortColumnsIcon">🔤</span> 按列名排序
                        </button>
                        <button class="btn btn-toggle-columns" onclick="toggleColumnControls()" id="toggleColumnsBtn">
                            <span id="toggleColumnsIcon">👁️</span> 显示列管理
                        </button>
                    </div>
                </div>
            </div>

            <div id="tableContainer" class="table-container" style="display: none;">
                <div class="table-search-controls">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="搜索数据...">
                        <span class="search-icon">🔍</span>
                    </div>
                    <button class="btn btn-clear-sort" onclick="clearAllSorting()" id="clearSortBtn" style="display: none;">
                        <span>🔄</span> 清除所有排序
                    </button>
                    <div class="pagination-controls">
                        <label>每页显示：</label>
                        <select id="pageSizeSelect">
                            <option value="10">10条</option>
                            <option value="25" selected>25条</option>
                            <option value="50">50条</option>
                            <option value="100">100条</option>
                        </select>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table id="dataTable">
                        <thead id="tableHead">
                            <!-- 表头将在这里动态生成 -->
                        </thead>
                        <tbody id="tableBody">
                            <!-- 表格数据将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
                <div class="stats" id="statsInfo">
                    <!-- 统计信息将在这里显示 -->
                </div>
                <div id="paginationContainer" class="pagination">
                    <!-- 分页控件将在这里动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = [];
        let filteredData = [];
        let currentPage = 1;
        let pageSize = 25;
        let sortColumns = []; // 多列排序: [{column: 'name', direction: 'asc'}, ...]
        let visibleColumns = [];
        let columnOrder = [];
        let prettyPrintJSON = false; // 是否美化JSON对象显示

        function showMessage(message, type = 'error') {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="${type}-message">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        function parseAndDisplay() {
            const jsonInput = document.getElementById('jsonInput').value.trim();
            
            if (!jsonInput) {
                showMessage('请输入JSON数据');
                return;
            }

            try {
                const parsed = JSON.parse(jsonInput);
                
                if (!Array.isArray(parsed)) {
                    showMessage('请输入有效的JSON数组');
                    return;
                }

                if (parsed.length === 0) {
                    showMessage('JSON数组为空');
                    return;
                }

                currentData = parsed;
                initializeTable();
                showMessage(`成功解析 ${parsed.length} 条数据`, 'success');
                
                // 自动保存到历史记录
                saveToHistory(jsonInput);
                
            } catch (error) {
                showMessage(`JSON解析错误: ${error.message}`);
            }
        }

        function formatJSON() {
            const jsonInput = document.getElementById('jsonInput');
            const inputValue = jsonInput.value.trim();
            
            if (!inputValue) {
                showMessage('请先输入JSON数据');
                return;
            }

            try {
                // 尝试解析JSON
                const parsed = JSON.parse(inputValue);
                
                // 格式化JSON，使用2个空格缩进
                const formatted = JSON.stringify(parsed, null, 2);
                
                // 更新输入框内容
                jsonInput.value = formatted;
                
                showMessage('JSON格式化成功', 'success');
                
            } catch (error) {
                showMessage(`JSON格式化失败: ${error.message}`);
            }
        }


        function initializeTable() {
            if (currentData.length === 0) return;

            // 获取所有列名
            const allColumns = new Set();
            currentData.forEach(item => {
                Object.keys(item).forEach(key => allColumns.add(key));
            });

            // 初始化列配置
            visibleColumns = Array.from(allColumns);
            columnOrder = Array.from(allColumns);
            
            // 清除所有排序
            sortColumns = [];
            updateClearSortButton();

            // 显示控制区域
            document.getElementById('controlsSection').style.display = 'block';
            document.getElementById('tableContainer').style.display = 'block';

            // 生成列控制按钮
            generateColumnControls();
            
            // 初始化搜索和分页
            setupEventListeners();
            
            // 显示数据
            displayData();
        }

        function generateColumnControls() {
            const container = document.getElementById('columnControls');
            container.innerHTML = '';

            columnOrder.forEach(column => {
                const button = document.createElement('div');
                button.className = `column-toggle ${visibleColumns.includes(column) ? 'active' : ''}`;
                button.innerHTML = `
                    <span class="drag-handle">⋮⋮</span>
                    <input type="checkbox" ${visibleColumns.includes(column) ? 'checked' : ''} 
                           onchange="toggleColumn('${column}')">
                    <span title="${column}">${column}</span>
                `;
                button.draggable = true;
                button.dataset.column = column;
                
                button.addEventListener('dragstart', handleDragStart);
                button.addEventListener('dragover', handleDragOver);
                button.addEventListener('drop', handleDrop);
                button.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(button);
            });

            // 更新全选/全不选按钮状态
            updateSelectAllButtons();
        }

        function updateSelectAllButtons() {
            const checkbox = document.getElementById('selectAllCheckbox');
            
            if (!checkbox) return;
            
            const allSelected = visibleColumns.length === columnOrder.length;
            const someSelected = visibleColumns.length > 0 && visibleColumns.length < columnOrder.length;
            
            if (allSelected) {
                // 全部选中
                checkbox.checked = true;
                checkbox.indeterminate = false;
            } else if (someSelected) {
                // 部分选中 - 使用不确定状态
                checkbox.checked = false;
                checkbox.indeterminate = true;
            } else {
                // 全部未选中
                checkbox.checked = false;
                checkbox.indeterminate = false;
            }
        }

        function toggleColumn(column) {
            if (visibleColumns.includes(column)) {
                visibleColumns = visibleColumns.filter(col => col !== column);
            } else {
                visibleColumns.push(column);
            }
            displayData();
            generateColumnControls();
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.column);
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const draggedColumn = e.dataTransfer.getData('text/plain');
            const targetColumn = e.target.dataset.column;
            
            if (draggedColumn && targetColumn && draggedColumn !== targetColumn) {
                const draggedIndex = columnOrder.indexOf(draggedColumn);
                const targetIndex = columnOrder.indexOf(targetColumn);
                
                columnOrder.splice(draggedIndex, 1);
                columnOrder.splice(targetIndex, 0, draggedColumn);
                
                generateColumnControls();
                displayData();
            }
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function setupEventListeners() {
            // 搜索功能
            document.getElementById('searchInput').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                filteredData = currentData.filter(item => {
                    return Object.values(item).some(value => 
                        String(value).toLowerCase().includes(searchTerm)
                    );
                });
                currentPage = 1;
                displayData();
            });

            // 分页大小变化
            document.getElementById('pageSizeSelect').addEventListener('change', function() {
                pageSize = parseInt(this.value);
                currentPage = 1;
                displayData();
            });
        }

        function displayData() {
            // 创建数据副本以避免修改原数组
            const dataToShow = [...(filteredData.length > 0 ? filteredData : currentData)];
            
            // 多列排序
            if (sortColumns.length > 0) {
                dataToShow.sort((a, b) => {
                    // 依次按每个排序列进行比较
                    for (let i = 0; i < sortColumns.length; i++) {
                        const sortInfo = sortColumns[i];
                        const column = sortInfo.column;
                        const direction = sortInfo.direction;
                        
                        const aVal = a[column];
                        const bVal = b[column];
                        
                        // 处理null/undefined值
                        if (aVal === null || aVal === undefined) {
                            if (bVal === null || bVal === undefined) continue;
                            return 1;
                        }
                        if (bVal === null || bVal === undefined) return -1;
                        
                        let comparison = 0;
                        
                        // 数字比较
                        if (typeof aVal === 'number' && typeof bVal === 'number') {
                            comparison = aVal - bVal;
                        } 
                        // 字符串比较
                        else {
                            const aStr = String(aVal).toLowerCase();
                            const bStr = String(bVal).toLowerCase();
                            comparison = aStr.localeCompare(bStr, 'zh-CN');
                        }
                        
                        if (comparison !== 0) {
                            return direction === 'asc' ? comparison : -comparison;
                        }
                    }
                    return 0;
                });
            }

            // 生成表头
            generateTableHeader();
            
            // 分页计算
            const totalPages = Math.ceil(dataToShow.length / pageSize);
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, dataToShow.length);
            const pageData = dataToShow.slice(startIndex, endIndex);

            // 生成表格内容
            generateTableBody(pageData);
            
            // 生成分页控件
            generatePagination(totalPages);
            
            // 更新统计信息
            updateStats(dataToShow.length, startIndex + 1, endIndex);
        }

        function generateTableHeader() {
            const thead = document.getElementById('tableHead');
            thead.innerHTML = '';

            const tr = document.createElement('tr');
            columnOrder.forEach(column => {
                if (visibleColumns.includes(column)) {
                    const th = document.createElement('th');
                    th.className = 'sortable';
                    th.onclick = () => sortByColumn(column);
                    
                    // 查找该列的排序信息
                    const sortIndex = sortColumns.findIndex(s => s.column === column);
                    
                    if (sortIndex !== -1) {
                        const sortInfo = sortColumns[sortIndex];
                        th.classList.add(`sort-${sortInfo.direction}`);
                        
                        // 如果有多个排序列，显示排序优先级
                        if (sortColumns.length > 1) {
                            th.innerHTML = `${column} <small style="opacity: 0.8;">(${sortIndex + 1})</small>`;
                        } else {
                            th.textContent = column;
                        }
                    } else {
                        th.textContent = column;
                    }
                    
                    tr.appendChild(th);
                }
            });
            thead.appendChild(tr);
        }

        function generateTableBody(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            data.forEach(item => {
                const tr = document.createElement('tr');
                columnOrder.forEach(column => {
                    if (visibleColumns.includes(column)) {
                        const td = document.createElement('td');
                        const value = item[column];
                        let displayText = '';
                        
                        if (value === null || value === undefined) {
                            displayText = '-';
                            td.textContent = displayText;
                            td.style.color = '#6c757d';
                            td.style.fontStyle = 'italic';
                        } else if (typeof value === 'object' && value !== null) {
                            // 将JSON对象转换为字符串展示（不美化，保持单行）
                            displayText = JSON.stringify(value);
                            td.textContent = displayText;
                            // td.style.fontFamily = "'Courier New', monospace";
                            // td.style.fontSize = '0.9em';
                            // td.style.color = '#0066cc';
                            
                            // 保存原始对象，用于展开时美化显示
                            td.dataset.jsonValue = displayText;
                            td.dataset.isJson = 'true';
                        } else {
                            displayText = String(value);
                            td.textContent = displayText;
                        }
                        
                        // 添加data-tooltip属性用于悬停提示
                        // 如果是JSON对象，悬停时显示美化后的版本
                        if (typeof value === 'object' && value !== null) {
                            const prettyJson = JSON.stringify(value, null, 2);
                            td.setAttribute('data-tooltip', prettyJson);
                        } else if (displayText) {
                            td.setAttribute('data-tooltip', displayText);
                        }
                        
                        // 添加双击展开/收缩功能
                        td.addEventListener('dblclick', () => {
                            if (td.classList.contains('expanded')) {
                                // 收缩：恢复为单行JSON
                                td.classList.remove('expanded');
                                if (td.dataset.isJson === 'true') {
                                    td.textContent = td.dataset.jsonValue;
                                }
                            } else {
                                // 展开：如果是JSON对象，美化显示
                                td.classList.add('expanded');
                                if (td.dataset.isJson === 'true') {
                                    try {
                                        const obj = JSON.parse(td.dataset.jsonValue);
                                        td.textContent = JSON.stringify(obj, null, 2);
                                    } catch (e) {
                                        // 如果解析失败，保持原样
                                    }
                                }
                            }
                        });
                        
                        tr.appendChild(td);
                    }
                });
                tbody.appendChild(tr);
            });
        }

        function generatePagination(totalPages) {
            const container = document.getElementById('paginationContainer');
            container.innerHTML = '';
            container.style.display = totalPages > 1 ? 'flex' : 'none';

            if (totalPages <= 1) return;

            // 上一页按钮
            const prevBtn = document.createElement('button');
            prevBtn.textContent = '上一页';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayData();
                }
            };
            container.appendChild(prevBtn);

            // 页码按钮
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.textContent = '1';
                firstBtn.onclick = () => {
                    currentPage = 1;
                    displayData();
                };
                container.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '8px';
                    container.appendChild(ellipsis);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = i === currentPage ? 'current-page' : '';
                pageBtn.onclick = () => {
                    currentPage = i;
                    displayData();
                };
                container.appendChild(pageBtn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '8px';
                    container.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => {
                    currentPage = totalPages;
                    displayData();
                };
                container.appendChild(lastBtn);
            }

            // 下一页按钮
            const nextBtn = document.createElement('button');
            nextBtn.textContent = '下一页';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayData();
                }
            };
            container.appendChild(nextBtn);
        }

        function sortByColumn(column) {
            // 查找该列是否已在排序列表中
            const sortIndex = sortColumns.findIndex(s => s.column === column);
            
            if (sortIndex === -1) {
                // 该列未排序，添加为升序排序
                sortColumns.push({ column: column, direction: 'asc' });
                showMessage(`已添加 "${column}" 列升序排序 (优先级: ${sortColumns.length})`, 'success');
            } else {
                const currentDirection = sortColumns[sortIndex].direction;
                
                if (currentDirection === 'asc') {
                    // 从升序改为降序
                    sortColumns[sortIndex].direction = 'desc';
                    showMessage(`"${column}" 列已改为降序排序 (优先级: ${sortIndex + 1})`, 'success');
                } else {
                    // 从降序移除排序
                    sortColumns.splice(sortIndex, 1);
                    showMessage(`已取消 "${column}" 列的排序`, 'success');
                }
            }
            
            // 显示或隐藏清除排序按钮
            updateClearSortButton();
            
            displayData();
        }

        function clearAllSorting() {
            if (sortColumns.length === 0) {
                showMessage('当前没有排序', 'success');
                return;
            }
            
            const count = sortColumns.length;
            sortColumns = [];
            updateClearSortButton();
            displayData();
            showMessage(`已清除所有 ${count} 个排序`, 'success');
        }

        function updateClearSortButton() {
            const clearBtn = document.getElementById('clearSortBtn');
            if (clearBtn) {
                clearBtn.style.display = sortColumns.length > 0 ? 'inline-flex' : 'none';
            }
        }

        function updateStats(total, start, end) {
            const statsContainer = document.getElementById('statsInfo');
            
            let sortInfo = '';
            if (sortColumns.length > 0) {
                const sortTexts = sortColumns.map((s, index) => 
                    `${s.column} (${s.direction === 'asc' ? '↑升序' : '↓降序'})`
                );
                sortInfo = `<div>排序: ${sortTexts.join(' → ')}</div>`;
            }
            
            statsContainer.innerHTML = `
                <div>显示 ${start}-${end} 条，共 ${total} 条数据</div>
                <div>当前页: ${currentPage} / ${Math.ceil(total / pageSize)}</div>
                ${sortInfo}
            `;
        }

        function exportToCSV() {
            if (currentData.length === 0) {
                showMessage('没有数据可导出');
                return;
            }

            const dataToExport = filteredData.length > 0 ? filteredData : currentData;
            const columns = columnOrder.filter(col => visibleColumns.includes(col));
            
            // 生成CSV内容
            let csvContent = columns.join(',') + '\n';
            
            dataToExport.forEach(item => {
                const row = columns.map(col => {
                    const value = item[col];
                    if (value === null || value === undefined) return '';
                    if (typeof value === 'object') return JSON.stringify(value);
                    return String(value).replace(/,/g, '，'); // 替换逗号避免CSV格式问题
                });
                csvContent += row.join(',') + '\n';
            });

            // 下载文件
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `json_data_${new Date().toISOString().slice(0, 10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showMessage('CSV文件已导出', 'success');
        }

        function toggleAllColumns() {
            const checkbox = document.getElementById('selectAllCheckbox');
            
            if (checkbox.checked) {
                // 全选
                visibleColumns = [...columnOrder];
                showMessage(`已全选所有 ${columnOrder.length} 列`, 'success');
            } else {
                // 全不选
                visibleColumns = [];
                showMessage('已取消选择所有列', 'success');
            }
            
            displayData();
            generateColumnControls();
        }

        // 列排序状态：'none' | 'asc' | 'desc'
        let columnSortOrder = 'none';
        
        // 列控制显示状态
        let columnControlsVisible = false;

        function toggleColumnControls() {
            const columnControlsRow = document.getElementById('columnControlsRow');
            const toggleBtn = document.getElementById('toggleColumnsBtn');
            
            columnControlsVisible = !columnControlsVisible;
            
            if (columnControlsVisible) {
                columnControlsRow.style.display = 'flex';
                toggleBtn.innerHTML = '<span id="toggleColumnsIcon">🙈</span> 隐藏列管理';
            } else {
                columnControlsRow.style.display = 'none';
                toggleBtn.innerHTML = '<span id="toggleColumnsIcon">👁️</span> 显示列管理';
            }
        }

        function sortColumnsByName() {
            const sortIcon = document.getElementById('sortColumnsIcon');
            
            if (columnSortOrder === 'none' || columnSortOrder === 'desc') {
                // 升序排序
                columnOrder.sort((a, b) => a.localeCompare(b, 'zh-CN'));
                columnSortOrder = 'asc';
                sortIcon.textContent = '🔤↑';
                showMessage('列已按名称升序排序', 'success');
            } else {
                // 降序排序
                columnOrder.sort((a, b) => b.localeCompare(a, 'zh-CN'));
                columnSortOrder = 'desc';
                sortIcon.textContent = '🔤↓';
                showMessage('列已按名称降序排序', 'success');
            }
            
            displayData();
            generateColumnControls();
        }

        // 历史记录相关功能
        const HISTORY_KEY = 'json_table_history';
        const MAX_HISTORY_COUNT = 20;

        function saveToHistory(jsonData) {
            try {
                const history = getHistory();
                const timestamp = new Date().toISOString();
                const preview = generatePreview(jsonData);
                const title = generateTitle(jsonData);
                const detailedInfo = generateDetailedInfo(jsonData);
                
                // 检查是否已存在相同的数据
                const existingIndex = history.findIndex(item => item.data === jsonData);
                if (existingIndex !== -1) {
                    // 如果存在，移除旧记录
                    history.splice(existingIndex, 1);
                }
                
                // 添加新记录到开头
                history.unshift({
                    id: Date.now(),
                    title: title,
                    data: jsonData,
                    preview: preview,
                    timestamp: timestamp,
                    detailedInfo: detailedInfo
                });
                
                // 限制历史记录数量
                if (history.length > MAX_HISTORY_COUNT) {
                    history.splice(MAX_HISTORY_COUNT);
                }
                
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                return true;
            } catch (error) {
                console.error('保存历史记录失败:', error);
                return false;
            }
        }

        function getHistory() {
            try {
                const history = localStorage.getItem(HISTORY_KEY);
                return history ? JSON.parse(history) : [];
            } catch (error) {
                console.error('获取历史记录失败:', error);
                return [];
            }
        }

        function generateTitle(jsonData) {
            try {
                const data = JSON.parse(jsonData);
                if (Array.isArray(data)) {
                    return `JSON数组 (${data.length} 条记录)`;
                } else {
                    return 'JSON对象';
                }
            } catch {
                return 'JSON数据';
            }
        }

        function generatePreview(jsonData) {
            try {
                const data = JSON.parse(jsonData);
                if (Array.isArray(data) && data.length > 0) {
                    const firstItem = data[0];
                    const keys = Object.keys(firstItem);
                    return `包含字段: ${keys.join(', ')}`;
                } else if (typeof data === 'object') {
                    const keys = Object.keys(data);
                    return `对象字段: ${keys.join(', ')}`;
                }
                return 'JSON数据';
            } catch {
                return '无效的JSON数据';
            }
        }

        function generateDetailedInfo(jsonData) {
            try {
                const data = JSON.parse(jsonData);
                if (Array.isArray(data) && data.length > 0) {
                    const firstItem = data[0];
                    const keys = Object.keys(firstItem);
                    const sampleData = keys.slice(0, 5).map(key => {
                        const value = firstItem[key];
                        const displayValue = typeof value === 'object' ? JSON.stringify(value) : String(value);
                        return `${key}: ${displayValue.length > 50 ? displayValue.substring(0, 50) + '...' : displayValue}`;
                    }).join('\n');
                    
                    return {
                        type: 'array',
                        count: data.length,
                        fields: keys,
                        sampleData: sampleData,
                        allFields: keys.join(', ')
                    };
                } else if (typeof data === 'object') {
                    const keys = Object.keys(data);
                    const sampleData = keys.slice(0, 5).map(key => {
                        const value = data[key];
                        const displayValue = typeof value === 'object' ? JSON.stringify(value) : String(value);
                        return `${key}: ${displayValue.length > 50 ? displayValue.substring(0, 50) + '...' : displayValue}`;
                    }).join('\n');
                    
                    return {
                        type: 'object',
                        count: 1,
                        fields: keys,
                        sampleData: sampleData,
                        allFields: keys.join(', ')
                    };
                }
                return {
                    type: 'unknown',
                    count: 0,
                    fields: [],
                    sampleData: '无数据',
                    allFields: ''
                };
            } catch {
                return {
                    type: 'error',
                    count: 0,
                    fields: [],
                    sampleData: 'JSON解析错误',
                    allFields: ''
                };
            }
        }

        function toggleHistoryPanel() {
            const panel = document.getElementById('historyPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                loadHistoryList();
            } else {
                panel.style.display = 'none';
            }
        }

        function loadHistoryList() {
            const historyList = document.getElementById('historyList');
            const history = getHistory();
            
            if (history.length === 0) {
                historyList.innerHTML = '<div class="empty-history">暂无历史记录</div>';
                return;
            }
            
            historyList.innerHTML = '';
            history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                // 获取详细信息
                const detailedInfo = item.detailedInfo || generateDetailedInfo(item.data);
                
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-title">${item.title}</div>
                        <div class="history-item-time">${formatTime(item.timestamp)}</div>
                    </div>
                    <div class="history-item-stats">
                        <div class="history-item-stat">
                            <span>📊</span> 类型: <span>${detailedInfo.type === 'array' ? '数组' : detailedInfo.type === 'object' ? '对象' : '未知'}</span>
                        </div>
                        <div class="history-item-stat">
                            <span>📝</span> 数量: <span>${detailedInfo.count}</span>
                        </div>
                        <div class="history-item-stat">
                            <span>🏷️</span> 字段: <span>${detailedInfo.fields.length}</span>
                        </div>
                    </div>
                    <div class="history-item-preview">${item.preview}</div>
                    <div class="history-item-details" id="details-${item.id}"><strong>字段列表:</strong>
${detailedInfo.allFields || '无'}

${detailedInfo.sampleData ? '<strong>示例数据:</strong>\n' + detailedInfo.sampleData : ''}</div>
                    <div class="history-item-actions">
                        <button onclick="loadHistoryItem('${item.id}')">加载</button>
                        <button class="toggle-details-btn" onclick="toggleHistoryDetails('${item.id}', event)">详情</button>
                        <button class="delete-btn" onclick="deleteHistoryItem('${item.id}')">删除</button>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }

        function loadHistoryItem(id) {
            const history = getHistory();
            const item = history.find(h => h.id.toString() === id);
            if (item) {
                document.getElementById('jsonInput').value = item.data;
                
                // 直接解析数据，不保存到历史记录（避免重复保存）
                try {
                    const parsed = JSON.parse(item.data);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        currentData = parsed;
                        initializeTable();
                        showMessage('历史记录已加载', 'success');
                        toggleHistoryPanel();
                    } else {
                        showMessage('历史记录数据无效');
                    }
                } catch (error) {
                    showMessage('历史记录数据格式错误');
                }
            }
        }

        function deleteHistoryItem(id) {
            if (confirm('确定要删除这条历史记录吗？')) {
                const history = getHistory();
                const filteredHistory = history.filter(h => h.id.toString() !== id);
                localStorage.setItem(HISTORY_KEY, JSON.stringify(filteredHistory));
                loadHistoryList();
                showMessage('历史记录已删除', 'success');
            }
        }

        function clearAllHistory() {
            if (confirm('确定要清空所有历史记录吗？此操作不可恢复。')) {
                localStorage.removeItem(HISTORY_KEY);
                loadHistoryList();
                showMessage('所有历史记录已清空', 'success');
            }
        }

        function toggleHistoryDetails(id, event) {
            const detailsElement = document.getElementById(`details-${id}`);
            const button = event ? event.target : document.querySelector(`button[onclick*="toggleHistoryDetails('${id}')"]`);
            
            if (!detailsElement) {
                console.error('Details element not found for id:', id);
                return;
            }
            
            if (detailsElement.classList.contains('expanded')) {
                detailsElement.classList.remove('expanded');
                if (button) button.textContent = '详情';
            } else {
                detailsElement.classList.add('expanded');
                if (button) button.textContent = '收起';
            }
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) { // 1分钟内
                return '刚刚';
            } else if (diff < 3600000) { // 1小时内
                return `${Math.floor(diff / 60000)}分钟前`;
            } else if (diff < 86400000) { // 1天内
                return `${Math.floor(diff / 3600000)}小时前`;
            } else {
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
            }
        }


        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 可以在这里添加一些初始化代码
        });
    </script>
</body>
</html>
