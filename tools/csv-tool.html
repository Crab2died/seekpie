<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSVÂ±ïÁ§∫Â∑•ÂÖ∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .upload-section {
            padding: 40px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .upload-area {
            border: 3px dashed #4facfe;
            border-radius: 15px;
            padding: 60px 20px;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .upload-area:hover {
            border-color: #00f2fe;
            background: #f0f8ff;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #00f2fe;
            background: #e6f3ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #4facfe;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 15px;
        }

        .upload-hint {
            color: #999;
            font-size: 0.9em;
        }

        #fileInput {
            display: none;
        }

        .file-info {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            font-weight: bold;
            color: #2d5a2d;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .data-section {
            padding: 40px;
            display: none;
        }

        .data-section.show {
            display: block;
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .data-title {
            font-size: 1.5em;
            color: #333;
            font-weight: 500;
        }

        .data-stats {
            color: #666;
            font-size: 0.9em;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-size-selector label {
            color: #666;
            font-size: 0.9em;
        }

        .page-size-selector select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 0.9em;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 200px;
            font-size: 0.9em;
        }

        .search-box .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s ease;
            position: relative;
            white-space: nowrap;
        }

        th:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        th.sortable {
            padding-right: 30px;
        }

        .sort-icon {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        th:hover .sort-icon {
            opacity: 1;
        }

        th.sort-asc .sort-icon::after {
            content: '‚ñ≤';
            color: #fff;
        }

        th.sort-desc .sort-icon::after {
            content: '‚ñº';
            color: #fff;
        }

        th.sort-none .sort-icon::after {
            content: '‚áÖ';
            color: rgba(255, 255, 255, 0.5);
        }

        .sort-priority {
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 4px;
            display: inline-block;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            position: relative;
        }

        td:hover {
            overflow: visible;
            z-index: 5;
        }

        td:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            top: 100%;
            left: 0;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9em;
            white-space: normal;
            max-width: 300px;
            word-wrap: break-word;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        td.expanded {
            white-space: normal;
            max-width: none;
            overflow: visible;
        }

        td.expanded:hover::after {
            display: none;
        }

        tr:hover td {
            background-color: #f8f9ff;
        }

        tr:nth-child(even) td {
            background-color: #fafafa;
        }

        tr:nth-child(even):hover td {
            background-color: #f0f8ff;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
        }

        .pagination button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .pagination button:hover:not(:disabled) {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .current-page {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .page-info {
            color: #666;
            font-size: 0.9em;
            margin: 0 15px;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-data-icon {
            font-size: 3em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .error-message {
            background: #ffe6e6;
            color: #d63031;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        .export-btn {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .export-btn:hover {
            background: #218838;
        }

        #clearSort:hover {
            background: #5a6268 !important;
        }

        /* Âπ≥ÊùøÂíå‰∏≠Á≠âÂ±èÂπï */
        @media (max-width: 1024px) {
            .upload-section {
                padding: 35px;
            }

            .data-section {
                padding: 35px;
            }
        }

        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 12px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 0.95em;
            }

            .header p:last-child {
                font-size: 0.85em;
            }

            .upload-section {
                padding: 20px 15px;
            }

            .upload-area {
                padding: 40px 15px;
            }

            .upload-icon {
                font-size: 3em;
                margin-bottom: 15px;
            }

            .upload-text {
                font-size: 1.1em;
            }

            .upload-hint {
                font-size: 0.85em;
            }

            .file-info {
                margin-top: 15px;
                padding: 12px;
            }

            .data-section {
                padding: 20px 15px;
            }

            .data-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .data-title {
                font-size: 1.3em;
                text-align: center;
            }

            .data-stats {
                font-size: 0.85em;
                text-align: center;
            }

            .controls {
                flex-direction: column;
                gap: 12px;
            }

            .page-size-selector {
                justify-content: center;
            }

            .page-size-selector select {
                padding: 8px 12px;
                font-size: 0.9em;
            }

            .search-box {
                width: 100%;
            }

            .search-box input {
                width: 100%;
                padding: 10px 35px 10px 12px;
            }

            .export-buttons {
                margin-left: 0;
                justify-content: center;
                flex-wrap: wrap;
                width: 100%;
            }

            .export-btn {
                flex: 1;
                min-width: 100px;
                padding: 10px 12px;
                font-size: 0.85em;
            }

            .table-container {
                border-radius: 8px;
                margin-bottom: 20px;
            }

            th {
                padding: 12px 8px;
                font-size: 0.9em;
            }

            td {
                padding: 10px 8px;
                font-size: 0.9em;
                max-width: 150px;
            }

            .pagination {
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 20px;
            }

            .pagination button {
                padding: 8px 12px;
                font-size: 0.85em;
            }

            .page-info {
                width: 100%;
                text-align: center;
                margin: 10px 0 0 0;
                font-size: 0.85em;
            }

            .no-data {
                padding: 40px 20px;
            }

            .no-data-icon {
                font-size: 2.5em;
            }

            .error-message {
                padding: 12px;
                font-size: 0.9em;
            }
        }

        /* Â∞èÂ±èÊâãÊú∫‰ºòÂåñ */
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .container {
                border-radius: 10px;
            }

            .header {
                padding: 15px 12px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .header p {
                font-size: 0.9em;
            }

            .header p:last-child {
                font-size: 0.8em;
            }

            .upload-section {
                padding: 15px 12px;
            }

            .upload-area {
                padding: 35px 12px;
            }

            .upload-icon {
                font-size: 2.5em;
            }

            .upload-text {
                font-size: 1em;
            }

            .upload-hint {
                font-size: 0.8em;
            }

            .file-info {
                padding: 10px;
            }

            .data-section {
                padding: 15px 12px;
            }

            .data-title {
                font-size: 1.2em;
            }

            .data-stats {
                font-size: 0.8em;
            }

            .page-size-selector label {
                font-size: 0.85em;
            }

            .page-size-selector select {
                padding: 6px 10px;
                font-size: 0.85em;
            }

            .export-btn {
                padding: 8px 10px;
                font-size: 0.8em;
                min-width: 80px;
            }

            th {
                padding: 10px 6px;
                font-size: 0.85em;
            }

            td {
                padding: 8px 6px;
                font-size: 0.85em;
                max-width: 120px;
            }

            .sort-priority {
                font-size: 0.7em;
                padding: 1px 4px;
            }

            .pagination button {
                padding: 6px 10px;
                font-size: 0.8em;
            }

            .page-info {
                font-size: 0.8em;
            }

            .no-data {
                padding: 30px 15px;
            }

            .no-data-icon {
                font-size: 2em;
            }
        }

        /* Ë∂ÖÂ∞èÂ±èÊâãÊú∫ */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.3em;
            }

            .header p {
                font-size: 0.85em;
            }

            .header p:last-child {
                font-size: 0.75em;
            }

            .data-title {
                font-size: 1.1em;
            }

            .data-stats {
                font-size: 0.75em;
            }

            .export-btn {
                font-size: 0.75em;
                padding: 6px 8px;
            }

            th {
                padding: 8px 4px;
                font-size: 0.8em;
            }

            td {
                padding: 6px 4px;
                font-size: 0.8em;
                max-width: 100px;
            }

            .pagination button {
                padding: 5px 8px;
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
            <div class="header">
                <h1>üìä CSVÂ±ïÁ§∫Â∑•ÂÖ∑</h1>
                <p>‰∏ä‰º†CSVÊñá‰ª∂Ôºå‰ª•Ë°®Ê†ºÂΩ¢ÂºèÂ±ïÁ§∫Êï∞ÊçÆÔºåÊîØÊåÅÂàÜÈ°µ„ÄÅÊêúÁ¥¢ÂíåÊéíÂ∫èÂäüËÉΩ</p>
                <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
                    üí° ÊèêÁ§∫ÔºöÁÇπÂáªË°®Â§¥ÊéíÂ∫è | Êåâ‰ΩèShiftÁÇπÂáªÂ§öÂàóÊéíÂ∫è | ÊÇ¨ÂÅúÊü•ÁúãÂÆåÊï¥ÂÜÖÂÆπ | ÂèåÂáªÂçïÂÖÉÊ†ºÂ±ïÂºÄ/Êî∂Áº©
                </p>
            </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">ÁÇπÂáªÈÄâÊã©CSVÊñá‰ª∂ÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ</div>
                <div class="upload-hint">ÊîØÊåÅ .csv Ê†ºÂºèÊñá‰ª∂</div>
            </div>
            <input type="file" id="fileInput" accept=".csv" />
            
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName"></div>
                <div class="file-size" id="fileSize"></div>
            </div>

            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="data-section" id="dataSection">
            <div class="data-header">
                <div>
                    <div class="data-title">Êï∞ÊçÆÂ±ïÁ§∫</div>
                    <div class="data-stats" id="dataStats"></div>
                </div>
                <div class="controls">
                    <div class="page-size-selector">
                        <label for="pageSize">ÊØèÈ°µÊòæÁ§∫:</label>
                        <select id="pageSize">
                            <option value="10">10Êù°</option>
                            <option value="25" selected>25Êù°</option>
                            <option value="50">50Êù°</option>
                            <option value="100">100Êù°</option>
                        </select>
                    </div>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢Êï∞ÊçÆ...">
                        <span class="search-icon">üîç</span>
                    </div>
                    <div class="export-buttons">
                        <button class="export-btn" id="clearSort" style="background: #6c757d; display: none;">Ê∏ÖÈô§ÊéíÂ∫è</button>
                        <button class="export-btn" id="exportCsv">ÂØºÂá∫CSV</button>
                        <button class="export-btn" id="exportJson">ÂØºÂá∫JSON</button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script>
        class CSVViewer {
            constructor() {
                this.csvData = [];
                this.filteredData = [];
                this.originalFilteredData = [];
                this.currentPage = 1;
                this.pageSize = 25;
                this.headers = [];
                this.searchTerm = '';
                this.sortColumns = []; // Êï∞ÁªÑÔºåÂ≠òÂÇ®Â§ö‰∏™ÊéíÂ∫èÂàó [{column: 'ÂàóÂêç', direction: 'asc/desc'}]
                
                this.initializeElements();
                this.bindEvents();
            }

            initializeElements() {
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.fileInfo = document.getElementById('fileInfo');
                this.fileName = document.getElementById('fileName');
                this.fileSize = document.getElementById('fileSize');
                this.errorMessage = document.getElementById('errorMessage');
                this.dataSection = document.getElementById('dataSection');
                this.dataStats = document.getElementById('dataStats');
                this.pageSizeSelect = document.getElementById('pageSize');
                this.searchInput = document.getElementById('searchInput');
                this.tableHead = document.getElementById('tableHead');
                this.tableBody = document.getElementById('tableBody');
                this.pagination = document.getElementById('pagination');
                this.exportCsvBtn = document.getElementById('exportCsv');
                this.exportJsonBtn = document.getElementById('exportJson');
                this.clearSortBtn = document.getElementById('clearSort');
            }

            bindEvents() {
                // Êñá‰ª∂‰∏ä‰º†‰∫ã‰ª∂
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e.target.files[0]));
                
                // ÊãñÊãΩ‰∫ã‰ª∂
                this.uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.add('dragover');
                });
                
                this.uploadArea.addEventListener('dragleave', () => {
                    this.uploadArea.classList.remove('dragover');
                });
                
                this.uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file && file.type === 'text/csv') {
                        this.handleFileSelect(file);
                    } else {
                        this.showError('ËØ∑ÈÄâÊã©CSVÊ†ºÂºèÁöÑÊñá‰ª∂');
                    }
                });

                // ÂàÜÈ°µÂíåÊêúÁ¥¢‰∫ã‰ª∂
                this.pageSizeSelect.addEventListener('change', (e) => {
                    this.pageSize = parseInt(e.target.value);
                    this.currentPage = 1;
                    this.renderTable();
                });

                this.searchInput.addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase();
                    this.currentPage = 1;
                    this.filterData();
                    this.renderTable();
                });

                // ÂØºÂá∫‰∫ã‰ª∂
                this.exportCsvBtn.addEventListener('click', () => this.exportToCSV());
                this.exportJsonBtn.addEventListener('click', () => this.exportToJSON());
                
                // Ê∏ÖÈô§ÊéíÂ∫è‰∫ã‰ª∂
                this.clearSortBtn.addEventListener('click', () => this.clearAllSorts());
            }

            handleFileSelect(file) {
                if (!file) return;
                
                if (!file.name.toLowerCase().endsWith('.csv')) {
                    this.showError('ËØ∑ÈÄâÊã©CSVÊ†ºÂºèÁöÑÊñá‰ª∂');
                    return;
                }

                this.showFileInfo(file);
                this.hideError();
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        this.parseCSV(e.target.result);
                        this.showDataSection();
                    } catch (error) {
                        this.showError('CSVÊñá‰ª∂Ëß£ÊûêÂ§±Ë¥•: ' + error.message);
                    }
                };
                reader.readAsText(file, 'UTF-8');
            }

            showFileInfo(file) {
                this.fileName.textContent = file.name;
                this.fileSize.textContent = this.formatFileSize(file.size);
                this.fileInfo.classList.add('show');
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            parseCSV(csvText) {
                const lines = csvText.split('\n').filter(line => line.trim());
                if (lines.length === 0) {
                    throw new Error('CSVÊñá‰ª∂‰∏∫Á©∫');
                }

                // Ëß£ÊûêË°®Â§¥
                this.headers = this.parseCSVLine(lines[0]);
                
                // Ëß£ÊûêÊï∞ÊçÆË°å
                this.csvData = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = this.parseCSVLine(lines[i]);
                    if (values.length > 0) {
                        const row = {};
                        this.headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        this.csvData.push(row);
                    }
                }

                this.filteredData = [...this.csvData];
                this.originalFilteredData = [...this.csvData];
                this.currentPage = 1;
            }

            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result;
            }

            filterData() {
                if (!this.searchTerm) {
                    this.filteredData = [...this.csvData];
                } else {
                    this.filteredData = this.csvData.filter(row => {
                        return Object.values(row).some(value => 
                            value.toString().toLowerCase().includes(this.searchTerm)
                        );
                    });
                }
                
                // ‰øùÂ≠òÂéüÂßãËøáÊª§ÂêéÁöÑÈ°∫Â∫èÔºàÁî®‰∫éÂèñÊ∂àÊéíÂ∫èÔºâ
                this.originalFilteredData = [...this.filteredData];
                
                // Â∫îÁî®ÊéíÂ∫è
                this.applySorting();
            }

            applySorting() {
                if (this.sortColumns.length === 0) {
                    // Ê≤°ÊúâÊéíÂ∫èÔºåÊÅ¢Â§çÂà∞ÂéüÂßãÈ°∫Â∫è
                    if (this.originalFilteredData) {
                        this.filteredData = [...this.originalFilteredData];
                    }
                } else {
                    // Â§öÂàóÊéíÂ∫è
                    this.filteredData.sort((a, b) => {
                        // ÊåâÁÖßÊéíÂ∫èÂàóÁöÑ‰ºòÂÖàÁ∫ß‰æùÊ¨°ÊØîËæÉ
                        for (let sortInfo of this.sortColumns) {
                            const column = sortInfo.column;
                            const direction = sortInfo.direction;
                            
                            const aVal = a[column] || '';
                            const bVal = b[column] || '';
                            
                            // Â∞ùËØïÊï∞Â≠óÊØîËæÉ
                            const aNum = parseFloat(aVal);
                            const bNum = parseFloat(bVal);
                            
                            let compareResult = 0;
                            
                            if (!isNaN(aNum) && !isNaN(bNum)) {
                                compareResult = aNum - bNum;
                            } else {
                                // Â≠óÁ¨¶‰∏≤ÊØîËæÉ
                                const aStr = aVal.toString().toLowerCase();
                                const bStr = bVal.toString().toLowerCase();
                                compareResult = aStr.localeCompare(bStr, 'zh-CN');
                            }
                            
                            if (compareResult !== 0) {
                                return direction === 'asc' ? compareResult : -compareResult;
                            }
                            // Â¶ÇÊûúÁõ∏Á≠âÔºåÁªßÁª≠ÊØîËæÉ‰∏ã‰∏Ä‰∏™ÊéíÂ∫èÂàó
                        }
                        return 0;
                    });
                }
            }

            sortColumn(column, shiftKey = false) {
                if (!shiftKey) {
                    // ‰∏çÊåâShiftÈîÆÔºåÊ∏ÖÁ©∫ÂÖ∂‰ªñÊéíÂ∫èÔºåÂè™ÂØπÂΩìÂâçÂàóÊéíÂ∫è
                    const existingIndex = this.sortColumns.findIndex(s => s.column === column);
                    
                    if (existingIndex !== -1) {
                        const currentDirection = this.sortColumns[existingIndex].direction;
                        
                        if (currentDirection === 'asc') {
                            // ÂçáÂ∫è -> ÈôçÂ∫è
                            this.sortColumns = [{column: column, direction: 'desc'}];
                        } else {
                            // ÈôçÂ∫è -> ÂèñÊ∂àÊéíÂ∫è
                            this.sortColumns = [];
                        }
                    } else {
                        // Êñ∞ÂàóÔºåÈªòËÆ§ÂçáÂ∫è
                        this.sortColumns = [{column: column, direction: 'asc'}];
                    }
                } else {
                    // Êåâ‰ΩèShiftÈîÆÔºåÊ∑ªÂä†Êàñ‰øÆÊîπÂ§öÂàóÊéíÂ∫è
                    const existingIndex = this.sortColumns.findIndex(s => s.column === column);
                    
                    if (existingIndex !== -1) {
                        const currentDirection = this.sortColumns[existingIndex].direction;
                        
                        if (currentDirection === 'asc') {
                            // ÂçáÂ∫è -> ÈôçÂ∫è
                            this.sortColumns[existingIndex].direction = 'desc';
                        } else {
                            // ÈôçÂ∫è -> ÁßªÈô§ËØ•ÂàóÊéíÂ∫è
                            this.sortColumns.splice(existingIndex, 1);
                        }
                    } else {
                        // Ê∑ªÂä†Êñ∞ÁöÑÊéíÂ∫èÂàó
                        this.sortColumns.push({column: column, direction: 'asc'});
                    }
                }
                
                this.currentPage = 1;
                this.applySorting();
                this.renderTable();
                this.updateClearSortButton();
            }

            clearAllSorts() {
                this.sortColumns = [];
                this.currentPage = 1;
                this.applySorting();
                this.renderTable();
                this.updateClearSortButton();
            }

            updateClearSortButton() {
                if (this.sortColumns.length > 0) {
                    this.clearSortBtn.style.display = 'inline-block';
                } else {
                    this.clearSortBtn.style.display = 'none';
                }
            }

            showDataSection() {
                this.dataSection.classList.add('show');
                this.updateDataStats();
                this.renderTable();
            }

            updateDataStats() {
                const total = this.csvData.length;
                const filtered = this.filteredData.length;
                const pages = Math.ceil(filtered / this.pageSize);
                
                let statsText = `ÂÖ± ${total} Êù°Êï∞ÊçÆÔºåÁ≠õÈÄâÂêé ${filtered} Êù°ÔºåÂÖ± ${pages} È°µ`;
                
                if (this.sortColumns.length > 0) {
                    const sortDescriptions = this.sortColumns.map((sortInfo, index) => {
                        const direction = sortInfo.direction === 'asc' ? '‚Üë' : '‚Üì';
                        const priority = this.sortColumns.length > 1 ? `[${index + 1}]` : '';
                        return `${priority}${sortInfo.column}${direction}`;
                    });
                    statsText += ` | ÊéíÂ∫è: ${sortDescriptions.join(', ')}`;
                }
                
                this.dataStats.textContent = statsText;
            }

            renderTable() {
                this.updateDataStats();
                this.renderTableHead();
                this.renderTableBody();
                this.renderPagination();
            }

            renderTableHead() {
                this.tableHead.innerHTML = '';
                const tr = document.createElement('tr');
                
                this.headers.forEach(header => {
                    const th = document.createElement('th');
                    th.className = 'sortable';
                    
                    // Êü•ÊâæËØ•ÂàóÊòØÂê¶Âú®ÊéíÂ∫èÂàóË°®‰∏≠
                    const sortIndex = this.sortColumns.findIndex(s => s.column === header);
                    
                    // ËÆæÁΩÆÂàóÂêçÂíåÊéíÂ∫è‰ºòÂÖàÁ∫ß
                    if (sortIndex !== -1 && this.sortColumns.length > 1) {
                        // Â§öÂàóÊéíÂ∫èÊó∂ÊòæÁ§∫‰ºòÂÖàÁ∫ßÊï∞Â≠ó
                        th.textContent = header + ' ';
                        const priorityBadge = document.createElement('span');
                        priorityBadge.className = 'sort-priority';
                        priorityBadge.textContent = (sortIndex + 1);
                        th.appendChild(priorityBadge);
                    } else {
                        th.textContent = header;
                    }
                    
                    // Ê∑ªÂä†ÊéíÂ∫èÂõæÊ†á
                    const sortIcon = document.createElement('span');
                    sortIcon.className = 'sort-icon';
                    th.appendChild(sortIcon);
                    
                    // ËÆæÁΩÆÊéíÂ∫èÁä∂ÊÄÅ
                    if (sortIndex !== -1) {
                        th.classList.add(`sort-${this.sortColumns[sortIndex].direction}`);
                    } else {
                        th.classList.add('sort-none');
                    }
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Ôºà‰º†ÈÄíshiftKeyÁä∂ÊÄÅÔºâ
                    th.addEventListener('click', (e) => this.sortColumn(header, e.shiftKey));
                    
                    tr.appendChild(th);
                });
                
                this.tableHead.appendChild(tr);
            }

            renderTableBody() {
                this.tableBody.innerHTML = '';
                
                if (this.filteredData.length === 0) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    td.colSpan = this.headers.length;
                    td.className = 'no-data';
                    td.innerHTML = `
                        <div class="no-data-icon">üìä</div>
                        <div>Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÊï∞ÊçÆ</div>
                    `;
                    tr.appendChild(td);
                    this.tableBody.appendChild(tr);
                    return;
                }

                const startIndex = (this.currentPage - 1) * this.pageSize;
                const endIndex = Math.min(startIndex + this.pageSize, this.filteredData.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const row = this.filteredData[i];
                    const tr = document.createElement('tr');
                    
                    this.headers.forEach(header => {
                        const td = document.createElement('td');
                        const cellValue = row[header] || '';
                        td.textContent = cellValue;
                        td.setAttribute('data-tooltip', cellValue);
                        
                        // Ê∑ªÂä†ÂèåÂáªÂ±ïÂºÄ/Êî∂Áº©ÂäüËÉΩ
                        td.addEventListener('dblclick', () => {
                            td.classList.toggle('expanded');
                        });
                        
                        tr.appendChild(td);
                    });
                    
                    this.tableBody.appendChild(tr);
                }
            }

            renderPagination() {
                this.pagination.innerHTML = '';
                
                const totalPages = Math.ceil(this.filteredData.length / this.pageSize);
                if (totalPages <= 1) return;

                // ‰∏ä‰∏ÄÈ°µÊåâÈíÆ
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '‰∏ä‰∏ÄÈ°µ';
                prevBtn.disabled = this.currentPage === 1;
                prevBtn.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.renderTable();
                    }
                });
                this.pagination.appendChild(prevBtn);

                // È°µÁ†ÅÊåâÈíÆ
                const startPage = Math.max(1, this.currentPage - 2);
                const endPage = Math.min(totalPages, this.currentPage + 2);

                if (startPage > 1) {
                    const firstBtn = document.createElement('button');
                    firstBtn.textContent = '1';
                    firstBtn.addEventListener('click', () => {
                        this.currentPage = 1;
                        this.renderTable();
                    });
                    this.pagination.appendChild(firstBtn);

                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.style.padding = '10px';
                        this.pagination.appendChild(ellipsis);
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    if (i === this.currentPage) {
                        pageBtn.classList.add('current-page');
                    }
                    pageBtn.addEventListener('click', () => {
                        this.currentPage = i;
                        this.renderTable();
                    });
                    this.pagination.appendChild(pageBtn);
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.style.padding = '10px';
                        this.pagination.appendChild(ellipsis);
                    }

                    const lastBtn = document.createElement('button');
                    lastBtn.textContent = totalPages;
                    lastBtn.addEventListener('click', () => {
                        this.currentPage = totalPages;
                        this.renderTable();
                    });
                    this.pagination.appendChild(lastBtn);
                }

                // ‰∏ã‰∏ÄÈ°µÊåâÈíÆ
                const nextBtn = document.createElement('button');
                nextBtn.textContent = '‰∏ã‰∏ÄÈ°µ';
                nextBtn.disabled = this.currentPage === totalPages;
                nextBtn.addEventListener('click', () => {
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.renderTable();
                    }
                });
                this.pagination.appendChild(nextBtn);

                // È°µÈù¢‰ø°ÊÅØ
                const pageInfo = document.createElement('span');
                pageInfo.className = 'page-info';
                pageInfo.textContent = `Á¨¨ ${this.currentPage} È°µÔºåÂÖ± ${totalPages} È°µ`;
                this.pagination.appendChild(pageInfo);
            }

            exportToCSV() {
                if (this.csvData.length === 0) return;
                
                let csvContent = this.headers.join(',') + '\n';
                this.csvData.forEach(row => {
                    const values = this.headers.map(header => {
                        const value = row[header] || '';
                        return value.includes(',') ? `"${value}"` : value;
                    });
                    csvContent += values.join(',') + '\n';
                });

                this.downloadFile(csvContent, 'data.csv', 'text/csv');
            }

            exportToJSON() {
                if (this.csvData.length === 0) return;
                
                const jsonContent = JSON.stringify(this.csvData, null, 2);
                this.downloadFile(jsonContent, 'data.json', 'application/json');
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.classList.add('show');
            }

            hideError() {
                this.errorMessage.classList.remove('show');
            }
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', () => {
            new CSVViewer();
        });
    </script>
</body>
</html>
