<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSVå±•ç¤ºå·¥å…· - åœ¨çº¿CSVæ–‡ä»¶æŸ¥çœ‹ã€æœç´¢å’Œæ’åºå·¥å…·</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="å…è´¹åœ¨çº¿CSVæ–‡ä»¶å±•ç¤ºå·¥å…·ï¼Œæ”¯æŒCSVæ–‡ä»¶ä¸Šä¼ ã€æ–‡æœ¬è¾“å…¥ã€è¡¨æ ¼æŸ¥çœ‹ã€æ•°æ®æœç´¢ã€æ’åºå’Œåˆ†é¡µåŠŸèƒ½ã€‚æ“ä½œç®€å•ï¼Œæ— éœ€å®‰è£…è½¯ä»¶ï¼Œæ”¯æŒå¤§æ–‡ä»¶å¤„ç†ï¼Œæ•°æ®å®‰å…¨ä¸ä¸Šä¼ æœåŠ¡å™¨ã€‚">
    <meta name="keywords" content="CSVå·¥å…·,CSVæŸ¥çœ‹å™¨,CSVæ–‡ä»¶,åœ¨çº¿CSV,è¡¨æ ¼æŸ¥çœ‹,æ•°æ®å±•ç¤º,CSVè½¬è¡¨æ ¼,ExcelæŸ¥çœ‹,CSVæ–‡æœ¬è¾“å…¥">
    <meta name="author" content="å¤šåŠŸèƒ½å·¥å…·ç®±">
    <meta name="robots" content="index, follow">
    <meta name="language" content="zh-CN">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.seekpie.com/tools/csv-tool.html">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "CSVå±•ç¤ºå·¥å…·",
      "description": "å…è´¹åœ¨çº¿CSVæ–‡ä»¶å±•ç¤ºå·¥å…·ï¼Œæ”¯æŒä¸Šä¼ ã€æŸ¥çœ‹ã€æœç´¢å’Œæ’åºåŠŸèƒ½",
      "url": "https://www.seekpie.com/tools/csv-tool.html",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "CNY"
      },
      "featureList": [
        "CSVæ–‡ä»¶ä¸Šä¼ ",
        "æ–‡æœ¬ç›´æ¥è¾“å…¥",
        "è¡¨æ ¼å±•ç¤º",
        "æ•°æ®æœç´¢",
        "æ’åºåŠŸèƒ½",
        "åˆ†é¡µæ˜¾ç¤º",
        "æœ¬åœ°å¤„ç†ï¼Œæ•°æ®å®‰å…¨"
      ]
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .upload-section {
            padding: 40px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .input-mode-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-tab {
            padding: 10px 30px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            color: #666;
        }

        .mode-tab:hover {
            background: #e6f3ff;
            border-color: #4facfe;
        }

        .mode-tab.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-color: #4facfe;
        }

        .upload-area {
            border: 3px dashed #4facfe;
            border-radius: 15px;
            padding: 60px 20px;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .text-input-area {
            display: none;
            text-align: left;
        }

        .text-input-area.show {
            display: block;
        }

        .text-input-label {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 10px;
            display: block;
        }

        .text-input-hint {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .csv-textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #4facfe;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            resize: vertical;
            background: white;
        }

        .csv-textarea:focus {
            outline: none;
            border-color: #00f2fe;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.3);
        }

        .parse-btn {
            margin-top: 15px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .parse-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .parse-btn:active {
            transform: translateY(0);
        }

        .upload-area:hover {
            border-color: #00f2fe;
            background: #f0f8ff;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #00f2fe;
            background: #e6f3ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #4facfe;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 15px;
        }

        .upload-hint {
            color: #999;
            font-size: 0.9em;
        }

        #fileInput {
            display: none;
        }

        .file-info {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            font-weight: bold;
            color: #2d5a2d;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .data-section {
            padding: 40px;
            display: none;
        }

        .data-section.show {
            display: block;
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .data-title {
            font-size: 1.5em;
            color: #333;
            font-weight: 500;
        }

        .data-stats {
            color: #666;
            font-size: 0.9em;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            /* margin-top: 20px; */
            text-align: center;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-size-selector label {
            color: #666;
            font-size: 0.9em;
        }

        .page-size-selector select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 0.9em;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 300px;
            font-size: 0.9em;
        }

        .search-box .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            /* margin-bottom: 30px; */
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            position: relative;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s ease;
            white-space: nowrap;
        }

        th:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        th.sortable {
            padding-right: 30px;
            position: relative;
        }

        .sort-icon {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        th:hover .sort-icon {
            opacity: 1;
        }

        th.sort-asc .sort-icon::after {
            content: 'â–²';
            color: #fff;
        }

        th.sort-desc .sort-icon::after {
            content: 'â–¼';
            color: #fff;
        }

        th.sort-none .sort-icon::after {
            content: 'â‡…';
            color: rgba(255, 255, 255, 0.5);
        }

        .sort-priority {
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 4px;
            display: inline-block;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            position: relative;
        }

        td:hover {
            overflow: visible;
            z-index: 5;
        }

        td:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            top: 100%;
            left: 0;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.9em;
            white-space: normal;
            max-width: 300px;
            word-wrap: break-word;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        td.expanded {
            white-space: normal;
            max-width: none;
            overflow: visible;
        }

        td.expanded:hover::after {
            display: none;
        }

        tr:hover td {
            background-color: #f8f9ff;
        }

        tr:nth-child(even) td {
            background-color: #fafafa;
        }

        tr:nth-child(even):hover td {
            background-color: #f0f8ff;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
        }

        .pagination button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .pagination button:hover:not(:disabled) {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .current-page {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .page-info {
            color: #666;
            font-size: 0.9em;
            margin: 0 15px;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-data-icon {
            font-size: 3em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .error-message {
            background: #ffe6e6;
            color: #d63031;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }

        .export-btn {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .export-btn:hover {
            background: #218838;
        }

        #clearSort:hover {
            background: #5a6268 !important;
        }

        .column-management {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .column-controls-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .column-select-all {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .column-select-all label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .column-select-all label:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }

        .column-select-all input[type="checkbox"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
            accent-color: #4facfe;
        }

        .column-select-all span {
            font-weight: 500;
            color: #495057;
            user-select: none;
        }

        /* åˆ—è¿‡æ»¤è®¾ç½®æ ·å¼ */
        .column-filter-options {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .column-filter-option {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 0;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .column-filter-option:hover {
            background: #f0f8ff;
        }
        
        .column-filter-option input[type="radio"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
            accent-color: #4facfe;
        }
        
        .column-filter-option span {
            font-weight: 500;
            color: #495057;
            user-select: none;
        }

        /* æ ‡ç­¾è¾“å…¥å®¹å™¨ */
        .tags-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            padding: 10px 12px;
            border: 2px solid #4facfe;
            border-radius: 6px;
            background: white;
            min-height: 48px;
            cursor: text;
            transition: all 0.3s ease;
        }
        
        .tags-input-container:focus-within {
            border-color: #00f2fe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }
        
        .tags-input-container.disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            border-color: #dee2e6;
        }
        
        .column-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 4px;
            font-size: 0.9em;
            user-select: none;
            transition: all 0.2s ease;
        }
        
        .column-tag:hover {
            background: linear-gradient(135deg, #3d9aed 0%, #00e0ed 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.3);
        }
        
        .column-tag-text {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .column-tag-remove {
            cursor: pointer;
            font-weight: bold;
            padding: 0 2px;
            border-radius: 3px;
            transition: background 0.2s ease;
        }
        
        .column-tag-remove:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .tags-input-field {
            flex: 1;
            min-width: 150px;
            border: none;
            outline: none;
            padding: 6px 0;
            font-size: 0.9em;
            background: transparent;
        }
        
        .tags-input-field:disabled {
            cursor: not-allowed;
        }

        /* åˆ—å†…å®¹è¿‡æ»¤åŒºåŸŸæ ·å¼ */
        .content-filter-section {
            background: #fff9e6;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffe4a3;
            margin-bottom: 15px;
        }
        
        .content-filter-header {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .content-filter-title {
            color: #495057;
        }
        
        .filter-logic-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 5px 12px;
            border-radius: 20px;
            border: 2px solid #ffe4a3;
        }
        
        .filter-logic-label {
            font-size: 0.85em;
            color: #495057;
            font-weight: 500;
        }
        
        .filter-logic-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            margin: 0;
        }
        
        .filter-logic-radio {
            cursor: pointer;
            accent-color: #f5576c;
        }
        
        .filter-logic-text {
            font-size: 0.9em;
            color: #495057;
            font-weight: 500;
        }
        
        .clear-all-filters-btn {
            padding: 6px 14px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .clear-all-filters-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .filter-input-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }
        
        .filter-input-row:hover {
            border-color: #4facfe;
        }
        
        .filter-input-field {
            flex: 1;
            min-width: 150px;
        }
        
        .filter-condition-field {
            min-width: 130px;
        }
        
        .filter-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }
        
        .filter-select {
            width: 100%;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .filter-add-btn {
            padding: 8px 16px;
            white-space: nowrap;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(79, 172, 254, 0.3);
        }
        
        /* åŠ¨æ€è¿‡æ»¤å™¨è¡Œæ ·å¼ */
        .filter-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }
        
        .filter-row:hover {
            border-color: #4facfe;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.1);
        }
        
        .filter-row-field {
            flex: 1;
            min-width: 150px;
        }
        
        .filter-row-condition {
            min-width: 130px;
        }
        
        .filter-row-input {
            width: 100%;
            padding: 6px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .filter-row-select {
            width: 100%;
            padding: 6px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .filter-row-delete-btn {
            padding: 6px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        
        .filter-row-delete-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .btn-sort-column {
            padding: 8px 16px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-sort-column:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
            background: linear-gradient(135deg, #3d9aed 0%, #00e0ed 100%);
        }

        .btn-toggle-columns {
            padding: 8px 16px;
            background: linear-gradient(135deg, #4fd6cf 0%, #d8567f 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-toggle-columns:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(168, 237, 234, 0.4);
            background: linear-gradient(135deg, #74dfd9 0%, #a5506b 100%);
        }

        #columnControlsRow {
            display: none;
            margin-top: 15px;
        }

        #columnControlsRow.show {
            display: flex;
        }

        #columnControls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .column-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 201px;
        }

        .column-toggle:hover {
            border-color: #4facfe;
        }

        .column-toggle.active {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .column-toggle > span:not(.drag-handle) {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100px;
            display: inline-block;
            vertical-align: middle;
        }

        .drag-handle {
            cursor: move;
            color: #6c757d;
            margin-right: 4px;
            user-select: none;
        }

        .column-toggle.dragging {
            opacity: 0.5;
        }

        /* å¹³æ¿å’Œä¸­ç­‰å±å¹• */
        @media (max-width: 1024px) {
            .upload-section {
                padding: 35px;
            }

            .data-section {
                padding: 35px;
            }
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 12px;
            }

            .input-mode-tabs {
                flex-direction: column;
                gap: 8px;
            }

            .mode-tab {
                padding: 12px 20px;
                width: 100%;
            }

            .csv-textarea {
                min-height: 250px;
                font-size: 0.85em;
            }

            .parse-btn {
                width: 100%;
                padding: 12px 20px;
            }

            .column-management {
                padding: 15px;
                margin-bottom: 15px;
            }

            .column-controls-header {
                flex-direction: column;
                align-items: stretch;
            }

            .column-select-all {
                flex-direction: column;
                align-items: stretch;
            }

            .column-select-all label,
            .btn-sort-column,
            .btn-toggle-columns {
                width: 100%;
                justify-content: center;
            }

            .column-toggle {
                min-width: 120px;
                padding: 6px 10px;
                font-size: 0.85em;
            }

            .column-toggle > span:not(.drag-handle) {
                max-width: 80px;
            }

            .column-filter-options {
                gap: 10px;
            }
            
            .column-filter-option {
                padding: 5px 10px;
                font-size: 0.9em;
            }
            
            .column-filter-option input[type="radio"] {
                width: 16px;
                height: 16px;
            }

            /* åˆ—å†…å®¹è¿‡æ»¤åŒºåŸŸ */
            .content-filter-header {
                flex-direction: column;
                align-items: flex-start !important;
                gap: 12px;
            }

            .filter-logic-selector {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                width: 100%;
            }

            .filter-logic-option {
                width: 100%;
                justify-content: flex-start;
            }

            .clear-all-filters-btn {
                width: 100%;
                justify-content: center;
                padding: 10px;
            }

            .filter-input-row {
                flex-direction: column !important;
                gap: 10px;
                padding: 12px;
            }

            .filter-input-field,
            .filter-condition-field {
                width: 100% !important;
                min-width: auto !important;
            }

            .filter-input,
            .filter-select {
                width: 100%;
                font-size: 14px;
            }

            .filter-add-btn {
                width: 100%;
                padding: 12px;
                font-size: 14px;
            }

            .filter-row {
                flex-direction: column !important;
                gap: 10px;
                padding: 12px;
            }

            .filter-row-field,
            .filter-row-condition {
                width: 100% !important;
                min-width: auto !important;
            }

            .filter-row-input,
            .filter-row-select {
                width: 100%;
                font-size: 14px;
            }

            .filter-row-delete-btn {
                width: 100%;
                padding: 10px;
                font-size: 14px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 0.95em;
            }

            .header p:last-child {
                font-size: 0.85em;
            }

            .upload-section {
                padding: 20px 15px;
            }

            .upload-area {
                padding: 40px 15px;
            }

            .upload-icon {
                font-size: 3em;
                margin-bottom: 15px;
            }

            .upload-text {
                font-size: 1.1em;
            }

            .upload-hint {
                font-size: 0.85em;
            }

            .file-info {
                margin-top: 15px;
                padding: 12px;
            }

            .data-section {
                padding: 20px 15px;
            }

            .data-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .data-title {
                font-size: 1.3em;
                text-align: center;
            }

            .data-stats {
                font-size: 0.85em;
                text-align: center;
                padding: 12px 15px;
                margin-top: 15px;
            }

            .controls {
                flex-direction: column;
                gap: 12px;
            }

            .page-size-selector {
                justify-content: center;
            }

            .page-size-selector select {
                padding: 8px 12px;
                font-size: 0.9em;
            }

            .search-box {
                width: 100%;
            }

            .search-box input {
                width: 100%;
                padding: 10px 35px 10px 12px;
            }

            .export-buttons {
                margin-left: 0;
                justify-content: center;
                flex-wrap: wrap;
                width: 100%;
            }

            .export-btn {
                flex: 1;
                min-width: 100px;
                padding: 10px 12px;
                font-size: 0.85em;
            }

            .table-container {
                border-radius: 8px;
                /* margin-bottom: 20px; */
            }

            th {
                padding: 12px 8px;
                font-size: 0.9em;
            }

            td {
                padding: 10px 8px;
                font-size: 0.9em;
                max-width: 150px;
            }

            .pagination {
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 20px;
            }

            .pagination button {
                padding: 8px 12px;
                font-size: 0.85em;
            }

            .page-info {
                width: 100%;
                text-align: center;
                margin: 10px 0 0 0;
                font-size: 0.85em;
            }

            .no-data {
                padding: 40px 20px;
            }

            .no-data-icon {
                font-size: 2.5em;
            }

            .error-message {
                padding: 12px;
                font-size: 0.9em;
            }
        }

        /* å°å±æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .container {
                border-radius: 10px;
            }

            .mode-tab {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .csv-textarea {
                min-height: 200px;
                font-size: 0.8em;
                padding: 12px;
            }

            .parse-btn {
                padding: 10px 20px;
                font-size: 0.9em;
            }

            .text-input-label {
                font-size: 1em;
            }

            .text-input-hint {
                font-size: 0.85em;
            }

            .column-management {
                padding: 12px;
            }

            .column-toggle {
                min-width: 100px;
                padding: 5px 8px;
                font-size: 0.8em;
            }

            .column-toggle > span:not(.drag-handle) {
                max-width: 60px;
            }

            .btn-sort-column,
            .btn-toggle-columns {
                font-size: 0.85em;
                padding: 8px 12px;
            }

            .column-filter-options {
                gap: 8px;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .column-filter-option {
                padding: 4px 8px;
                font-size: 0.85em;
                width: 100%;
            }
            
            .column-filter-option input[type="radio"] {
                width: 14px;
                height: 14px;
            }

            /* åˆ—å†…å®¹è¿‡æ»¤åŒºåŸŸ - å°å±ä¼˜åŒ– */
            .content-filter-title {
                font-size: 1em;
            }

            .filter-logic-selector {
                width: 100%;
            }

            .filter-logic-label {
                font-size: 0.85em;
            }

            .filter-logic-text {
                font-size: 0.85em;
            }

            .clear-all-filters-btn {
                font-size: 13px;
                padding: 8px;
            }

            .filter-input,
            .filter-select {
                font-size: 13px;
                padding: 8px;
            }

            .filter-add-btn {
                font-size: 13px;
                padding: 10px;
            }

            .filter-row-input,
            .filter-row-select {
                font-size: 13px;
                padding: 6px;
            }

            .filter-row-delete-btn {
                font-size: 13px;
                padding: 8px;
            }

            /* æ ‡ç­¾æ ·å¼è°ƒæ•´ */
            .column-tag {
                font-size: 0.85em;
                padding: 3px 8px;
            }

            .column-tag-text {
                max-width: 100px;
            }

            .tags-input-container {
                min-height: 38px;
                padding: 5px;
                gap: 5px;
            }

            .tags-input-field {
                min-width: 100px;
                font-size: 13px;
            }

            .header {
                padding: 15px 12px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .header p {
                font-size: 0.9em;
            }

            .header p:last-child {
                font-size: 0.8em;
            }

            .upload-section {
                padding: 15px 12px;
            }

            .upload-area {
                padding: 35px 12px;
            }

            .upload-icon {
                font-size: 2.5em;
            }

            .upload-text {
                font-size: 1em;
            }

            .upload-hint {
                font-size: 0.8em;
            }

            .file-info {
                padding: 10px;
            }

            .data-section {
                padding: 15px 12px;
            }

            .data-title {
                font-size: 1.2em;
            }

            .data-stats {
                font-size: 0.8em;
                padding: 10px 12px;
                margin-top: 12px;
            }

            .page-size-selector label {
                font-size: 0.85em;
            }

            .page-size-selector select {
                padding: 6px 10px;
                font-size: 0.85em;
            }

            .export-btn {
                padding: 8px 10px;
                font-size: 0.8em;
                min-width: 80px;
            }

            th {
                padding: 10px 6px;
                font-size: 0.85em;
            }

            td {
                padding: 8px 6px;
                font-size: 0.85em;
                max-width: 120px;
            }

            .sort-priority {
                font-size: 0.7em;
                padding: 1px 4px;
            }

            .pagination button {
                padding: 6px 10px;
                font-size: 0.8em;
            }

            .page-info {
                font-size: 0.8em;
            }

            .no-data {
                padding: 30px 15px;
            }

            .no-data-icon {
                font-size: 2em;
            }
        }

        /* è¶…å°å±æ‰‹æœº */
        @media (max-width: 360px) {
            /* åˆ—å†…å®¹è¿‡æ»¤åŒºåŸŸ - è¶…å°å±ä¼˜åŒ– */
            .content-filter-title {
                font-size: 0.95em;
            }

            .filter-logic-label {
                font-size: 0.8em;
            }

            .filter-logic-text {
                font-size: 0.8em;
            }

            .clear-all-filters-btn {
                font-size: 12px;
                padding: 6px;
            }

            .filter-input,
            .filter-select {
                font-size: 12px;
                padding: 6px;
            }

            .filter-add-btn {
                font-size: 12px;
                padding: 8px;
            }

            .filter-row-input,
            .filter-row-select {
                font-size: 12px;
                padding: 5px;
            }

            .filter-row-delete-btn {
                font-size: 12px;
                padding: 6px;
            }

            .column-tag {
                font-size: 0.8em;
                padding: 2px 6px;
            }

            .column-tag-text {
                max-width: 80px;
            }

            .tags-input-container {
                min-height: 35px;
                padding: 4px;
                gap: 4px;
            }

            .tags-input-field {
                min-width: 80px;
                font-size: 12px;
            }

            .header h1 {
                font-size: 1.3em;
            }

            .header p {
                font-size: 0.85em;
            }

            .header p:last-child {
                font-size: 0.75em;
            }

            .data-title {
                font-size: 1.1em;
            }

            .data-stats {
                font-size: 0.75em;
                padding: 8px 10px;
                margin-top: 10px;
            }

            .export-btn {
                font-size: 0.75em;
                padding: 6px 8px;
            }

            th {
                padding: 8px 4px;
                font-size: 0.8em;
            }

            td {
                padding: 6px 4px;
                font-size: 0.8em;
                max-width: 100px;
            }

            .pagination button {
                padding: 5px 8px;
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
            <div class="header">
                <h1>ğŸ“Š CSVå±•ç¤ºå·¥å…·</h1>
                <p>ä¸Šä¼ CSVæ–‡ä»¶æˆ–ç›´æ¥è¾“å…¥æ–‡æœ¬ï¼Œä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæ•°æ®ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢å’Œæ’åºåŠŸèƒ½</p>
                <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">
                    ğŸ’¡ æç¤ºï¼šç‚¹å‡»è¡¨å¤´æ’åº | æŒ‰ä½Shiftç‚¹å‡»å¤šåˆ—æ’åº | æ‚¬åœæŸ¥çœ‹å®Œæ•´å†…å®¹ | åŒå‡»å•å…ƒæ ¼å±•å¼€/æ”¶ç¼©
                </p>
            </div>

        <div class="upload-section">
            <div class="input-mode-tabs">
                <button class="mode-tab active" id="fileTab">ğŸ“ æ–‡ä»¶ä¸Šä¼ </button>
                <button class="mode-tab" id="textTab">ğŸ“ æ–‡æœ¬è¾“å…¥</button>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">ç‚¹å‡»é€‰æ‹©CSVæ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
                <div class="upload-hint">æ”¯æŒ .csv æ ¼å¼æ–‡ä»¶</div>
            </div>
            <input type="file" id="fileInput" accept=".csv" />
            
            <div class="text-input-area" id="textInputArea">
                <label class="text-input-label">è¾“å…¥æˆ–ç²˜è´´CSVæ•°æ®ï¼š</label>
                <textarea class="csv-textarea" id="csvTextarea" placeholder="è¯·åœ¨æ­¤è¾“å…¥CSVæ–‡æœ¬æ•°æ®...&#10;ä¾‹å¦‚ï¼š&#10;å§“å,å¹´é¾„,åŸå¸‚&#10;å¼ ä¸‰,25,åŒ—äº¬&#10;æå››,30,ä¸Šæµ·"></textarea>
                <button class="parse-btn" id="parseBtn">è§£ææ•°æ®</button>
            </div>
            
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName"></div>
                <div class="file-size" id="fileSize"></div>
            </div>

            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="data-section" id="dataSection">
            <div class="column-management">
                <!-- åˆ—å†…å®¹è¿‡æ»¤åŒºåŸŸ -->
                <div class="content-filter-section" id="contentFilterSection">
                    <!-- æ ‡é¢˜å’Œæ“ä½œæ  -->
                    <div class="content-filter-header">
                        <div>
                            <strong class="content-filter-title">ğŸ” åˆ—å†…å®¹è¿‡æ»¤</strong>
                        </div>
                        <div class="filter-logic-selector">
                            <span class="filter-logic-label">å¤šæ¡ä»¶é€»è¾‘ï¼š</span>
                            <label class="filter-logic-option">
                                <input type="radio" name="filterLogic" value="AND" checked onchange="csvViewer.applyContentFiltersAndDisplay()" class="filter-logic-radio">
                                <span class="filter-logic-text">AND (ä¸”)</span>
                            </label>
                            <label class="filter-logic-option">
                                <input type="radio" name="filterLogic" value="OR" onchange="csvViewer.applyContentFiltersAndDisplay()" class="filter-logic-radio">
                                <span class="filter-logic-text">OR (æˆ–)</span>
                            </label>
                        </div>
                        <button onclick="csvViewer.clearAllContentFilters()" id="clearAllFiltersBtn" class="clear-all-filters-btn" style="display: none;">
                            ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰
                        </button>
                    </div>
                    
                    <!-- è¿‡æ»¤å™¨è¡Œå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    
                    <!-- æ·»åŠ æ–°è¿‡æ»¤å™¨çš„è¾“å…¥è¡Œ -->
                    <div class="filter-input-row">
                        <div class="filter-input-field">
                            <input type="text" id="filterColumnName" 
                                   placeholder="è¾“å…¥åˆ—å" 
                                   list="availableColumns"
                                   class="filter-input">
                            <datalist id="availableColumns"></datalist>
                        </div>
                        <div class="filter-condition-field">
                            <select id="filterCondition" class="filter-select">
                                <option value="contains">åŒ…å«</option>
                                <option value="equals">ç­‰äº</option>
                                <option value="notEquals">ä¸ç­‰äº</option>
                                <option value="startsWith">å¼€å¤´æ˜¯</option>
                                <option value="endsWith">ç»“å°¾æ˜¯</option>
                                <option value="greaterThan">å¤§äº</option>
                                <option value="lessThan">å°äº</option>
                                <option value="isEmpty">ä¸ºç©º</option>
                                <option value="notEmpty">ä¸ä¸ºç©º</option>
                            </select>
                        </div>
                        <div class="filter-input-field">
                            <input type="text" id="filterValue" 
                                   placeholder="è¾“å…¥è¿‡æ»¤å€¼" 
                                   list="availableValues"
                                   class="filter-input">
                            <datalist id="availableValues"></datalist>
                        </div>
                        <button class="filter-add-btn" onclick="csvViewer.addContentFilter()">æ·»åŠ </button>
                    </div>
                </div>

                <!-- åˆ—è¿‡æ»¤è®¾ç½® -->
                <div style="margin-bottom: 15px; background: #f0f7ff; padding: 15px; border-radius: 8px; border: 1px solid #d0e7ff; position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <label style="margin: 0; font-weight: 600; color: #495057;">ğŸ¯ åˆ—è¿‡æ»¤è®¾ç½®</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 0.8em; color: #6c757d; background: white; padding: 4px 8px; border-radius: 4px; border: 1px solid #d0e7ff;">
                                ğŸ’¾ è®¾ç½®è‡ªåŠ¨ä¿å­˜
                            </span>
                            <button onclick="csvViewer.resetColumnFilterSettings()" 
                                    style="font-size: 0.8em; padding: 4px 10px; border: 1px solid #dee2e6; background: white; border-radius: 4px; cursor: pointer; color: #6c757d; transition: all 0.3s ease;"
                                    onmouseover="this.style.background='#f8f9fa'; this.style.borderColor='#4facfe'"
                                    onmouseout="this.style.background='white'; this.style.borderColor='#dee2e6'"
                                    title="é‡ç½®ä¸ºé»˜è®¤è®¾ç½®">
                                ğŸ”„ é‡ç½®
                            </button>
                        </div>
                    </div>
                    <div class="column-filter-options">
                        <label class="column-filter-option">
                            <input type="radio" name="columnFilterMode" value="all" checked onchange="csvViewer.updateColumnFilterUI()">
                            <span>æ˜¾ç¤ºæ‰€æœ‰åˆ—</span>
                        </label>
                        <label class="column-filter-option">
                            <input type="radio" name="columnFilterMode" value="include" onchange="csvViewer.updateColumnFilterUI()">
                            <span>ä»…æ˜¾ç¤ºæŒ‡å®šåˆ—</span>
                        </label>
                        <label class="column-filter-option">
                            <input type="radio" name="columnFilterMode" value="exclude" onchange="csvViewer.updateColumnFilterUI()">
                            <span>å¿½ç•¥æŒ‡å®šåˆ—</span>
                        </label>
                    </div>
                    <!-- æ ‡ç­¾è¾“å…¥å®¹å™¨ -->
                    <div id="tagsInputContainer" class="tags-input-container disabled" style="display: none;" onclick="csvViewer.focusTagsInput()">
                        <!-- æ ‡ç­¾å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                        <input type="text" 
                               id="columnFilterInput" 
                               class="tags-input-field"
                               placeholder="è¾“å…¥åˆ—ååæŒ‰å›è½¦æ·»åŠ "
                               disabled
                               autocomplete="off">
                    </div>
                    <div style="font-size: 0.85em; color: #6c757d; margin-top: 5px; display: none;" id="columnFilterHint">
                        ğŸ’¡ æç¤ºï¼šè¾“å…¥åˆ—ååæŒ‰ <kbd style="padding: 2px 6px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; font-size: 0.9em;">Enter</kbd> æ·»åŠ æ ‡ç­¾ï¼Œç‚¹å‡» âœ• åˆ é™¤
                    </div>
                </div>

                <div class="column-controls-header">
                    <div class="column-select-all">
                        <label>
                            <input type="checkbox" id="selectAllCheckbox">
                            <span>å…¨é€‰/å…¨ä¸é€‰åˆ—</span>
                        </label>
                        <button class="btn-sort-column" id="sortColumnsBtn">
                            <span id="sortColumnsIcon">ğŸ”¤</span> æŒ‰åˆ—åæ’åº
                        </button>
                        <button class="btn-toggle-columns" id="toggleColumnsBtn">
                            <span id="toggleColumnsIcon">ğŸ‘ï¸</span> æ˜¾ç¤ºåˆ—ç®¡ç†
                        </button>
                    </div>
                </div>
                <div id="columnControlsRow">
                    <div id="columnControls">
                        <!-- åˆ—æ§åˆ¶æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <div class="data-header">
                <div>
                    <div class="data-title">æ•°æ®å±•ç¤º</div>
                </div>
                <div class="controls">
                    <div class="page-size-selector">
                        <label for="pageSize">æ¯é¡µæ˜¾ç¤º:</label>
                        <select id="pageSize">
                            <option value="10">10æ¡</option>
                            <option value="25" selected>25æ¡</option>
                            <option value="50">50æ¡</option>
                            <option value="100">100æ¡</option>
                        </select>
                    </div>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="æœç´¢æ•°æ®...">
                        <span class="search-icon">ğŸ”</span>
                    </div>
                    <div class="export-buttons">
                        <button class="export-btn" id="clearSort" style="background: #6c757d; display: none;">æ¸…é™¤æ’åº</button>
                        <button class="export-btn" id="exportCsv">å¯¼å‡ºCSV</button>
                        <button class="export-btn" id="exportJson">å¯¼å‡ºJSON</button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>

            <div class="data-stats" id="dataStats"></div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script>
        class CSVViewer {
            constructor() {
                this.csvData = [];
                this.filteredData = [];
                this.originalFilteredData = [];
                this.currentPage = 1;
                this.pageSize = 25;
                this.headers = [];
                this.searchTerm = '';
                this.sortColumns = []; // æ•°ç»„ï¼Œå­˜å‚¨å¤šä¸ªæ’åºåˆ— [{column: 'åˆ—å', direction: 'asc/desc'}]
                this.visibleColumns = []; // å¯è§çš„åˆ—
                this.columnOrder = []; // åˆ—çš„æ˜¾ç¤ºé¡ºåº
                this.columnControlsVisible = false; // åˆ—ç®¡ç†é¢æ¿æ˜¯å¦æ˜¾ç¤º
                this.columnSortOrder = 'none'; // åˆ—åæ’åºçŠ¶æ€ï¼š'none' | 'asc' | 'desc'
                this.columnTags = []; // å­˜å‚¨åˆ—è¿‡æ»¤æ ‡ç­¾
                this.COLUMN_FILTER_KEY = 'csv_table_column_filter_settings'; // localStorage key
                this.contentFilters = []; // å­˜å‚¨åˆ—å†…å®¹è¿‡æ»¤å™¨: [{id, column, condition, value}, ...]
                
                this.initializeElements();
                this.bindEvents();
                this.initializeTagsInput();
                this.initializeContentFilterInput();
                this.loadColumnFilterSettings();
            }

            initializeElements() {
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.fileInfo = document.getElementById('fileInfo');
                this.fileName = document.getElementById('fileName');
                this.fileSize = document.getElementById('fileSize');
                this.errorMessage = document.getElementById('errorMessage');
                this.dataSection = document.getElementById('dataSection');
                this.dataStats = document.getElementById('dataStats');
                this.pageSizeSelect = document.getElementById('pageSize');
                this.searchInput = document.getElementById('searchInput');
                this.tableHead = document.getElementById('tableHead');
                this.tableBody = document.getElementById('tableBody');
                this.pagination = document.getElementById('pagination');
                this.exportCsvBtn = document.getElementById('exportCsv');
                this.exportJsonBtn = document.getElementById('exportJson');
                this.clearSortBtn = document.getElementById('clearSort');
                this.selectAllCheckbox = document.getElementById('selectAllCheckbox');
                this.sortColumnsBtn = document.getElementById('sortColumnsBtn');
                this.toggleColumnsBtn = document.getElementById('toggleColumnsBtn');
                this.columnControlsRow = document.getElementById('columnControlsRow');
                this.columnControls = document.getElementById('columnControls');
                this.fileTab = document.getElementById('fileTab');
                this.textTab = document.getElementById('textTab');
                this.textInputArea = document.getElementById('textInputArea');
                this.csvTextarea = document.getElementById('csvTextarea');
                this.parseBtn = document.getElementById('parseBtn');
            }

            bindEvents() {
                // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e.target.files[0]));
                
                // æ‹–æ‹½äº‹ä»¶
                this.uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.add('dragover');
                });
                
                this.uploadArea.addEventListener('dragleave', () => {
                    this.uploadArea.classList.remove('dragover');
                });
                
                this.uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file && file.type === 'text/csv') {
                        this.handleFileSelect(file);
                    } else {
                        this.showError('è¯·é€‰æ‹©CSVæ ¼å¼çš„æ–‡ä»¶');
                    }
                });

                // åˆ†é¡µå’Œæœç´¢äº‹ä»¶
                this.pageSizeSelect.addEventListener('change', (e) => {
                    this.pageSize = parseInt(e.target.value);
                    this.currentPage = 1;
                    this.renderTable();
                });

                this.searchInput.addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.toLowerCase();
                    this.currentPage = 1;
                    this.filterData();
                    this.renderTable();
                });

                // å¯¼å‡ºäº‹ä»¶
                this.exportCsvBtn.addEventListener('click', () => this.exportToCSV());
                this.exportJsonBtn.addEventListener('click', () => this.exportToJSON());
                
                // æ¸…é™¤æ’åºäº‹ä»¶
                this.clearSortBtn.addEventListener('click', () => this.clearAllSorts());
                
                // åˆ—ç®¡ç†äº‹ä»¶
                this.selectAllCheckbox.addEventListener('change', () => this.toggleAllColumns());
                this.sortColumnsBtn.addEventListener('click', () => this.sortColumnsByName());
                this.toggleColumnsBtn.addEventListener('click', () => this.toggleColumnControls());
                
                // è¾“å…¥æ¨¡å¼åˆ‡æ¢äº‹ä»¶
                this.fileTab.addEventListener('click', () => this.switchInputMode('file'));
                this.textTab.addEventListener('click', () => this.switchInputMode('text'));
                
                // æ–‡æœ¬è§£æäº‹ä»¶
                this.parseBtn.addEventListener('click', () => this.handleTextInput());
            }

            switchInputMode(mode) {
                if (mode === 'file') {
                    this.fileTab.classList.add('active');
                    this.textTab.classList.remove('active');
                    this.uploadArea.style.display = 'block';
                    this.textInputArea.classList.remove('show');
                } else {
                    this.textTab.classList.add('active');
                    this.fileTab.classList.remove('active');
                    this.uploadArea.style.display = 'none';
                    this.textInputArea.classList.add('show');
                }
                this.hideError();
                this.fileInfo.classList.remove('show');
            }

            handleTextInput() {
                const csvText = this.csvTextarea.value.trim();
                
                if (!csvText) {
                    this.showError('è¯·è¾“å…¥CSVæ•°æ®');
                    return;
                }
                
                this.hideError();
                
                try {
                    this.parseCSV(csvText);
                    this.showDataSection();
                    
                    // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯ï¼ˆæ–‡æœ¬è¾“å…¥æ¨¡å¼ï¼‰
                    this.fileName.textContent = 'æ–‡æœ¬è¾“å…¥æ•°æ®';
                    const lines = csvText.split('\n').filter(line => line.trim());
                    this.fileSize.textContent = `${lines.length} è¡Œ, ${csvText.length} å­—ç¬¦`;
                    this.fileInfo.classList.add('show');
                } catch (error) {
                    this.showError('CSVæ•°æ®è§£æå¤±è´¥: ' + error.message);
                }
            }

            handleFileSelect(file) {
                if (!file) return;
                
                if (!file.name.toLowerCase().endsWith('.csv')) {
                    this.showError('è¯·é€‰æ‹©CSVæ ¼å¼çš„æ–‡ä»¶');
                    return;
                }

                this.showFileInfo(file);
                this.hideError();
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        this.parseCSV(e.target.result);
                        this.showDataSection();
                    } catch (error) {
                        this.showError('CSVæ–‡ä»¶è§£æå¤±è´¥: ' + error.message);
                    }
                };
                reader.readAsText(file, 'UTF-8');
            }

            showFileInfo(file) {
                this.fileName.textContent = file.name;
                this.fileSize.textContent = this.formatFileSize(file.size);
                this.fileInfo.classList.add('show');
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            parseCSV(csvText) {
                const lines = csvText.split('\n').filter(line => line.trim());
                if (lines.length === 0) {
                    throw new Error('CSVæ–‡ä»¶ä¸ºç©º');
                }

                // è§£æè¡¨å¤´
                this.headers = this.parseCSVLine(lines[0]);
                
                // è§£ææ•°æ®è¡Œ
                this.csvData = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = this.parseCSVLine(lines[i]);
                    if (values.length > 0) {
                        const row = {};
                        this.headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        this.csvData.push(row);
                    }
                }

                this.filteredData = [...this.csvData];
                this.originalFilteredData = [...this.csvData];
                this.currentPage = 1;
                
                // åˆå§‹åŒ–åˆ—é…ç½®
                this.columnOrder = [...this.headers];
                
                // åº”ç”¨åˆ—è¿‡æ»¤è®¾ç½®æ¥ç¡®å®šå¯è§åˆ—
                this.applyColumnFilter();
                
                // ç”Ÿæˆåˆ—æ§åˆ¶æŒ‰é’®
                this.generateColumnControls();
                
                // æ›´æ–°å¯ç”¨åˆ—ååˆ—è¡¨
                this.updateAvailableColumns();
            }

            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current.trim());
                return result;
            }

            filterData() {
                // å…ˆåº”ç”¨å†…å®¹è¿‡æ»¤
                let dataAfterContentFilter = [...this.csvData];
                
                if (this.contentFilters.length > 0) {
                    const filterLogic = document.querySelector('input[name="filterLogic"]:checked')?.value || 'AND';
                    
                    dataAfterContentFilter = this.csvData.filter(row => {
                        if (filterLogic === 'AND') {
                            // ANDå…³ç³»ï¼šæ‰€æœ‰è¿‡æ»¤å™¨éƒ½å¿…é¡»æ»¡è¶³
                            return this.contentFilters.every(filter => {
                                return this.matchFilter(row, filter);
                            });
                        } else {
                            // ORå…³ç³»ï¼šè‡³å°‘ä¸€ä¸ªè¿‡æ»¤å™¨æ»¡è¶³
                            return this.contentFilters.some(filter => {
                                return this.matchFilter(row, filter);
                            });
                        }
                    });
                }
                
                // å†åº”ç”¨æœç´¢è¿‡æ»¤
                if (!this.searchTerm) {
                    this.filteredData = dataAfterContentFilter;
                } else {
                    this.filteredData = dataAfterContentFilter.filter(row => {
                        return Object.values(row).some(value => 
                            value.toString().toLowerCase().includes(this.searchTerm)
                        );
                    });
                }
                
                // ä¿å­˜åŸå§‹è¿‡æ»¤åçš„é¡ºåºï¼ˆç”¨äºå–æ¶ˆæ’åºï¼‰
                this.originalFilteredData = [...this.filteredData];
                
                // åº”ç”¨æ’åº
                this.applySorting();
            }

            applySorting() {
                if (this.sortColumns.length === 0) {
                    // æ²¡æœ‰æ’åºï¼Œæ¢å¤åˆ°åŸå§‹é¡ºåº
                    if (this.originalFilteredData) {
                        this.filteredData = [...this.originalFilteredData];
                    }
                } else {
                    // å¤šåˆ—æ’åº
                    this.filteredData.sort((a, b) => {
                        // æŒ‰ç…§æ’åºåˆ—çš„ä¼˜å…ˆçº§ä¾æ¬¡æ¯”è¾ƒ
                        for (let sortInfo of this.sortColumns) {
                            const column = sortInfo.column;
                            const direction = sortInfo.direction;
                            
                            const aVal = a[column] || '';
                            const bVal = b[column] || '';
                            
                            // å°è¯•æ•°å­—æ¯”è¾ƒ
                            const aNum = parseFloat(aVal);
                            const bNum = parseFloat(bVal);
                            
                            let compareResult = 0;
                            
                            if (!isNaN(aNum) && !isNaN(bNum)) {
                                compareResult = aNum - bNum;
                            } else {
                                // å­—ç¬¦ä¸²æ¯”è¾ƒ
                                const aStr = aVal.toString().toLowerCase();
                                const bStr = bVal.toString().toLowerCase();
                                compareResult = aStr.localeCompare(bStr, 'zh-CN');
                            }
                            
                            if (compareResult !== 0) {
                                return direction === 'asc' ? compareResult : -compareResult;
                            }
                            // å¦‚æœç›¸ç­‰ï¼Œç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä¸ªæ’åºåˆ—
                        }
                        return 0;
                    });
                }
            }

            sortColumn(column, shiftKey = false) {
                if (!shiftKey) {
                    // ä¸æŒ‰Shifté”®ï¼Œæ¸…ç©ºå…¶ä»–æ’åºï¼Œåªå¯¹å½“å‰åˆ—æ’åº
                    const existingIndex = this.sortColumns.findIndex(s => s.column === column);
                    
                    if (existingIndex !== -1) {
                        const currentDirection = this.sortColumns[existingIndex].direction;
                        
                        if (currentDirection === 'asc') {
                            // å‡åº -> é™åº
                            this.sortColumns = [{column: column, direction: 'desc'}];
                        } else {
                            // é™åº -> å–æ¶ˆæ’åº
                            this.sortColumns = [];
                        }
                    } else {
                        // æ–°åˆ—ï¼Œé»˜è®¤å‡åº
                        this.sortColumns = [{column: column, direction: 'asc'}];
                    }
                } else {
                    // æŒ‰ä½Shifté”®ï¼Œæ·»åŠ æˆ–ä¿®æ”¹å¤šåˆ—æ’åº
                    const existingIndex = this.sortColumns.findIndex(s => s.column === column);
                    
                    if (existingIndex !== -1) {
                        const currentDirection = this.sortColumns[existingIndex].direction;
                        
                        if (currentDirection === 'asc') {
                            // å‡åº -> é™åº
                            this.sortColumns[existingIndex].direction = 'desc';
                        } else {
                            // é™åº -> ç§»é™¤è¯¥åˆ—æ’åº
                            this.sortColumns.splice(existingIndex, 1);
                        }
                    } else {
                        // æ·»åŠ æ–°çš„æ’åºåˆ—
                        this.sortColumns.push({column: column, direction: 'asc'});
                    }
                }
                
                this.currentPage = 1;
                this.applySorting();
                this.renderTable();
                this.updateClearSortButton();
            }

            clearAllSorts() {
                this.sortColumns = [];
                this.currentPage = 1;
                this.applySorting();
                this.renderTable();
                this.updateClearSortButton();
            }

            updateClearSortButton() {
                if (this.sortColumns.length > 0) {
                    this.clearSortBtn.style.display = 'inline-block';
                } else {
                    this.clearSortBtn.style.display = 'none';
                }
            }

            showDataSection() {
                this.dataSection.classList.add('show');
                this.updateDataStats();
                this.renderTable();
            }

            updateDataStats() {
                const total = this.csvData.length;
                const filtered = this.filteredData.length;
                const pages = Math.ceil(filtered / this.pageSize);
                
                let statsText = `å…± ${total} æ¡æ•°æ®ï¼Œç­›é€‰å ${filtered} æ¡ï¼Œå…± ${pages} é¡µ`;
                
                if (this.sortColumns.length > 0) {
                    const sortDescriptions = this.sortColumns.map((sortInfo, index) => {
                        const direction = sortInfo.direction === 'asc' ? 'â†‘' : 'â†“';
                        const priority = this.sortColumns.length > 1 ? `[${index + 1}]` : '';
                        return `${priority}${sortInfo.column}${direction}`;
                    });
                    statsText += ` | æ’åº: ${sortDescriptions.join(', ')}`;
                }
                
                this.dataStats.textContent = statsText;
            }

            renderTable() {
                this.updateDataStats();
                this.renderTableHead();
                this.renderTableBody();
                this.renderPagination();
            }

            renderTableHead() {
                this.tableHead.innerHTML = '';
                const tr = document.createElement('tr');
                
                // åªæ˜¾ç¤ºå¯è§çš„åˆ—ï¼Œå¹¶æŒ‰ç…§columnOrderçš„é¡ºåº
                this.columnOrder.forEach(header => {
                    if (!this.visibleColumns.includes(header)) return;
                    
                    const th = document.createElement('th');
                    th.className = 'sortable';
                    
                    // æŸ¥æ‰¾è¯¥åˆ—æ˜¯å¦åœ¨æ’åºåˆ—è¡¨ä¸­
                    const sortIndex = this.sortColumns.findIndex(s => s.column === header);
                    
                    // è®¾ç½®åˆ—åå’Œæ’åºä¼˜å…ˆçº§
                    if (sortIndex !== -1 && this.sortColumns.length > 1) {
                        // å¤šåˆ—æ’åºæ—¶æ˜¾ç¤ºä¼˜å…ˆçº§æ•°å­—
                        th.textContent = header + ' ';
                        const priorityBadge = document.createElement('span');
                        priorityBadge.className = 'sort-priority';
                        priorityBadge.textContent = (sortIndex + 1);
                        th.appendChild(priorityBadge);
                    } else {
                        th.textContent = header;
                    }
                    
                    // æ·»åŠ æ’åºå›¾æ ‡
                    const sortIcon = document.createElement('span');
                    sortIcon.className = 'sort-icon';
                    th.appendChild(sortIcon);
                    
                    // è®¾ç½®æ’åºçŠ¶æ€
                    if (sortIndex !== -1) {
                        th.classList.add(`sort-${this.sortColumns[sortIndex].direction}`);
                    } else {
                        th.classList.add('sort-none');
                    }
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆä¼ é€’shiftKeyçŠ¶æ€ï¼‰
                    th.addEventListener('click', (e) => this.sortColumn(header, e.shiftKey));
                    
                    tr.appendChild(th);
                });
                
                this.tableHead.appendChild(tr);
            }

            renderTableBody() {
                this.tableBody.innerHTML = '';
                
                if (this.filteredData.length === 0) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    td.colSpan = this.visibleColumns.length;
                    td.className = 'no-data';
                    td.innerHTML = `
                        <div class="no-data-icon">ğŸ“Š</div>
                        <div>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ•°æ®</div>
                    `;
                    tr.appendChild(td);
                    this.tableBody.appendChild(tr);
                    return;
                }

                const startIndex = (this.currentPage - 1) * this.pageSize;
                const endIndex = Math.min(startIndex + this.pageSize, this.filteredData.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const row = this.filteredData[i];
                    const tr = document.createElement('tr');
                    
                    // åªæ˜¾ç¤ºå¯è§çš„åˆ—ï¼Œå¹¶æŒ‰ç…§columnOrderçš„é¡ºåº
                    this.columnOrder.forEach(header => {
                        if (!this.visibleColumns.includes(header)) return;
                        
                        const td = document.createElement('td');
                        const cellValue = row[header] || '';
                        td.textContent = cellValue;
                        td.setAttribute('data-tooltip', cellValue);
                        
                        // æ·»åŠ åŒå‡»å±•å¼€/æ”¶ç¼©åŠŸèƒ½
                        td.addEventListener('dblclick', () => {
                            td.classList.toggle('expanded');
                        });
                        
                        tr.appendChild(td);
                    });
                    
                    this.tableBody.appendChild(tr);
                }
            }

            renderPagination() {
                this.pagination.innerHTML = '';
                
                const totalPages = Math.ceil(this.filteredData.length / this.pageSize);
                if (totalPages <= 1) return;

                // ä¸Šä¸€é¡µæŒ‰é’®
                const prevBtn = document.createElement('button');
                prevBtn.textContent = 'ä¸Šä¸€é¡µ';
                prevBtn.disabled = this.currentPage === 1;
                prevBtn.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.renderTable();
                    }
                });
                this.pagination.appendChild(prevBtn);

                // é¡µç æŒ‰é’®
                const startPage = Math.max(1, this.currentPage - 2);
                const endPage = Math.min(totalPages, this.currentPage + 2);

                if (startPage > 1) {
                    const firstBtn = document.createElement('button');
                    firstBtn.textContent = '1';
                    firstBtn.addEventListener('click', () => {
                        this.currentPage = 1;
                        this.renderTable();
                    });
                    this.pagination.appendChild(firstBtn);

                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.style.padding = '10px';
                        this.pagination.appendChild(ellipsis);
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    if (i === this.currentPage) {
                        pageBtn.classList.add('current-page');
                    }
                    pageBtn.addEventListener('click', () => {
                        this.currentPage = i;
                        this.renderTable();
                    });
                    this.pagination.appendChild(pageBtn);
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.style.padding = '10px';
                        this.pagination.appendChild(ellipsis);
                    }

                    const lastBtn = document.createElement('button');
                    lastBtn.textContent = totalPages;
                    lastBtn.addEventListener('click', () => {
                        this.currentPage = totalPages;
                        this.renderTable();
                    });
                    this.pagination.appendChild(lastBtn);
                }

                // ä¸‹ä¸€é¡µæŒ‰é’®
                const nextBtn = document.createElement('button');
                nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
                nextBtn.disabled = this.currentPage === totalPages;
                nextBtn.addEventListener('click', () => {
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.renderTable();
                    }
                });
                this.pagination.appendChild(nextBtn);

                // é¡µé¢ä¿¡æ¯
                const pageInfo = document.createElement('span');
                pageInfo.className = 'page-info';
                pageInfo.textContent = `ç¬¬ ${this.currentPage} é¡µï¼Œå…± ${totalPages} é¡µ`;
                this.pagination.appendChild(pageInfo);
            }

            exportToCSV() {
                if (this.csvData.length === 0) return;
                
                let csvContent = this.headers.join(',') + '\n';
                this.csvData.forEach(row => {
                    const values = this.headers.map(header => {
                        const value = row[header] || '';
                        return value.includes(',') ? `"${value}"` : value;
                    });
                    csvContent += values.join(',') + '\n';
                });

                this.downloadFile(csvContent, 'data.csv', 'text/csv');
            }

            exportToJSON() {
                if (this.csvData.length === 0) return;
                
                const jsonContent = JSON.stringify(this.csvData, null, 2);
                this.downloadFile(jsonContent, 'data.json', 'application/json');
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.classList.add('show');
            }

            hideError() {
                this.errorMessage.classList.remove('show');
            }

            // åˆ—ç®¡ç†ç›¸å…³æ–¹æ³•
            generateColumnControls() {
                this.columnControls.innerHTML = '';

                this.columnOrder.forEach(column => {
                    const button = document.createElement('div');
                    button.className = `column-toggle ${this.visibleColumns.includes(column) ? 'active' : ''}`;
                    button.innerHTML = `
                        <span class="drag-handle">â‹®â‹®</span>
                        <input type="checkbox" ${this.visibleColumns.includes(column) ? 'checked' : ''}>
                        <span title="${column}">${column}</span>
                    `;
                    button.draggable = true;
                    button.dataset.column = column;
                    
                    // ç‚¹å‡»æŒ‰é’®åˆ‡æ¢åˆ—æ˜¾ç¤º
                    const checkbox = button.querySelector('input[type="checkbox"]');
                    checkbox.addEventListener('change', (e) => {
                        e.stopPropagation();
                        this.toggleColumn(column);
                    });
                    
                    // æ‹–æ‹½äº‹ä»¶
                    button.addEventListener('dragstart', (e) => this.handleDragStart(e));
                    button.addEventListener('dragover', (e) => this.handleDragOver(e));
                    button.addEventListener('drop', (e) => this.handleDrop(e));
                    button.addEventListener('dragend', (e) => this.handleDragEnd(e));
                    
                    this.columnControls.appendChild(button);
                });

                // æ›´æ–°å…¨é€‰æŒ‰é’®çŠ¶æ€
                this.updateSelectAllCheckbox();
            }

            toggleColumn(column) {
                if (this.visibleColumns.includes(column)) {
                    this.visibleColumns = this.visibleColumns.filter(col => col !== column);
                } else {
                    this.visibleColumns.push(column);
                }
                this.renderTable();
                this.generateColumnControls();
            }

            toggleAllColumns() {
                if (this.selectAllCheckbox.checked) {
                    // å…¨é€‰
                    this.visibleColumns = [...this.columnOrder];
                } else {
                    // å…¨ä¸é€‰
                    this.visibleColumns = [];
                }
                this.renderTable();
                this.generateColumnControls();
            }

            updateSelectAllCheckbox() {
                if (!this.selectAllCheckbox) return;
                
                const allSelected = this.visibleColumns.length === this.columnOrder.length;
                const someSelected = this.visibleColumns.length > 0 && this.visibleColumns.length < this.columnOrder.length;
                
                if (allSelected) {
                    this.selectAllCheckbox.checked = true;
                    this.selectAllCheckbox.indeterminate = false;
                } else if (someSelected) {
                    this.selectAllCheckbox.checked = false;
                    this.selectAllCheckbox.indeterminate = true;
                } else {
                    this.selectAllCheckbox.checked = false;
                    this.selectAllCheckbox.indeterminate = false;
                }
            }

            sortColumnsByName() {
                const sortIcon = document.getElementById('sortColumnsIcon');
                
                if (this.columnSortOrder === 'none' || this.columnSortOrder === 'desc') {
                    // å‡åºæ’åº
                    this.columnOrder.sort((a, b) => a.localeCompare(b, 'zh-CN'));
                    this.columnSortOrder = 'asc';
                    sortIcon.textContent = 'ğŸ”¤â†‘';
                } else {
                    // é™åºæ’åº
                    this.columnOrder.sort((a, b) => b.localeCompare(a, 'zh-CN'));
                    this.columnSortOrder = 'desc';
                    sortIcon.textContent = 'ğŸ”¤â†“';
                }
                
                this.renderTable();
                this.generateColumnControls();
            }

            toggleColumnControls() {
                this.columnControlsVisible = !this.columnControlsVisible;
                
                if (this.columnControlsVisible) {
                    this.columnControlsRow.classList.add('show');
                    this.toggleColumnsBtn.innerHTML = '<span id="toggleColumnsIcon">ğŸ™ˆ</span> éšè—åˆ—ç®¡ç†';
                } else {
                    this.columnControlsRow.classList.remove('show');
                    this.toggleColumnsBtn.innerHTML = '<span id="toggleColumnsIcon">ğŸ‘ï¸</span> æ˜¾ç¤ºåˆ—ç®¡ç†';
                }
            }

            // æ‹–æ‹½ç›¸å…³æ–¹æ³•
            handleDragStart(e) {
                const column = e.target.dataset.column || e.target.closest('.column-toggle').dataset.column;
                e.dataTransfer.setData('text/plain', column);
                e.target.classList.add('dragging');
            }

            handleDragOver(e) {
                e.preventDefault();
            }

            handleDrop(e) {
                e.preventDefault();
                const target = e.target.closest('.column-toggle');
                if (!target) return;
                
                const draggedColumn = e.dataTransfer.getData('text/plain');
                const targetColumn = target.dataset.column;
                
                if (draggedColumn && targetColumn && draggedColumn !== targetColumn) {
                    const draggedIndex = this.columnOrder.indexOf(draggedColumn);
                    const targetIndex = this.columnOrder.indexOf(targetColumn);
                    
                    this.columnOrder.splice(draggedIndex, 1);
                    this.columnOrder.splice(targetIndex, 0, draggedColumn);
                    
                    this.generateColumnControls();
                    this.renderTable();
                }
            }

            handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            // åˆ—è¿‡æ»¤è®¾ç½®ç›¸å…³æ–¹æ³•
            updateColumnFilterUI() {
                const filterMode = document.querySelector('input[name="columnFilterMode"]:checked').value;
                const filterInput = document.getElementById('columnFilterInput');
                const filterHint = document.getElementById('columnFilterHint');
                const tagsContainer = document.getElementById('tagsInputContainer');
                
                if (filterMode === 'all') {
                    tagsContainer.style.display = 'none';
                    tagsContainer.classList.add('disabled');
                    filterInput.disabled = true;
                    filterHint.style.display = 'none';
                } else {
                    tagsContainer.style.display = 'flex';
                    tagsContainer.classList.remove('disabled');
                    filterInput.disabled = false;
                    filterHint.style.display = 'block';
                    
                    if (filterMode === 'include') {
                        filterInput.placeholder = this.columnTags.length > 0 ? 'ç»§ç»­æ·»åŠ ...' : 'è¾“å…¥è¦æ˜¾ç¤ºçš„åˆ—ååæŒ‰å›è½¦';
                        filterHint.innerHTML = 'ğŸ’¡ æç¤ºï¼šè¾“å…¥åˆ—ååæŒ‰ <kbd style="padding: 2px 6px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; font-size: 0.9em;">Enter</kbd> æ·»åŠ æ ‡ç­¾ï¼Œæ”¯æŒå¸¦ç©ºæ ¼çš„åˆ—åã€‚å¤šä¸ªåˆ—åç”¨é€—å·æˆ–åˆ†å·åˆ†éš”';
                    } else if (filterMode === 'exclude') {
                        filterInput.placeholder = this.columnTags.length > 0 ? 'ç»§ç»­æ·»åŠ ...' : 'è¾“å…¥è¦éšè—çš„åˆ—ååæŒ‰å›è½¦';
                        filterHint.innerHTML = 'ğŸ’¡ æç¤ºï¼šè¾“å…¥åˆ—ååæŒ‰ <kbd style="padding: 2px 6px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; font-size: 0.9em;">Enter</kbd> æ·»åŠ æ ‡ç­¾ï¼Œæ”¯æŒå¸¦ç©ºæ ¼çš„åˆ—åã€‚å¤šä¸ªåˆ—åç”¨é€—å·æˆ–åˆ†å·åˆ†éš”';
                    }
                }
                
                // ä¿å­˜è®¾ç½®åˆ°ç¼“å­˜
                this.saveColumnFilterSettings();
                
                // å¦‚æœæœ‰æ•°æ®ï¼Œé‡æ–°åº”ç”¨è¿‡æ»¤
                if (this.headers.length > 0) {
                    this.applyColumnFilter();
                    this.renderTable();
                    this.generateColumnControls();
                }
            }

            focusTagsInput() {
                const filterInput = document.getElementById('columnFilterInput');
                if (filterInput && !filterInput.disabled) {
                    filterInput.focus();
                }
            }

            addColumnTag(columnName) {
                // æ¸…ç†è¾“å…¥
                columnName = columnName.trim();
                if (!columnName) return;
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                if (this.columnTags.includes(columnName)) {
                    alert(`åˆ— "${columnName}" å·²å­˜åœ¨`);
                    return;
                }
                
                // æ·»åŠ åˆ°æ•°ç»„
                this.columnTags.push(columnName);
                
                // æ¸²æŸ“æ ‡ç­¾
                this.renderColumnTags();
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                const filterInput = document.getElementById('columnFilterInput');
                filterInput.value = '';
                
                // æ›´æ–°å ä½ç¬¦
                this.updateColumnFilterUI();
                
                // ä¿å­˜è®¾ç½®
                this.saveColumnFilterSettings();
                
                // é‡æ–°åº”ç”¨è¿‡æ»¤
                if (this.headers.length > 0) {
                    this.applyColumnFilter();
                    this.renderTable();
                    this.generateColumnControls();
                }
            }

            removeColumnTag(columnName) {
                const index = this.columnTags.indexOf(columnName);
                if (index > -1) {
                    this.columnTags.splice(index, 1);
                    this.renderColumnTags();
                    this.updateColumnFilterUI();
                    this.saveColumnFilterSettings();
                    
                    // é‡æ–°åº”ç”¨è¿‡æ»¤
                    if (this.headers.length > 0) {
                        this.applyColumnFilter();
                        this.renderTable();
                        this.generateColumnControls();
                    }
                }
            }

            renderColumnTags() {
                const tagsContainer = document.getElementById('tagsInputContainer');
                const filterInput = document.getElementById('columnFilterInput');
                
                // æ¸…é™¤ç°æœ‰æ ‡ç­¾
                const existingTags = tagsContainer.querySelectorAll('.column-tag');
                existingTags.forEach(tag => tag.remove());
                
                // åˆ›å»ºæ–°æ ‡ç­¾
                this.columnTags.forEach(columnName => {
                    const tag = document.createElement('div');
                    tag.className = 'column-tag';
                    tag.innerHTML = `
                        <span class="column-tag-text" title="${columnName}">${columnName}</span>
                        <span class="column-tag-remove" onclick="csvViewer.removeColumnTag('${columnName}')" title="åˆ é™¤">âœ•</span>
                    `;
                    
                    // åœ¨è¾“å…¥æ¡†å‰æ’å…¥
                    tagsContainer.insertBefore(tag, filterInput);
                });
            }

            initializeTagsInput() {
                const filterInput = document.getElementById('columnFilterInput');
                
                filterInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const value = filterInput.value.trim();
                        if (value) {
                            // æ”¯æŒé€—å·å’Œåˆ†å·åˆ†éš”çš„å¤šä¸ªåˆ—åï¼ˆä¿ç•™ç©ºæ ¼ä»¥æ”¯æŒå¸¦ç©ºæ ¼çš„åˆ—åï¼‰
                            const columns = value.split(/[,ï¼Œ;ï¼›]+/).filter(col => col.trim());
                            columns.forEach(col => this.addColumnTag(col.trim()));
                        }
                    } else if (e.key === 'Backspace' && filterInput.value === '' && this.columnTags.length > 0) {
                        // åˆ é™¤æœ€åä¸€ä¸ªæ ‡ç­¾
                        e.preventDefault();
                        this.removeColumnTag(this.columnTags[this.columnTags.length - 1]);
                    }
                });
                
                // å¤±ç„¦æ—¶å¤„ç†è¾“å…¥
                filterInput.addEventListener('blur', () => {
                    const value = filterInput.value.trim();
                    if (value) {
                        // æ”¯æŒé€—å·å’Œåˆ†å·åˆ†éš”çš„å¤šä¸ªåˆ—åï¼ˆä¿ç•™ç©ºæ ¼ä»¥æ”¯æŒå¸¦ç©ºæ ¼çš„åˆ—åï¼‰
                        const columns = value.split(/[,ï¼Œ;ï¼›]+/).filter(col => col.trim());
                        columns.forEach(col => this.addColumnTag(col.trim()));
                    }
                });
            }

            applyColumnFilter() {
                const filterMode = document.querySelector('input[name="columnFilterMode"]:checked').value;
                
                if (filterMode === 'all') {
                    // æ˜¾ç¤ºæ‰€æœ‰åˆ—
                    this.visibleColumns = [...this.headers];
                } else if (filterMode === 'include') {
                    // ä»…æ˜¾ç¤ºæŒ‡å®šåˆ—
                    if (this.columnTags.length === 0) {
                        // å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ—ï¼Œæ˜¾ç¤ºæ‰€æœ‰åˆ—
                        this.visibleColumns = [...this.headers];
                    } else {
                        // åªæ˜¾ç¤ºåœ¨æ ‡ç­¾ä¸­ä¸”å­˜åœ¨äºheadersä¸­çš„åˆ—
                        this.visibleColumns = this.columnTags.filter(col => this.headers.includes(col));
                    }
                } else if (filterMode === 'exclude') {
                    // å¿½ç•¥æŒ‡å®šåˆ—
                    if (this.columnTags.length === 0) {
                        // å¦‚æœæ²¡æœ‰æŒ‡å®šè¦å¿½ç•¥çš„åˆ—ï¼Œæ˜¾ç¤ºæ‰€æœ‰åˆ—
                        this.visibleColumns = [...this.headers];
                    } else {
                        // æ˜¾ç¤ºä¸åœ¨æ ‡ç­¾ä¸­çš„åˆ—
                        this.visibleColumns = this.headers.filter(col => !this.columnTags.includes(col));
                    }
                }
            }

            saveColumnFilterSettings() {
                try {
                    const filterMode = document.querySelector('input[name="columnFilterMode"]:checked').value;
                    
                    const settings = {
                        mode: filterMode,
                        tags: this.columnTags,
                        timestamp: new Date().toISOString()
                    };
                    
                    localStorage.setItem(this.COLUMN_FILTER_KEY, JSON.stringify(settings));
                    console.log('åˆ—è¿‡æ»¤è®¾ç½®å·²ä¿å­˜åˆ°ç¼“å­˜:', settings);
                } catch (error) {
                    console.error('ä¿å­˜åˆ—è¿‡æ»¤è®¾ç½®å¤±è´¥:', error);
                }
            }

            loadColumnFilterSettings() {
                try {
                    const settingsStr = localStorage.getItem(this.COLUMN_FILTER_KEY);
                    if (!settingsStr) {
                        console.log('æœªæ‰¾åˆ°ç¼“å­˜çš„åˆ—è¿‡æ»¤è®¾ç½®');
                        return;
                    }
                    
                    const settings = JSON.parse(settingsStr);
                    
                    // è®¾ç½®è¿‡æ»¤æ¨¡å¼
                    const modeRadio = document.querySelector(`input[name="columnFilterMode"][value="${settings.mode}"]`);
                    if (modeRadio) {
                        modeRadio.checked = true;
                    }
                    
                    // æ¢å¤æ ‡ç­¾
                    if (settings.tags && Array.isArray(settings.tags)) {
                        this.columnTags = settings.tags;
                        this.renderColumnTags();
                    }
                    
                    // æ›´æ–°UI
                    this.updateColumnFilterUI();
                    
                    console.log('åˆ—è¿‡æ»¤è®¾ç½®å·²ä»ç¼“å­˜åŠ è½½:', settings);
                } catch (error) {
                    console.error('åŠ è½½åˆ—è¿‡æ»¤è®¾ç½®å¤±è´¥:', error);
                }
            }

            resetColumnFilterSettings() {
                // æ¸…é™¤ç¼“å­˜
                try {
                    localStorage.removeItem(this.COLUMN_FILTER_KEY);
                } catch (error) {
                    console.error('æ¸…é™¤åˆ—è¿‡æ»¤è®¾ç½®å¤±è´¥:', error);
                }
                
                // æ¸…ç©ºæ ‡ç­¾æ•°ç»„
                this.columnTags = [];
                
                // é‡ç½®UIä¸ºé»˜è®¤å€¼
                const allRadio = document.querySelector('input[name="columnFilterMode"][value="all"]');
                if (allRadio) {
                    allRadio.checked = true;
                }
                
                const filterInput = document.getElementById('columnFilterInput');
                if (filterInput) {
                    filterInput.value = '';
                }
                
                // æ¸…é™¤æ‰€æœ‰æ ‡ç­¾
                this.renderColumnTags();
                
                // æ›´æ–°UI
                this.updateColumnFilterUI();
                
                // å¦‚æœæœ‰æ•°æ®ï¼Œé‡æ–°æ˜¾ç¤º
                if (this.headers.length > 0) {
                    this.applyColumnFilter();
                    this.renderTable();
                    this.generateColumnControls();
                }
                
                alert('åˆ—è¿‡æ»¤è®¾ç½®å·²é‡ç½®');
            }

            // åˆ—å†…å®¹è¿‡æ»¤ç›¸å…³æ–¹æ³•
            addContentFilter() {
                const columnName = document.getElementById('filterColumnName').value.trim();
                const condition = document.getElementById('filterCondition').value;
                const value = document.getElementById('filterValue').value.trim();
                
                if (!columnName) {
                    alert('è¯·è¾“å…¥åˆ—å');
                    return;
                }
                
                // æ£€æŸ¥åˆ—æ˜¯å¦å­˜åœ¨
                if (!this.headers.includes(columnName)) {
                    alert(`åˆ— "${columnName}" ä¸å­˜åœ¨`);
                    return;
                }
                
                // æŸäº›æ¡ä»¶ä¸éœ€è¦å€¼
                if (!['isEmpty', 'notEmpty'].includes(condition) && !value) {
                    alert('è¯·è¾“å…¥è¿‡æ»¤å€¼');
                    return;
                }
                
                // æ·»åŠ åˆ°è¿‡æ»¤å™¨æ•°ç»„
                const filter = {
                    id: Date.now(),
                    column: columnName,
                    condition: condition,
                    value: value
                };
                
                this.contentFilters.push(filter);
                
                // æ¸…ç©ºè¾“å…¥
                document.getElementById('filterColumnName').value = '';
                document.getElementById('filterValue').value = '';
                
                // æ¸²æŸ“è¿‡æ»¤å™¨æ ‡ç­¾
                this.renderContentFilters();
                
                // é‡æ–°åº”ç”¨è¿‡æ»¤å¹¶æ˜¾ç¤ºæ•°æ®
                this.applyContentFiltersAndDisplay();
            }

            removeContentFilter(filterId) {
                this.contentFilters = this.contentFilters.filter(f => f.id !== filterId);
                this.renderContentFilters();
                this.applyContentFiltersAndDisplay();
            }

            clearAllContentFilters() {
                if (this.contentFilters.length === 0) {
                    alert('å½“å‰æ²¡æœ‰æ´»åŠ¨çš„è¿‡æ»¤å™¨');
                    return;
                }
                
                const count = this.contentFilters.length;
                this.contentFilters = [];
                this.renderContentFilters();
                this.applyContentFiltersAndDisplay();
                alert(`å·²æ¸…é™¤æ‰€æœ‰ ${count} ä¸ªè¿‡æ»¤å™¨`);
            }

            updateFilterColumnAndValues(filterId, newColumn) {
                const filter = this.contentFilters.find(f => f.id === filterId);
                if (filter) {
                    filter.column = newColumn.trim();
                    // æ›´æ–°è¯¥è¿‡æ»¤å™¨çš„å¯ç”¨å€¼åˆ—è¡¨
                    this.updateAvailableValuesForFilter(filterId, filter.column);
                    this.applyContentFiltersAndDisplay();
                }
            }

            updateFilterCondition(filterId, newCondition) {
                const filter = this.contentFilters.find(f => f.id === filterId);
                if (filter) {
                    filter.condition = newCondition;
                    // å¦‚æœæ˜¯isEmptyæˆ–notEmptyï¼Œæ¸…ç©ºå€¼
                    if (['isEmpty', 'notEmpty'].includes(newCondition)) {
                        filter.value = '';
                    }
                    this.renderContentFilters();
                    this.applyContentFiltersAndDisplay();
                }
            }

            updateFilterValue(filterId, newValue) {
                const filter = this.contentFilters.find(f => f.id === filterId);
                if (filter) {
                    filter.value = newValue.trim();
                    this.applyContentFiltersAndDisplay();
                }
            }

            renderContentFilters() {
                const section = document.getElementById('contentFilterSection');
                const clearBtn = document.getElementById('clearAllFiltersBtn');
                
                // æ˜¾ç¤ºæˆ–éšè—æ¸…é™¤æŒ‰é’®
                if (clearBtn) {
                    clearBtn.style.display = this.contentFilters.length > 0 ? 'inline-block' : 'none';
                }
                
                // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„è¿‡æ»¤å™¨è¡Œï¼ˆä¿ç•™æ ‡é¢˜å’Œæ·»åŠ è¾“å…¥è¡Œï¼‰
                const existingFilters = section.querySelectorAll('.filter-row');
                existingFilters.forEach(el => el.remove());
                
                if (this.contentFilters.length === 0) {
                    return;
                }
                
                // æ‰¾åˆ°æ·»åŠ è¾“å…¥è¡Œ
                const addInputRow = section.lastElementChild;
                
                this.contentFilters.forEach((filter, index) => {
                    // åˆ›å»ºè¿‡æ»¤å™¨è¡Œ
                    const filterRow = document.createElement('div');
                    filterRow.className = 'filter-row';
                    
                    filterRow.innerHTML = `
                        <div class="filter-row-field">
                            <input type="text" 
                                   value="${filter.column}" 
                                   oninput="csvViewer.updateFilterColumnAndValues(${filter.id}, this.value)"
                                   list="availableColumns"
                                   class="filter-row-input">
                        </div>
                        <div class="filter-row-condition">
                            <select onchange="csvViewer.updateFilterCondition(${filter.id}, this.value)" class="filter-row-select">
                                <option value="contains" ${filter.condition === 'contains' ? 'selected' : ''}>åŒ…å«</option>
                                <option value="equals" ${filter.condition === 'equals' ? 'selected' : ''}>ç­‰äº</option>
                                <option value="notEquals" ${filter.condition === 'notEquals' ? 'selected' : ''}>ä¸ç­‰äº</option>
                                <option value="startsWith" ${filter.condition === 'startsWith' ? 'selected' : ''}>å¼€å¤´æ˜¯</option>
                                <option value="endsWith" ${filter.condition === 'endsWith' ? 'selected' : ''}>ç»“å°¾æ˜¯</option>
                                <option value="greaterThan" ${filter.condition === 'greaterThan' ? 'selected' : ''}>å¤§äº</option>
                                <option value="lessThan" ${filter.condition === 'lessThan' ? 'selected' : ''}>å°äº</option>
                                <option value="isEmpty" ${filter.condition === 'isEmpty' ? 'selected' : ''}>ä¸ºç©º</option>
                                <option value="notEmpty" ${filter.condition === 'notEmpty' ? 'selected' : ''}>ä¸ä¸ºç©º</option>
                            </select>
                        </div>
                        <div class="filter-row-field">
                            <input type="text" 
                                   value="${filter.value || ''}" 
                                   onchange="csvViewer.updateFilterValue(${filter.id}, this.value)"
                                   placeholder="è¾“å…¥è¿‡æ»¤å€¼"
                                   list="availableValues_${filter.id}"
                                   class="filter-row-input"
                                   ${['isEmpty', 'notEmpty'].includes(filter.condition) ? 'disabled' : ''}>
                            <datalist id="availableValues_${filter.id}"></datalist>
                        </div>
                        <button onclick="csvViewer.removeContentFilter(${filter.id})" 
                                class="filter-row-delete-btn"
                                title="åˆ é™¤æ­¤è¿‡æ»¤æ¡ä»¶">åˆ é™¤</button>`;
                    
                    section.insertBefore(filterRow, addInputRow);
                    
                    // åˆå§‹åŒ–è¯¥è¿‡æ»¤å™¨è¡Œçš„å¯ç”¨å€¼åˆ—è¡¨
                    this.updateAvailableValuesForFilter(filter.id, filter.column);
                });
            }

            applyContentFiltersAndDisplay() {
                this.currentPage = 1;
                this.filterData();
                this.renderTable();
            }

            matchFilter(row, filter) {
                const cellValue = row[filter.column];
                const filterValue = filter.value;
                
                // å¤„ç†null/undefined
                if (cellValue === null || cellValue === undefined) {
                    if (filter.condition === 'isEmpty') return true;
                    if (filter.condition === 'notEmpty') return false;
                    return false;
                }
                
                // è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼ˆé™¤äº†æ•°å­—æ¯”è¾ƒï¼‰
                const cellStr = String(cellValue).toLowerCase();
                const filterStr = String(filterValue).toLowerCase();
                
                switch (filter.condition) {
                    case 'contains':
                        return cellStr.includes(filterStr);
                        
                    case 'equals':
                        // å°è¯•æ•°å­—æ¯”è¾ƒ
                        if (!isNaN(cellValue) && !isNaN(filterValue)) {
                            return Number(cellValue) === Number(filterValue);
                        }
                        return cellStr === filterStr;
                        
                    case 'notEquals':
                        if (!isNaN(cellValue) && !isNaN(filterValue)) {
                            return Number(cellValue) !== Number(filterValue);
                        }
                        return cellStr !== filterStr;
                        
                    case 'startsWith':
                        return cellStr.startsWith(filterStr);
                        
                    case 'endsWith':
                        return cellStr.endsWith(filterStr);
                        
                    case 'greaterThan':
                        if (!isNaN(cellValue) && !isNaN(filterValue)) {
                            return Number(cellValue) > Number(filterValue);
                        }
                        return cellStr > filterStr;
                        
                    case 'lessThan':
                        if (!isNaN(cellValue) && !isNaN(filterValue)) {
                            return Number(cellValue) < Number(filterValue);
                        }
                        return cellStr < filterStr;
                        
                    case 'isEmpty':
                        return cellStr === '' || cellStr === 'null' || cellStr === 'undefined';
                        
                    case 'notEmpty':
                        return cellStr !== '' && cellStr !== 'null' && cellStr !== 'undefined';
                        
                    default:
                        return true;
                }
            }

            updateAvailableColumns() {
                const datalist = document.getElementById('availableColumns');
                datalist.innerHTML = '';
                
                this.headers.forEach(column => {
                    const option = document.createElement('option');
                    option.value = column;
                    datalist.appendChild(option);
                });
            }

            // æ›´æ–°æŒ‡å®šåˆ—çš„å¯ç”¨å€¼æ¨èåˆ—è¡¨ï¼ˆç”¨äºä¸»è¾“å…¥è¡Œï¼‰
            updateAvailableValuesForColumn(columnName) {
                const datalist = document.getElementById('availableValues');
                
                // æ¸…ç©ºç°æœ‰é€‰é¡¹
                datalist.innerHTML = '';
                
                // å¦‚æœåˆ—åä¸ºç©ºæˆ–æ•°æ®ä¸ºç©ºï¼Œä¸æä¾›æ¨è
                if (!columnName || !this.csvData || this.csvData.length === 0) {
                    return;
                }
                
                // æ”¶é›†è¯¥åˆ—çš„æ‰€æœ‰å”¯ä¸€å€¼
                const uniqueValues = new Set();
                this.csvData.forEach(row => {
                    const value = row[columnName];
                    // æ’é™¤ nullã€undefined å’Œç©ºå­—ç¬¦ä¸²
                    if (value !== null && value !== undefined && value !== '') {
                        uniqueValues.add(String(value));
                    }
                });
                
                // å¦‚æœå”¯ä¸€å€¼å¤ªå¤šï¼ˆè¶…è¿‡100ä¸ªï¼‰ï¼Œåªæ˜¾ç¤ºå‰100ä¸ª
                const valuesToShow = Array.from(uniqueValues).sort().slice(0, 100);
                
                // æ·»åŠ åˆ° datalist
                valuesToShow.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    datalist.appendChild(option);
                });
            }

            // ä¸ºç‰¹å®šè¿‡æ»¤å™¨æ›´æ–°å¯ç”¨å€¼æ¨èåˆ—è¡¨
            updateAvailableValuesForFilter(filterId, columnName) {
                const datalist = document.getElementById(`availableValues_${filterId}`);
                
                // å¦‚æœ datalist ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
                if (!datalist) {
                    return;
                }
                
                // æ¸…ç©ºç°æœ‰é€‰é¡¹
                datalist.innerHTML = '';
                
                // å¦‚æœåˆ—åä¸ºç©ºæˆ–æ•°æ®ä¸ºç©ºï¼Œä¸æä¾›æ¨è
                if (!columnName || !this.csvData || this.csvData.length === 0) {
                    return;
                }
                
                // æ”¶é›†è¯¥åˆ—çš„æ‰€æœ‰å”¯ä¸€å€¼
                const uniqueValues = new Set();
                this.csvData.forEach(row => {
                    const value = row[columnName];
                    // æ’é™¤ nullã€undefined å’Œç©ºå­—ç¬¦ä¸²
                    if (value !== null && value !== undefined && value !== '') {
                        uniqueValues.add(String(value));
                    }
                });
                
                // å¦‚æœå”¯ä¸€å€¼å¤ªå¤šï¼ˆè¶…è¿‡100ä¸ªï¼‰ï¼Œåªæ˜¾ç¤ºå‰100ä¸ª
                const valuesToShow = Array.from(uniqueValues).sort().slice(0, 100);
                
                // æ·»åŠ åˆ° datalist
                valuesToShow.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    datalist.appendChild(option);
                });
            }

            // åˆå§‹åŒ–å†…å®¹è¿‡æ»¤è¾“å…¥äº‹ä»¶
            initializeContentFilterInput() {
                const filterColumnInput = document.getElementById('filterColumnName');
                const filterConditionSelect = document.getElementById('filterCondition');
                const filterValueInput = document.getElementById('filterValue');
                
                // å½“æ¡ä»¶æ”¹å˜æ—¶ï¼Œæ ¹æ®æ¡ä»¶ç±»å‹å¯ç”¨/ç¦ç”¨å€¼è¾“å…¥æ¡†
                filterConditionSelect.addEventListener('change', () => {
                    const condition = filterConditionSelect.value;
                    if (condition === 'isEmpty' || condition === 'notEmpty') {
                        filterValueInput.disabled = true;
                        filterValueInput.value = '';
                        filterValueInput.style.backgroundColor = '#e9ecef';
                    } else {
                        filterValueInput.disabled = false;
                        filterValueInput.style.backgroundColor = '';
                    }
                });
                
                // å½“åˆ—åæ”¹å˜æ—¶ï¼Œæ›´æ–°å¯ç”¨å€¼çš„æ¨èåˆ—è¡¨
                filterColumnInput.addEventListener('input', () => {
                    this.updateAvailableValuesForColumn(filterColumnInput.value);
                });
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        let csvViewer;
        document.addEventListener('DOMContentLoaded', () => {
            csvViewer = new CSVViewer();
        });
    </script>
</body>
</html>
